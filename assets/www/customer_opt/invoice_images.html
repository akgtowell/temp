<!--
 '  Created By   : Pratik Raval
 '  Created Date : 08/02/2012
 '  Description  : This page is used for merchandising.
-->
<!DOCTYPE html>
<html>
<head>
    <title>Image Capture</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0;maximum-scale=1.0;user-scalable=0; target-densitydpi=device-dpi">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="../css/jquery.mobile-1.0.min.css" />
    <link rel="stylesheet" href="../css/style.css" />
     <link rel="stylesheet" href="../css/en.css" lang="en" />
    <link rel="stylesheet" media="only screen and (min-width: 320px) and (max-width: 600px)"
        href="../css/style_600.css">
    <link rel="stylesheet" media="only screen and (min-width: 601px) and (max-width: 700px)"
        href="../css/style_700.css">
    <link rel="stylesheet" media="only screen and (min-width: 700px) and (max-width: 800px)"
        href="../css/style_800.css">
    <link rel="stylesheet" media="only screen and (min-width: 1000px) and (max-width: 1200px)"
        href="../css/style_1200.css">
    <link rel="stylesheet" media="only screen and (min-width: 1200px) and (max-width: 1500px)"
        href="../css/style_1400.css">

    <script type="text/javascript" src="../js/jquery.js"></script>
    <script type="text/javascript" src="../js/jquery.mobile-1.0.js"></script>
    <script type="text/javascript" src="../js/common.js"></script>
 	<script type="text/javascript" src="../js/sync.js"></script>

    <script src="../LangJS/jquery-lang.js" charset="utf-8" type="text/javascript"></script>
    <script src="../LangJS/langpack/AR.js" charset="utf-8" type="text/javascript" lang="en"></script>
    
    <!--<link rel="stylesheet" type="text/css" href="../css/jquery.mobile.simpledialog.css" />-->
    <style rel="stylesheet" type="text/css">
        .ui-simpledialog-header h4 { margin-top: 5px; margin-bottom: 5px; text-align: center;font-size:22px !important;}
        .ui-simpledialog-container { border: 5px solid #111 !important; width:410px;}
        .ui-simpledialog-screen { position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; }
        .ui-simpledialog-hidden { display: none; }
        .ui-simpledialog-input { width: 85% !important; display: block !important; margin-left: auto; margin-right: auto;font-weight:bold;}
        .ui-simpledialog-screen-modal { background-color: transparent; -moz-opacity: 0.8; opacity:.80; filter: alpha(opacity=80); }
        .ui-simpledialog-subtitle { text-align: center; }
        .ui-simpledialog-controls .buttons-separator {min-height: .6em;}
        .ui-simpledialog-controls .button-hidden { display:none; }
        .ui-dialog .ui-simpledialog-container { border: none !important; }
        .ui-dialog-simpledialog .ui-content { padding: 5px !important;}
        
        .imgcapture
        {
            width:40px;
            height:40px;
        }
    </style>
         <script src="../LangJS/jquery-lang.js" charset="utf-8" type="text/javascript"></script>
    	<script src="../LangJS/langpack/AR.js" charset="utf-8" type="text/javascript" lang="en"></script>
        
        <script type="text/javascript" src="../js/jquery.mobile.simpledialog.js"></script>
 <script>
if (navigator.userAgent.toLowerCase().match(/android/)) {
document.write('<script charset="utf-8" src="../cordova-2.0.0.js"><\/script>');
document.write('<script charset="utf-8" src="../directoryListing.js"><\/script>');
} else if (navigator.userAgent.toLowerCase().match(/iphone/) || navigator.userAgent.toLowerCase().match(/ipad/)) {
document.write('<script charset="utf-8" src="../cordova-1.5.0.js"><\/script>');
}
</script>
</head>
<body>
    <div data-role="page" id="visualpage" data-theme="d" data-cache="never">
        <div>
            <img title="" alt="" src="../images/bg.png" id="background">
        </div>
        
    	<div data-role="header" data-position="inline" id="bgclheader">
			<a href="../home/home.html" id="Back_inner" rel="external" lang="en"   >Back</a>
			<h1 lang="en">Image Capture</h1>
			<a href="#" id="lang_inner">EN</a><input value='' />
		</div>
        
        <div data-role="content" class="centerboxInvReq">
            <div class="boxContent" >
               <div >
                    <table cellpadding="10" cellspacing="5" align="center" class="" id="tbl11">
                       
                    </table>
                </div>
            </div>
       
           <div class="leftbottomMenu">
                
                   <a id="hlinkok" onclick="checkImagesSaved();" rel="external"
					style="text-decoration: none; font-weight: normal;">
					<div class="MenuPositionSCLarge">
						<div class="iconPos">
							<img class="bottomicon" src="../images/yes.png" alt="Ok" />
						</div>
						<div id="divmenutext" class="MenuTextPos MenuText" lang="en">Save</div>
					</div>
				</a>
                    
          </div>
            <table cellpadding="2" cellspacing="2" width="430px" id="tblPreview" style="display:none" align="center">
                <tr>
                    <td>
                        <img src="" id="imgpreview" width="400px" height="400px"/>
                    <td>
                </tr>
                <tr>
                    <td>
                        <input id="btncancel" type="button" value="Cancel" rel="close" data-role="none" width="150px"/>
                    </td>
                </tr>
            </table>
         </div>
      	<div id="f1"  data-role="footer" class="ui-bar">
            <div class="footer">
                <div class="leftfooter">
                    09 November 2011</div>
                <div class="rightfooter">
                    Mirnah Technology Systems</div>
            </div>
        </div>
        <div id="f2"  data-role="footer" style="bottom: 0; position: absolute;">
             <div data-role="navbar" data-iconpos="top" data-grid="f">
                <ul>
                    <li style="margin-bottom:0 !important;"><a href="#" rel="external" id="day" data-icon="custom" lang="en" onclick="footerredict('../startofday/startofday.html')">Start day</a></li>
			        <li style="margin-bottom:0 !important;"><a href="#" id="inve" rel="external" data-icon="custom" lang="en" onclick="footerredict('../inventory/inventory.html')">Inventory</a></li>
			        <li style="margin-bottom:0 !important;"><a href="#" class="ui-btn-active" rel="external" id="cust" data-icon="custom" lang="en">Customer</a></li>
			        <li style="margin-bottom:0 !important;"><a href="#" rel="external" id="sett" data-icon="custom" lang="en" onclick="footerredict('../settlement/managesettlement.html')">Settlement</a></li>
			        <li style="margin-bottom:0 !important;"><a href="#" rel="external" id="expe" data-icon="custom" lang="en" onclick="footerredict('../settlement/expenseentry.html')">Expenses</a></li>
			        <li style="margin-bottom:0 !important;"><a href="#" rel="external" id="info" data-icon="custom" lang="en" onclick="footerredict('../information/information.html')">Information</a></li>
			        <li style="margin-bottom:0 !important; width:14.0%"><a href="#" rel="external" id="setup" data-icon="custom" lang="en" onclick="footerredict('../utilities/utilities.html')">Utilities</a></li>
                </ul>
            </div>
        </div>
    </div>
   
    <script type="text/javascript" language="javascript">
        window.lang = new jquery_lang_js();
        var platform= sessionStorage.getItem("platform");
        var currimg,currdel,currimgno;
        var imagedata;
        var imgarr = [];
        var filename;
        var currentry;
        var imagenum;
        var curr_custcode;
        var delobjidx;
        var type;
        var ActiveIndex=0;
     	
	   $(document).ready(function() {
	 	
            $(".leftfooter").html(getCurrentDate());
             
             resizeOrientationWindow();
             document.addEventListener("deviceready", ondeviceready, false);
             var lan = sessionStorage.getItem("Language");
				window.lang.run(lan);
		
                if (sessionStorage.getItem("Language")  != "en") {
               
                window.lang.change('ImageCapture'+lan,lan);
                window.lang.change('Footer'+lan,lan);
				if(lan=="AR")
                {
                    $("#centerboxInvReq").attr("dir", "rtl");
                    $('#MenuList .ui-icon').removeClass('ui-icon-arrow-r');
                    $('#MenuList .ui-icon').addClass('ui-icon-arrow-r1');
                    $('#MenuList li.ui-btn').removeClass('ui-btn-icon-right');
                    $('#MenuList li.ui-btn').addClass('ui-btn-icon-left');
                    $('#Back_inner').removeClass('ui-btn-left ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
				    $('#Back_inner').addClass('ui-btn-right ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
				    $('#lang_inner').removeClass('ui-btn-right ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
				    $('#lang_inner').addClass('ui-btn-left ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
		}
		
		}
		else
		{
		    window.lang.change('en','en');
		    $(".centerboxInvReq").attr("dir", "ltr");
            $('#MenuList .ui-icon').removeClass('ui-icon-arrow-r1');
            $('#MenuList .ui-icon').addClass('ui-icon-arrow-r');
            $('#MenuList li.ui-btn').removeClass('ui-btn-icon-left');
            $('#MenuList li.ui-btn').addClass('ui-btn-icon-right');
			$('#Back_inner').removeClass('ui-btn-right ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
			$('#Back_inner').addClass('ui-btn-left ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
			$('#lang_inner').removeClass('ui-btn-left ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
			$('#lang_inner').addClass('ui-btn-right ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
		}

        });
        function ondeviceready()
        {
        	resizeWindow();
            try{
            		pictureSource=navigator.camera.PictureSourceType;
            		destinationType=navigator.camera.DestinationType;
            		getDetails1();
            
            }
            catch(ex)
            {
                alert(ex);
            }
        }        
        
        function getDetails1()
        {
            var Qry="select inv.routekey as routekey,inv.visitkey as detail_code,0 as imagepath,inv.invoicenumber as imagedescription,inv.customercode as remarks,0 as imagename from invoiceheader inv inner join customermaster cm on inv.customercode=cm.customercode  where routekey="+sessionStorage.getItem("RouteKey")+" and visitkey not in(select ifnull(visitkey,0) visitkey from customerimages where routekey="+sessionStorage.getItem("RouteKey")+") and cm.reportprintcontrol=1";
            console.log(Qry);
            if(platform == "iPad")
            {
                Cordova.exec(function(result) {
                    if(result.length > 0)
                    {
                        imagedata = result;
                         Binddata(imagedata);
                    }
                },
                function(error) {
                    alert(error);
                },
                "PluginClass",
                "GetdataMethod",
                [Qry]);
            }
            else if(platform == "Android")
            {
                window.plugins.DataBaseHelper.select(Qry, function(result)
                {
                    if(result.array != undefined)
                    {
                        var array = $.map(result.array, function(item, index) {                        
                            return [[item.detail_code, item.imagepath, item.imagedescription,item.remarks,item.imagename]];
                        });
                         imagedata = array;
                         Binddata(imagedata);
                    }
                    
                },
                function()
                {
                    console.warn("Error calling plugin");
                });
            }
        }
        
        function Binddata(data)
        {
            $('#tbl11').html('');
            for (i = 0; i < data.length; i++) 
                {
                     if(data[i][1]!='' && data[i][1]!=0)
                   {
                     var obj = new Object();
                                obj.imageno = data[i][0];
                                obj.imagepath = data[i][1];
                                obj.imagename = data[i][4];
                                obj.customercode = data[i][3];
                                imgarr.push(obj);
                   }
                 
                    var name =  data[i][2];
                    var r = "<tr>";
                    var j = i+1;
                    r += "<td style='width:40%;' class='captionLabel'>INVOICE "+data[i][2]+".</td>";
                 
                   var previewData;
                   if(data[i][1]=='' || data[i][1]==0)
                   {
                    var capstyle="display: block";
                    var preiviewstyle="display: none";
                   
                   }else
                   {
                    var capstyle="display: none";
                    var preiviewstyle="display: block";
                    
                   }
                
                   r += "<td style='width:30%;'><img src='../images/image-cap.png' id='imgcapture"+data[i][0]+"' class='imgcapture' onclick='CaptureImage(this.id,\"imgdelete"+data[i][0]+"\","+data[i][0]+","+data[i][3]+")' style='"+capstyle+"'/> <img src='../images/image-preview.png' style='"+preiviewstyle+"' width='52px' height='50px' id='imgpreview"+data[i][0]+"' class='imgcapture' onclick='ViewImage("+data[i][0]+")'/></td>";
                     r += "<td style='width:20%;'><img src='../images/no.png' id='imgdelete"+data[i][0]+"'  class='imgcapture' onclick='deleteimage("+data[i][0]+","+data[i][3]+")'/></td>";
       
                   if(data[i][3]==0)
                   data[i][3] ='';
                    r += "<td style='width:33%;display:none;'><input type='text' name='remarks"+data[i][0]+"' class='textWidth textFont' id='remarks"+data[i][0]+"' value='"+data[i][3]+"'><td>";
                     
                      r += "</tr>";
                    $('#tbl11').append(r);   
                    if(data[i][1]!='' || data[i][1]!=0)
                    {
                    $("#imgpreview"+data[i][0]).attr('src',data[i][1]);
                    }
                    
                }
               $('#visualpage').trigger('pagecreate');
        }
        function CaptureImage(imgid,deliconid,imgno,customercode) {
            try
            {
                currimg = imgid;
                currdel = deliconid;
                currimgno = imgno;
                curr_custcode=customercode;
                navigator.camera.getPicture(onPhotoURISuccessCapture, function(){navigator.notification.alert('No Image Selected.')}, { quality: 25, correctOrientation: true,
                destinationType: destinationType.FILE_URI,
                //saveToPhotoAlbum: true,      	 
                targetWidth: 600,
                targetHeight: 600
                });
            }
            catch(ex)
            {
                alert(ex);
            }
        }
        
        function onPhotoURISuccessCapture(imageURI)
        {
            try
            {
                var routekey = parseInt(sessionStorage.getItem("RouteKey"));
                var visitkey = parseInt(currimgno);
                var customerid = parseInt(curr_custcode);
                var randnum = Math.floor(Math.random() * 90) + 10;
                
                filename = routekey + "_" + visitkey + "_" + customerid + "_" + currimgno + "_" + randnum + ".jpg";
                console.log("Old Path : " + imageURI);
                //$("#lblimg" + currimgno).text(filename);
                window.resolveLocalFileSystemURI(imageURI, resOnSuccess, onFail);
            }
            catch(ex)
            {
                alert(ex);
            }
        }
        
        function resOnSuccess(entry){
            try
            {            
            window.requestFileSystem(LocalFileSystem.PERSISTENT, 0,
                                     function(fileSys) 
                                     {
                                        fileSys.root.getDirectory("sfa", {create:true, exclusive: false},
                                            function(directory) {
                                            	if(platform == "iPad")
                                            		entry.moveTo(directory,filename,MoveSuccess,onFail);
                                            	else if(platform == "Android")
                                                	entry.copyTo(directory,filename,MoveSuccess,onFail);
                                            }, onFail);
                                     }, onFail);
            }
            catch(ex)
            {
                alert(ex);
            }
        }
       

        function MoveSuccess(entry)
        {
            try{
                var imageURI = entry.fullPath;
                console.log("FullPath : " + imageURI);
                var len = Object.keys(imgarr).length;
                var obj = new Object();
               
                obj.imageno = currimgno;
                obj.imagepath = imageURI;
                obj.imagename = filename;
                obj.customercode=curr_custcode;
                $("#imgpreview"+currimgno).show();
                $("#imgpreview"+currimgno).attr('src',imageURI);
                if(len != undefined && len > 0)
                {
                    var editobj = 0;
                    for(i=0;i<len;i++)
                    {
                        console.log("currentimageno : " + currimgno);
                        console.log("imgarr.imgno : " + imgarr[i].imageno);
                        if(imgarr[i].imageno == currimgno)
                        {
                            imgarr[i].imagepath = imageURI;
                            imgarr[i].imagename = filename;
                            editobj = 1;
                        }
                    }
                    if(editobj == 0)
                        imgarr.push(obj);
                }
                else                                    
                    imgarr.push(obj);
                SaveImage();
                
            }
            catch(ex)
            {
                alert(ex);
            }
        }
        
        function onFail(message) {
            alert(message);
        }
        
        function CaptureControl()
        {
            var len = Object.keys(imgarr).length;
            
            if(len != undefined && len > 0)
            {
                for(i=0;i<len;i++)
                {
                    $("#imgcapture" + (imgarr[i].imageno)).hide();
                }
            }
        }
        
        function deleteimage(imgno,customercode)
        {
            imagenum = imgno;
            curr_custcode=customercode;
            var url = "";
            var imagename = ""
            try{
                for(i=0;i<Object.keys(imgarr).length;i++)
                {
                    if(imgarr[i].imageno == imgno)
                    {                    	
                        url = imgarr[i].imagepath;
                        if(platform == "Android")
                        {
                        	url = url.toString().substr(7); //Substring for removing 'file://'
                        } 
                        delobjidx = i;
                        break;
                    }
                }
                if(url != "")
                {
                	console.log("GETDELETEURL : " + url);
                    window.requestFileSystem(LocalFileSystem.PERSISTENT,0,
                        function(fileSys)
                        {                        	
                            fileSys.root.getFile(url,{create : false, exclusive : false}, ongetdeletesuccess,onFail);
                        },
                        onFail
                    );
                }
                else
                {
                    navigator.notification.alert("Image Not Available");
                    return false;
                }
            }
            catch(ex)
            {
                alert(ex);
            }
        }
        
        function ongetdeletesuccess(entry)
        {   
            $("#lblimg" + imagenum).text('');
            try{
            	console.log("DELETE PATH : " + entry.fullPath);
                entry.remove(function(){ navigator.notification.alert("Image Deleted Successfully.");                
                    var QryUpdate = "Delete from customerimages WHERE imageno=" + imagenum + " AND routekey=" + sessionStorage.getItem("RouteKey") + " AND visitkey=" +imagenum + " AND customercode= " +curr_custcode;
                    if(platform == "iPad")
                    {                
                        Cordova.exec(function(result) {
                            imgarr.splice(delobjidx,1);
                            $(document).undelegate("#imgpreview" + imagenum,"click");
                            $("#imgpreview"+imagenum).hide();
                            $("#imgcapture" + imagenum).show();
                        },
                        function(error) {
                            alert(error);
                        },
                        "PluginClass",
                        "InsertUpdateMethod",
                        [QryUpdate]);                
                    }
                    else if(platform == "Android")
                    {
                    	window.plugins.DataBaseHelper.insert(QryUpdate, function(result) {
                         	imgarr.splice(delobjidx,1);
                            $(document).undelegate("#imgpreview" + imagenum,"click");
                            $("#imgpreview"+imagenum).hide();
                            $("#imgcapture" + imagenum).show();
                         },
                         function() {
                         console.warn("Error calling plugin");
                         });
                    }
                },onFail);
            }
            catch(ex)
            {
                alert(ex);
            }
        }
        
        function SaveImage()
        {  
            try
            {
                if(Object.keys(imgarr).length > 0 && Object.keys(imgarr).length != undefined)
                    CheckImageExist(0,"");
                else
                {
                    navigator.notification.alert("Please Capture Image.");
                    return false;
                }
            }
            catch(ex)
            {
                alert(ex);
            }
        }
        
        function CheckImageExist(i,url)
        {   
            var routekey = sessionStorage.getItem("RouteKey");
            var visitkey =  imgarr[i].imageno;
            var routecode = sessionStorage.getItem("RouteCode");
            
            var imageno = imgarr[i].imageno;
            var imagepath = imgarr[i].imagepath;
            var imagename = imgarr[i].imagename;
            var customercode = imgarr[i].customercode;
            var remarks =  $("#remarks" + imageno).val();
            var QrySelect = "SELECT COUNT(*) as cnt FROM customerimages WHERE imageno = " + imageno + " AND routekey = " + routekey + " AND visitkey = " + visitkey + " AND customercode = " + customercode;
            var QryInsert = "INSERT INTO customerimages(customercode,imageno,imagepath,routecode,routekey,visitkey,transactiondate,transactiontime,imagename,issync) VALUES(" + customercode + "," + imageno + ",'" + imagepath + "'," + routecode + "," +  routekey + "," + visitkey + ",date(),time('now', 'localtime'),'" + imagename + "',0)"
            var QryUpdate = "UPDATE customerimages SET imagepath='" + imagepath + "',imagename='" + imagename + "' WHERE imageno=" + imageno + " AND routekey=" + routekey + " AND visitkey=" + visitkey + " AND customercode= " + customercode;
            console.log(QrySelect);
            var QryNew;
            if(platform == "iPad")
            {
                Cordova.exec(function(result) {
                    if(result[0][0] > 0)
                        QryNew = QryUpdate;
                    else
                        QryNew = QryInsert;
                    
                    console.log(QryNew);
                    Cordova.exec(function(result) {
                        if(i+1 < imgarr.length)
                            CheckImageExist(i+1);
                            
                        if(i == (imgarr.length - 1))
							savecustomercontrol();                            
                    },
                    function(error) {
                        alert(error);
                    },
                    "PluginClass",
                    "InsertUpdateMethod",
                    [QryNew]);
                },
                function(error) {
                    alert(error);
                },
                "PluginClass",
                "GetdataMethod",
                [QrySelect]);
            }
            else if(platform == "Android")
            {
            	window.plugins.DataBaseHelper.select(QrySelect, function(result) {
                 	if(result.array != undefined)
                 	{
                 		if(result.array[0].cnt > 0)
                 			QryNew = QryUpdate;
                    	else
                        	QryNew = QryInsert;
                        	
                        console.log(QryNew);
                        window.plugins.DataBaseHelper.insert(QryNew, function(result) {
	                     	if(i+1 < imgarr.length)
                            	CheckImageExist(i+1,url);
                        	if(i == (imgarr.length - 1)){
                        		if(url){
                        			savecustomercontrol();
                        		}else{
                        			CaptureControl(); 
                        		}
                        	}
                        		
	                    },
	                    function() {
	                    	console.warn("Error calling plugin");
	                    });
                 	}
                 },
                 function() {
                 console.warn("Error calling plugin");
                 });
            }
        }
        
        function ViewImage(imgno)
        {
            var imgdata = imagedata;
            var imgpath = "";
            try
            {
                if(Object.keys(imgarr).length != undefined && Object.keys(imgarr).length > 0)
                {
                    for(i=0;i<Object.keys(imgarr).length;i++)
                    {
                        if(imgarr[i].imageno == imgno)
                        {
                            imgpath = imgarr[i].imagepath;  
                            console.log("ViewImagePath : " + imgpath);           
                            $("#testimg").attr("src",imgpath);
                            $("#imgpreview").attr("src",imgpath);
                            $(".ui-simpledialog-container #imgpreview").attr("src",imgpath);
                            PopupImage($("#imgpreview" + imgno).attr("id"),$("#tblPreview").html());
                            $(".ui-simpledialog-container #imgpreview").attr("src",imgpath);
                            break;
                        }
                    }
                    if(imgpath == "")
                    {
                        navigator.notification.alert("Image Not Available");
                        return false;
                    }
                }
                else
                {
                    navigator.notification.alert("Image Not Available");
                    return false;
                }
            }
            catch(ex)
            {
                alert(ex);
            }
        }

	  function savecustomercontrol()
        {
            var Qry = "Update customeroperationscontrol set totaltransactions = totaltransactions+1 where routekey = " + sessionStorage.getItem('RouteKey') + " and visitkey = " + sessionStorage.getItem('VisitKey') + " and customercode="+ sessionStorage.getItem('customerid')+" and routecode="+ sessionStorage.getItem('RouteCode');
            console.log(Qry);
            if(platform == "iPad")
            {
                Cordova.exec(function(result) {
                              	window.location = "merchandising.html";
                              },
                              function(error) {
                              navigator.notification.alert("Error save promtion detail record");
                              },
                              "PluginClass",
                              "InsertUpdateMethod",
                              [Qry]);
            }
            else if(platform == "Android")
            {
                window.plugins.DataBaseHelper.insert(Qry, function(result) {
                                                     	window.location = "merchandising.html";
                                                     },
                                                     function() {
                                                     console.warn("Error calling plugin");
                                                     });
            }
        }
	  	function checkImagesSaved(){
	  		
	  		var Qry="select count(*) cnt from invoiceheader inv inner join customermaster cm on inv.customercode=cm.customercode  where routekey="+sessionStorage.getItem('RouteKey')+" and visitkey not in(select ifnull(visitkey,0) visitkey from customerimages where routekey="+sessionStorage.getItem('RouteKey')+") and cm.reportprintcontrol=1";
	  		if(platform == "iPad")
            {
                Cordova.exec(function(result) {
                    if(result.length > 0)
                    {
                       
                    }
                },
                function(error) {
                    alert(error);
                },
                "PluginClass",
                "GetdataMethod",
                [Qry]);
            }
            else if(platform == "Android")
            {
                window.plugins.DataBaseHelper.select(Qry, function(result)
                {
                    if(result.array != undefined)
                    {
                        if(result.array[0].cnt==0){
                        	//window.location="../home/home.html"
                        	getImages('../home/home.html','img')
                        }else{
                        	alert("Please Capture All Images");
                        }
                    	
                    }
                    
                },
                function()
                {
                    console.warn("Error calling plugin");
                });
            }
	  		
	  	}
    </script>

</body>
</html>
