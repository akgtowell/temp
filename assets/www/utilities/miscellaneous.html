<!--
 '  Created By   : Nidhi
 '  Created Date : 03/02/2012
 '  Description  : This page is used for utilities main screen.  
-->
<!DOCTYPE html>
<html>
<head>
    <title>Utilities</title>
    <meta name="viewport"
	content="width=device-width, initial-scale=1.0;maximum-scale=1.0;user-scalable=0; target-densitydpi=device-dpi">
    <link rel="stylesheet" href="../css/jquery.mobile-1.0.min.css" />
    <link rel="stylesheet" href="../css/style.css" />
    <link rel="stylesheet" href="../css/en.css" lang="en" />
    <link rel="stylesheet" media="only screen and (min-width: 320px) and (max-width: 600px)"
        href="../css/style_600.css">
    <link rel="stylesheet" media="only screen and (min-width: 601px) and (max-width: 700px)"
        href="../css/style_700.css">
    <link rel="stylesheet" media="only screen and (min-width: 700px) and (max-width: 800px)"
        href="../css/style_800.css">
    <link rel="stylesheet" media="only screen and (min-width: 1000px) and (max-width: 1200px)"
        href="../css/style_1200.css">
    <link rel="stylesheet" media="only screen and (min-width: 1200px) and (max-width: 1500px)"
        href="../css/style_1400.css">

    <script type="text/javascript" src="../js/jquery.js"></script>

    <script type="text/javascript" src="../js/jquery.mobile-1.0.js"></script>

    <script type="text/javascript" src="../js/common.js"></script>

    <script src="../LangJS/jquery-lang.js" charset="utf-8" type="text/javascript"></script>

    <script src="../LangJS/langpack/AR.js" charset="utf-8" type="text/javascript" lang="en"></script>

    <link rel="stylesheet" type="text/css" href="../css/jquery.mobile.simpledialog.css" />

    <script type="text/javascript" src="../js/jquery.mobile.simpledialog.js"></script>
<script>
        if (navigator.userAgent.toLowerCase().match(/android/)) {
            document.write('<script charset="utf-8" src="../cordova-2.0.0.js"><\/script>');
            document.write('<script charset="utf-8" src="../directoryListing.js"><\/script>');
        } else if (navigator.userAgent.toLowerCase().match(/iphone/) || navigator.userAgent.toLowerCase().match(/ipad/)) {
            document.write('<script charset="utf-8" src="../cordova-1.5.0.js"><\/script>');
        }
    </script>
</head>
<body>
    <div data-role="page" data-theme="d">
        <div>
            <img title="" alt="" src="../images/bg.png" id="background">
        </div>
        <div data-role="header" data-position="inline" id="bgclheader">
            <a href="utilities.html" id="Back_inner" rel="external" lang="en">Back</a>
            <div class="wrapper"><div class="card_content"><div><img title="" alt="" data-pushbar-target="left"  src="../images/icons8-menu-50.png" id="setting"></div></div></div>
            <h1 lang="en">
                Miscellaneous</h1>
            <a href="#" id="lang_inner">EN</a>
        </div>
        <div data-role="content" class="centerboxInvReq SpacingReview">
            <div class="content-review">
                <ul data-role="listview" id="MenuListReview">
                   
                    <li><a href="../about.html" rel="external" id="lnkUpdate">
                        <img src="../images/about.png" class="HomeIconPosEN cicon" />
                        <h3 id="lblUpdate" lang="en">
                            About</h3>
                    </a></li>
                    <li><a href="#" rel="external" id="lnkclen" onclick="PopupPasswordEntry(this.id,'miscellaneous.html',tblPassword.innerHTML,'miscellaneous.html');">
                        <img src="../images/clean.png" class="HomeIconPosEN cicon" />
                        <h3 id="lblUpdate" lang="en">
                            Clear System</h3>
                    </a></li>
                    <li><a href="utilities.html" rel="external">
                        <img src="../images/info-8.png" class="HomeIconPosEN cicon" />
                        <h3 id="lblOTA" lang="en">
                            Cancel</h3>
                    </a></li>
                </ul>
            </div>
        </div>
        	<div id="f1"  data-role="footer" class="ui-bar">
			<div class="footer">
				<div class="leftfooter">09 November 2011</div>
				<div class="rightfooter">Mirnah Technology Systems</div>
			</div>
		</div>
		<div id="f2"  data-role="footer" style="bottom: 0; position: absolute;">
		<aside data-pushbar-id="left" class="pushbar from_left">
		<div class="title"><span data-pushbar-close class="close push_right"></span>
			<span id="txtroute"></span>
		</div>

		<ul class="menu">
		<li style="margin-bottom: 0 !important;" > 
		<img title="" alt="" src="../images/startday-icon.png" id="day"  class="leftmenu" >
		 <a href="#"
						class="ui-btn-active" rel="external" id="day" data-icon="custom"  
						lang="en" onclick="footerredict('../startofday/startofday.html')">Start day</a></li>
					<li style="margin-bottom: 0 !important;">
					 <img title="" alt="" src="../images/Inventoryicon.png" id="inve"  class="leftmenu">
					 <a href="#" id="inve"
						rel="external" data-icon="custom" lang="en"
						onclick="footerredict('../inventory/inventory.html')">Inventory</a></li>
					<li style="margin-bottom: 0 !important;">
					 <img title="" alt="" src="../images/customer-icon.png" id="cust" class="leftmenu">
					 <a href="#"
						rel="external" id="cust" data-icon="custom" lang="en"
						onclick="footerredict('../customer/customer_operation.html')">Customer</a></li>
					<li style="margin-bottom: 0 !important;">
					<img title="" alt="" src="../images/Money-icon.png" id="sett" class="leftmenu">
					<a href="#"
						rel="external" id="sett" data-icon="custom" lang="en"
						onclick="footerredict('../settlement/managesettlement.html')">Settlement</a></li>
					<li style="margin-bottom: 0 !important;">
					<img title="" alt="" src="../images/expense-icon.png" id="expe" class="leftmenu">
					<a href="#"
						rel="external" id="expe" data-icon="custom" lang="en"
						onclick="footerredict('../settlement/expenseentry.html')">Expenses</a></li>
					<li style="margin-bottom: 0 !important;">
					<img title="" alt="" src="../images/information-icon.png" id="info" class="leftmenu" >
					<a href="#"
						rel="external" id="info" data-icon="custom" lang="en"  
						onclick="footerredict('../information/information.html')">Information</a></li>
					<li style="margin-bottom: 0 !important; ">
					 <img title="" alt="" src="../images/user-settings-icon.png" id="setup" class="leftmenu">
					 <a href="#" rel="external" id="setup" data-icon="custom" lang="en"
						onclick="footerredict('../utilities/utilities.html')">Utilities</a></li>
		</ul>

	</aside>
			<div data-role="navbar" data-iconpos="top" data-grid="f">
				<ul>
					<li style="margin-bottom: 0 !important;"><a href="#"
						rel="external" id="day" data-icon="custom" lang="en"
						onclick="footerredict('../startofday/startofday.html')">Start
							 day</a></li>
					<li style="margin-bottom: 0 !important;"><a href="#" id="inve"
						rel="external" data-icon="custom" lang="en"
						onclick="footerredict('../inventory/inventory.html')">Inventory</a></li>
					<li style="margin-bottom: 0 !important;"><a href="#"
						rel="external" id="cust" data-icon="custom" lang="en"
						onclick="footerredict('../customer/customer_operation.html')">Customer
							</a></li>
					<li style="margin-bottom: 0 !important;"><a href="#"
						rel="external" id="sett" data-icon="custom" lang="en"
						onclick="footerredict('../settlement/managesettlement.html')">Settlement</a></li>
					<li style="margin-bottom: 0 !important;"><a href="#"
						rel="external" id="expe" data-icon="custom" lang="en"
						onclick="footerredict('../settlement/expenseentry.html')">Expenses
							</a></li>
					<li style="margin-bottom: 0 !important;"><a href="#"
						rel="external" id="info" data-icon="custom" lang="en"
						onclick="footerredict('../information/information.html')">Information</a></li>
					<li style="margin-bottom: 0 !important; width: 14.0%"><a
						href="#" class="ui-btn-active" rel="external" id="setup"
						data-icon="custom" lang="en"
						onclick="footerredict('../utilities/utilities.html')">Utilities</a></li>
				</ul>
			</div>
		</div>
        <table id="tblPassword" border="0" cellpadding="2" cellspacing="0" width="100%;"
            style="display: none;">
            <tr>
                <th class="tblHeader captionLabel leftAlign popupTitle" colspan="2" lang="en">
                    Password Entry
                </th>
            </tr>
            <tr class="popupRow">
                <td colspan="2">
                    &nbsp;
                </td>
            </tr>
            <tr class="popupRow">
                <td  colspan="2" colspan="2" class="popupSubTitle" lang="en">                                       
                    Clear Data
                </td>                
            </tr>
            <tr class="popupRow">
                <td colspan="2" lang="en" class="popupInfo">
                    Please Enter The Security Password
                </td>
            </tr>
            <tr class="popupRow">
                <td colspan="2">
                    <input id="txtPassword" type="password" pattern="\d*" value="" maxlength="10" class="textWidth textFont passwordCenter"  />
                    <label id="lblMessage" lang="en" style="display:none">Enter Correct Password</label> 
                </td>
            </tr>
            <tr class="popupRow">
                <td style="width: 50%;">
                    <input id="btnSubmit" type="button" value="Submit" onclick="VerifyPassword('btnSubmit','miscellaneous.html','');" data-role="none"
                    lang="en" />
                </td>
                <td style="width: 50%;">
                    <input id="btnCancel" type="button" rel="close" value="Cancel" onclick="ClearPassword();"
                    data-role="none" lang="en" />
                </td>
            </tr>
        </table>         
    </div>

    <script type="text/javascript" language="javascript">
        window.lang = new jquery_lang_js();
        var platform;
		resizeOrientationWindow();	
        $(document).ready(function() {
		resizeWindow();
        //Set current date in footer
            $(".leftfooter").html(getCurrentDate());
                          platform= sessionStorage.getItem("platform");
                          
                          document.addEventListener("deviceready", getPassword, false);
            //Fetch current language and set that language.
            var lan = sessionStorage.getItem("Language");
            window.lang.run(lan);

            //Check for current language and set css for that    
            if (sessionStorage.getItem("Language") != "en") {

                window.lang.change('Misce' + lan, lan);
                window.lang.change('Footer' + lan, lan);
                if (lan == "AR") {

                    //Set menu icon with text
                    $('#MenuListReview .ui-icon').removeClass('ui-icon-arrow-r');
                    $('#MenuListReview .ui-icon').addClass('ui-icon-arrow-r1');
                    $('#MenuListReview li.ui-btn').removeClass('ui-btn-icon-right');
                    $('#MenuListReview li.ui-btn').addClass('ui-btn-icon-left');

                    //Set header align
                    $('#Back_inner').removeClass('ui-btn-left ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
                    $('#Back_inner').addClass('ui-btn-right ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
                    $('#lang_inner').removeClass('ui-btn-right ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
                    $('#lang_inner').addClass('ui-btn-left ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
                }

            }
            else {
                //Change current language to english
                window.lang.change('en', 'en');

                //Set menu icon with text
                $('#MenuListReview .ui-icon').removeClass('ui-icon-arrow-r1');
                $('#MenuListReview .ui-icon').addClass('ui-icon-arrow-r');
                $('#MenuListReview li.ui-btn').removeClass('ui-btn-icon-left');
                $('#MenuListReview li.ui-btn').addClass('ui-btn-icon-right');

                //Set header align
                $('#Back_inner').removeClass('ui-btn-right ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
                $('#Back_inner').addClass('ui-btn-left ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
                $('#lang_inner').removeClass('ui-btn-left ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
                $('#lang_inner').addClass('ui-btn-right ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
            }
        });
        function cleardata()
        {
            
	    var Tbls = ['routemaster','salesman','customermaster','itemmaster','controlpanel','setup','startingloaddetail','itemgroup','startendday','routesequence','discountkeydetail','discountkeyheader','salescalender','pricingdetail1','promoplandetail','promoplanheader','promokeydetail','promokeyheader','promotionassignmentadvanced','productgroupdetail','productgroupheader','bankmaster','company','customerposlimit','customerposinventory','POSmaster','posinstructions','nonservreasons','expreasons','expiryreturnreasons','retitmreasons','freegoodreasons','voidreasons','customersurveydefinition','customersurveykey','customersurveyplan','customersurveydefassign','customersurveykeyplan','lookupindexdetail','customerpricing1','vanmaster','salesmanmessages','itempackagemaster','cashdesc','inventorylocation','distributionkeydetails','suggestedsalesinvoice','inventorytransactiondetail','customer_foc_balance','customer_foc_detail','journeyplancreditlimit','invoicedetail','invoiceheader','invoicerxddetail','promotiondetail','customerinvoice','salesorderdetail','salesorderheader','batchexpirydetail','arheader','ardetail','cashcheckdetail','inventorytransactionheader','inventorysummarydetail','nonservicedcustomer','surveyauditdetail','posequipmentchangedetail','sigcapturedata','customeroperationscontrol','routesequencecustomerstatus','customerinventorydetail','routegoal','nosalesheader','batchmaster','batchmaster','batchmaster_temp','transactiondetailtemp','warehousestock'];
            if(platform=='iPad')
            {
                
                              
                              for(i=0;i<Tbls.length;i++)
                              {
                                        
                              var Qry = "DELETE FROM " + Tbls[i];
                              
                              console.log(Qry);
                              Cordova.exec(function(result) {
                                            
                                            
                                            
                                            },
                                            function(error) {
                                            alert(error);},
                                            "PluginClass", 
                                            "InsertUpdateMethod", 
                                            [Qry]);
                                  if(i==Tbls.length-1)
                                  clearroute();
				  
                              }
                              
                              
                              
                             
            }
            else if(platform=='Android')
            {
                
                                                    
                                                     for(i=0;i<Tbls.length;i++)
                                                     {
                                                                
                                                     var Qry = "DELETE FROM " + Tbls[i];
                                                     
                                                     console.log(Qry);
                                                     window.plugins.DataBaseHelper.insert(Qry,function(result)
                                                                                          {
                                                                                          
                                                                                          },
                                                                                          function()
                                                                                          {
                                                                                          console.warn("Error calling plugin");
                                                                                          });
                                                         if(i==Tbls.length-1)
                                                             clearroutetemp();
                                                     }
                                                     
                                                     
            }
        }
	function clearroute()
	{
	     var data = {};
                                           data["routecode"] = sessionStorage.getItem('RouteCode');       
                                           data["routekey"] = sessionStorage.getItem('RouteKey');
                                           data["status"] = 1;    
                                           
                                           data = JSON.stringify(data);
                                           
                                           $.ajax({
                                                  type: "get",
                                                  url: wsurl + "ws/logout?logout=["+ data +"]",
                                                  data: "{}",
						  cache: false,
                    timeout: 10000,
                                                  crossDomain: true,
                                                  success: function(data) {  
                                                  // alert(data);
                                                  updatequery = "delete from startendday where routecode = "+ sessionStorage.getItem('RouteCode') +" and routekey="+sessionStorage.getItem('RouteKey');           
                                                  
                                                  
                                                  if(platform=='iPad')
                                                  {
                                                  
                                                  Cordova.exec(function(result) {           
                                                                sessionStorage.clear();
                                                                localStorage.clear();
                                                                window.location = "../index.html";                       
                                                                
                                                                },
                                                                function(error) {
                                                                navigator.notification.alert("Error in insert start end day : " + error);
                                                                },
                                                                "PluginClass", 
                                                                "GetdataMethod", 
                                                                [updatequery]);         
                                                  }
                                                  else if(platform=='Android')
                                                  {          
                                                  window.plugins.DataBaseHelper.select(updatequery,function(result)
                                                                                       {                                                     
                                                                                       sessionStorage.clear();
                                                                                       localStorage.clear();
                                                                                       window.location = "../index.html";
                                                                                       },
                                                                                       function()
                                                                                       {
                                                                                       console.warn("Error calling plugin");
                                                                                       });
                                                  }        
                                                  
                                                  
                                                  },
                                                  error: function(qXHR, textStatus, errorThrown) {
                                                  alert("Start day prompt off failure: " + qXHR.status + ":" + textStatus + " " + errorThrown);
                                                  }
                                                  });  
	}
	//-----------
	function clearroutetemp()
    {
	    updatequery = "delete from startendday where routecode = "+ sessionStorage.getItem('RouteCode') +" and routekey="+sessionStorage.getItem('RouteKey');           
        
        
        if(platform=='iPad')
        {
        
        Cordova.exec(function(result) {           
                      sessionStorage.clear();
                      localStorage.clear();
                      window.location = "../index.html";                       
                      
                      },
                      function(error) {
                      navigator.notification.alert("Error in insert start end day : " + error);
                      },
                      "PluginClass", 
                      "GetdataMethod", 
                      [updatequery]);         
        }
        else if(platform=='Android')
        {          
        window.plugins.DataBaseHelper.select(updatequery,function(result)
                                             {                                                     
                                             sessionStorage.clear();
                                             localStorage.clear();
                                             navigator.notification.alert("Tablet Data Cleared. Contact Admin For Cloud Data" );
                                             window.location = "../index.html";
                                             },
                                             function()
                                             {
                                             console.warn("Error calling plugin");
                                             });
        }  
    }
	//--------------
        function getPassword()
        {   
            
            if(platform=='iPad')
		    {
                Cordova.exec(function(result) {                                             
                              
                              if (result.length > 0) 
                              {
                             
                              localStorage.adminpass=result[0][0]; 
                              
                              }
                              else {
                              localStorage.adminpass = "";
                                }
                              //addbatchdata();
                              },
                              function(error) {
                              alert("Error in getting Password : " + error);
                              },
                              "PluginClass", 
                              "GetdataMethod", 
                              ["select password5 From routemaster where routecode = "+ sessionStorage.getItem('RouteCode') +""]);         
            }
            else if(platform=='Android')
            {
                window.plugins.DataBaseHelper.select("select password5 From routemaster where routecode = "+ sessionStorage.getItem('RouteCode') +"",function(result)
                                                     {
                                                     
                                                     result = $.map(result.array, function (item, index) {
                                                                    
                                                                    return [[item.password5]];
                                                                    });
                                                     if (result.length > 0) 
                                                     {
                                                     
                                                     localStorage.adminpass=result[0][0]; 
                                                     
                                                     }
                                                     else {
                                                     localStorage.adminpass = "";
                                                     }
                                                     
                                                     
                                                     },
                                                     function()
                                                     {
                                                     console.warn("Error calling plugin");
                                                     });
            } 
            
        }
    </script>

</body>
</html>
