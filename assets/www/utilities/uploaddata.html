<!--
 '  Created By   : Ankur Shah
 '  Created Date : 06/07/2012
 '  Description  : This page is used for upload data to server.    
 -->
<!DOCTYPE html>
<html>
<head>
<title>Upload Data</title>

<meta name="viewport"
	content="width=device-width, initial-scale=1.0;maximum-scale=1.0;user-scalable=0; target-densitydpi=device-dpi">

<meta name="format-detection" content="telephone=no">
<link rel="stylesheet" href="../css/jquery.mobile-1.0.min.css" />
<link rel="stylesheet" href="../css/style.css" />
<link rel="stylesheet" href="../css/en.css" lang="en" />
<link rel="stylesheet"
	media="only screen and (min-width: 320px) and (max-width: 600px)"
	href="../css/style_600.css" />
<link rel="stylesheet"
	media="only screen and (min-width: 601px) and (max-width: 700px)"
	href="../css/style_700.css" />
<link rel="stylesheet"
	media="only screen and (min-width: 700px) and (max-width: 800px)"
	href="../css/style_800.css" />
<link rel="stylesheet"
	media="only screen and (min-width: 1000px) and (max-width: 1200px)"
	href="../css/style_1200.css" />
<link rel="stylesheet"
	media="only screen and (min-width: 1200px) and (max-width: 1500px)"
	href="../css/style_1400.css" />

<link rel="stylesheet" href="../css/boostrap/css/bStyle.css" />
<link rel="stylesheet" href="../css/boostrap/css/bootstrap.min.css" />
<link rel="stylesheet" href="../css/boostrap/css/bootstrap-grid.css" />
<link rel="stylesheet" href="../css/boostrap/css/bootstrap-grid.min.css" />
<link rel="stylesheet" href="../css/boostrap/css/bootstrap.css" />

<link href="../css/photoswipe.css" type="text/css" rel="stylesheet" />
<script type="text/javascript" src="../js/klass.min.js"></script>
<script type="text/javascript" src="../js/jquery.js"></script>
<script type="text/javascript" src="../js/jquery.mobile-1.0.js"></script>
<script type="text/javascript" src="../js/common.js"></script>
<script type="text/javascript" src="../js/upload.js"></script>

<script type="text/javascript">
	if (navigator.userAgent.toLowerCase().match(/android/)) {
		document
				.write('<script charset="utf-8" src="../cordova-2.0.0.js"><\/script>');
		document
				.write('<script charset="utf-8" src="../directoryListing.js"><\/script>');
	} else if (navigator.userAgent.toLowerCase().match(/iphone/)
			|| navigator.userAgent.toLowerCase().match(/ipad/)) {
		document
				.write('<script charset="utf-8" src="../cordova-1.5.0.js"><\/script>');
	}
</script>

<script src="../LangJS/jquery-lang.js" charset="utf-8"
	type="text/javascript"></script>

<script src="../LangJS/langpack/AR.js" charset="utf-8"
	type="text/javascript" lang="en"></script>


<script type="text/javascript"
	src="../js/code.photoswipe.jquery-3.0.5.min.js"></script>

<style type="text/css">
.chk {
	
}

;
.unchk {
	
}
;
</style>
</head>
<body>
	<div data-role="page" data-theme="d" id="divpage">
		<div>
			<img title="" alt="" src="../images/bg.png" id="background">
		</div>
		<div data-role="header" data-position="inline" id="bgclheader">
			<a href="utilities.html" id="Back_inner" rel="external" lang="en">Back</a>
			<div class="wrapper">
				<div class="card_content">
					<div>
						<img title="" alt="" data-pushbar-target="left"
							src="../images/icons8-menu-50.png" id="setting">
					</div>
				</div>
			</div>
			<h1 lang="en">Upload Data</h1>
			<a href="#" id="lang_inner">EN</a>
		</div>
		<div data-role="content" class="centerboxInvReq">
			<div class="boxContent Spacing" style="height:720px !important">
				<table border="0" cellpadding="4" cellspacing="4" width="100%" style="display:none; ">
					<tr>
						<td class="captionLabel" lang="en" style="width: 30%;">
							SELECT TYPE</td>
						<td style="width: 70%;">
							<div style="width: 90%; float: left">
								<select name="ddltransaction" id="ddltransaction"
									class="form-control" style="display: inline;">
									<option value="0" lang="en">Select</option>
									<option value="7" lang="en">Inventory</option>
									<option value="1" lang="en">Sales</option>
									<option value="2" lang="en">Order</option>
									<option value="4" lang="en">Advance Payment</option>
									<option value="3" lang="en">Collection</option>
									<option value="5" lang="en">Merchandizing</option>
									<option value="6" lang="en">Others</option>
									<option value="8" lang="en">Images</option>
								</select>
							</div>
							<div style='float: right; display: none;' id='selectall'>
								<div style='float: left; padding: 15px'>All</div>
								<div style='float: left'>
									<img src="../images/check.png" id="chkall"
										onclick='SelectAll(this)' alt="" />
								</div>
							</div>
						</td>
					</tr>
				</table>
				<div class="tblBox tbltd" id="divgrid" >
					<table id="tblHeaderContent" cellpadding="0" cellspacing="0"
						border="0" width="100%" class="tblHeader" >
						<tr>
							<th style="width: 10%;"></th>
							<th style="width: 20%;" class="leftAlign" lang="en">CUST</th>
							<th style="width: 25%;" class="leftAlign" lang="en">DOC NO</th>
							<th style="width: 25%;" lang="en" class="leftAlign">DATE</th>
							<th style="width: 20%;" lang="en" class="leftAlign last">
								AMT</th>
						</tr>
					</table>
					<div id="contentWrapper" class="tblFixedHeight routeitem">
						<table id="tblContent" cellpadding="0" cellspacing="0" border="2" width="100%">
							<tr style="height:0px !important">
								<td style="width: 10%;"></td>
								<td style="width: 20%;"></td>
								<td style="width: 25%;"></td>
								<td style="width: 25%;"></td>
								<td style="width: 20%;"></td>
							</tr>
						</table>
					</div>
				</div>
				<!--<div class="textBar">
                        <table cellpadding="2" cellspacing="2" border="0" width="100%">
                            
                            <tr>
                                <td colspan=2 id="txtname" class="readonly_text" style="color:#A7A7A7;background-color:#EBF5FA;">
                                    
                                </td>
                            </tr>
                            </table>
                        </div>-->
				<div class="tblBox" id="divimagebox"
					style="display: none; float: left; padding: 10px; width: 96%">
					<div id="Gallery" style="float: left; overflow: auto; width: 100%"
						class="tblFixedHeight"></div>
				</div>
				<div class="row">					
						<div class="col-4">
							<div id="divSale" class="card card-lg bg-info text-center shadow p-3 mb-5 rounded" style="width:100%;height:120px">
			                	<a href="#" onclick="SendDataS()" rel="external" id="A2" style="height:100%;margin-top:20px">
			                    <img class="bottomicon" src="../images/upload-data.png" alt="sync" />
			                    <h4 class="text-white">SALE</h4>
			                    </a>
			                </div> 
						</div>
						<div class="col-4">
							<div id="divColl" class="card card-lg bg-info text-center shadow p-3 mb-5 rounded" style="width:100%;height:120px">
		                        <a href="#" onclick="SendDataC()" rel="external" id="A3" style="height:100%;margin-top:20px">
		                        <img class="bottomicon" src="../images/upload-data.png" alt="sync" />
		                        <h4 class="text-white">COLLECTION</h4>
		                        </a>
		                	</div> 
						</div>
						<div class="col-4">
							<div id="divInv" class="card card-lg bg-info text-center shadow p-3 mb-5 rounded" style="width:100%;height:120px">
			                    <a href="#" onclick="SendDataI()" rel="external" id="A4" style="height:100%;margin-top:20px" >
			                    <img class="bottomicon" src="../images/upload-data.png" alt="sync" />
			                    <h4 class="text-white">INVENTORY</h4>
			                    </a>
			                </div> 
						</div>
				</div>
				<div class="row">
					<div class="col-3"></div>
					<div class="col-4">
						<div class="card card-lg bg-success text-center" style="width:100%;height: 70px;">
		                	<a href="utilities.html" rel="external" >
		                    <img class="bottomicon" src="../images/icn-exit.png" alt="sync" />
		                            <h4 class="text-white">DONE</h4>
		                            </a>
		                        </div> 
					</div>
				</div>
					
			</div>
			
			
			
			
		</div>
		<div id="f1" data-role="footer" class="ui-bar">
			<div class="footer">
				<div class="leftfooter">09 November 2011</div>
				<div class="rightfooter">Mirnah Technology Systems</div>
			</div>
		</div>
		<div id="f2" data-role="footer" style="bottom: 0; position: absolute;">

			<aside data-pushbar-id="left" class="pushbar from_left">
				<div class="title">
					<span data-pushbar-close class="close push_right"></span> <span
						id="txtroute"></span>
				</div>

				<ul class="menu">
					<li style="margin-bottom: 0 !important;"><img title="" alt=""
						src="../images/startday-icon.png" id="day" class="leftmenu">
						<a href="#" class="ui-btn-active" rel="external" id="day"
						data-icon="custom" lang="en"
						onclick="footerredict('../startofday/startofday.html')">Start
							day</a></li>
					<li style="margin-bottom: 0 !important;"><img title="" alt=""
						src="../images/Inventoryicon.png" id="inve" class="leftmenu">
						<a href="#" id="inve" rel="external" data-icon="custom" lang="en"
						onclick="footerredict('../inventory/inventory.html')">Inventory</a></li>
					<li style="margin-bottom: 0 !important;"><img title="" alt=""
						src="../images/customer-icon.png" id="cust" class="leftmenu">
						<a href="#" rel="external" id="cust" data-icon="custom" lang="en"
						onclick="footerredict('../customer/customer_operation.html')">Customer</a></li>
					<li style="margin-bottom: 0 !important;"><img title="" alt=""
						src="../images/Money-icon.png" id="sett" class="leftmenu"> <a
						href="#" rel="external" id="sett" data-icon="custom" lang="en"
						onclick="footerredict('../settlement/managesettlement.html')">Settlement</a></li>
					<li style="margin-bottom: 0 !important;"><img title="" alt=""
						src="../images/expense-icon.png" id="expe" class="leftmenu">
						<a href="#" rel="external" id="expe" data-icon="custom" lang="en"
						onclick="footerredict('../settlement/expenseentry.html')">Expenses</a></li>
					<li style="margin-bottom: 0 !important;"><img title="" alt=""
						src="../images/information-icon.png" id="info" class="leftmenu">
						<a href="#" rel="external" id="info" data-icon="custom" lang="en"
						onclick="footerredict('../information/information.html')">Information</a></li>
					<li style="margin-bottom: 0 !important;"><img title="" alt=""
						src="../images/user-settings-icon.png" id="setup" class="leftmenu">
						<a href="#" rel="external" id="setup" data-icon="custom" lang="en"
						onclick="footerredict('../utilities/utilities.html')">Utilities</a></li>
				</ul>

			</aside>

			<div data-role="navbar" data-iconpos="top" data-grid="f">
				<ul>
					<li style="margin-bottom: 0 !important;"><a href="#"
						rel="external" id="day" data-icon="custom" lang="en"
						onclick="footerredict('../startofday/startofday.html')">Start
							day</a></li>
					<li style="margin-bottom: 0 !important;"><a href="#" id="inve"
						rel="external" data-icon="custom" lang="en"
						onclick="footerredict('../inventory/inventory.html')">Inventory</a></li>
					<li style="margin-bottom: 0 !important;"><a href="#"
						rel="external" id="cust" data-icon="custom" lang="en"
						onclick="footerredict('../customer/customer_operation.html')">Customer</a></li>
					<li style="margin-bottom: 0 !important;"><a href="#"
						rel="external" id="sett" data-icon="custom" lang="en"
						onclick="footerredict('../settlement/managesettlement.html')">Settlement</a></li>
					<li style="margin-bottom: 0 !important;"><a href="#"
						rel="external" id="expe" data-icon="custom" lang="en"
						onclick="footerredict('../settlement/expenseentry.html')">Expenses</a></li>
					<li style="margin-bottom: 0 !important;"><a href="#"
						rel="external" id="info" data-icon="custom" lang="en"
						onclick="footerredict('../information/information.html')">Information</a></li>
					<li style="margin-bottom: 0 !important; width: 14.0%"><a
						href="#" rel="external" id="setup" data-icon="custom" lang="en"
						onclick="footerredict('../utilities/utilities.html')"
						class="ui-btn-active">Utilities</a></li>
				</ul>
			</div>
		</div>
	</div>
	<script type="text/javascript" language="javascript">
		var data = null, index = 0;
		var dataRoutekey = new Array();
		var dataTranskey = new Array();
		var dataVisitkey = new Array();
		var countRecord = 0;
		var imgarr = {};
		var imgdata = null;
		window.lang = new jquery_lang_js();
		var cntupload;
		var currfilename;
		var elm;
		var fileName;
		var idx;
		var curridx = 0;
		var decimalplace;
		sessionStorage.setItem("backScreen", "");
		$("#tblContent").click(function() {
		});

		resizeOrientationWindow();
		$(document)
				.ready(
						function() {
							resizeWindow();

							//Set current date in footer
							$(".leftfooter").html(getCurrentDate());

							$('.ui-select .ui-btn-text').css({
								'text-align' : 'left',
								'color' : '#fff'
							});

							//Fetch current language and set that language.
							var lan = sessionStorage.getItem("Language");
							window.lang.run(lan);
							decimalplace = sessionStorage
									.getItem("decimalplace")
							document.addEventListener("deviceready",
									Updateinvoiceheadersyncstatus, false);
							// sujee added side bar ----------------- START ------------------------ 

							var pushbar = new Pushbar({
								blur : true,
								overlay : true,
							});
							$("#txtroute").text(
									"ROUTE #: "
											+ sessionStorage
													.getItem("RouteCode"));
							window.setInterval(function() {
								var randomColor = '#'
										+ ('000000' + Math.floor(
												Math.random() * 16777215)
												.toString(16)).slice(-6);
								$('#txtroute').css({
									'color' : randomColor,
								});
							}, 2000);
							//----------------------------- END -------------------------  
							$("#ddltransaction").change(function() {
								getTransactionList(this)
							});
							chkDocCount();
							//Table click event
							$("#tblContent tr")
									.live(
											'click',
											function() {
												$(this).toggleClass('clicked');
												index = $(this).index();
												var custname = data[index - 1][7];
												console.log(custname);
												$('#txtname').val(custname);
												if ($("#check_" + (index)).css(
														'display') == 'block') {
													$("#check_" + (index))
															.css(
																	{
																		"display" : "none"
																	});

													var removeRouteKey = eval(data[index - 1][4]);
													var removeTransKey = eval(data[index - 1][5]);
													var removeVisitkey = eval(data[index - 1][6]);

													dataRoutekey
															.splice(
																	$
																			.inArray(
																					removeRouteKey,
																					dataRoutekey),
																	1);
													dataTranskey
															.splice(
																	$
																			.inArray(
																					removeTransKey,
																					dataTranskey),
																	1);
													dataVisitkey
															.splice(
																	$
																			.inArray(
																					removeVisitkey,
																					dataVisitkey),
																	1);
													countRecord -= 1;
												} else {
													$("#check_" + (index))
															.css(
																	{
																		"display" : "block"
																	});

													dataRoutekey
															.push(eval(data[index - 1][4]));
													dataTranskey
															.push(eval(data[index - 1][5]));
													dataVisitkey
															.push(eval(data[index - 1][6]));
													countRecord += 1;

												}

											});

							//Check for current language and set css for that
							if (sessionStorage.getItem("Language") != "en") {
								window.lang.change('UploadData' + lan, lan);
								window.lang.change('Footer' + lan, lan);

								if (lan == "AR") {
									//Set html right alignment for arbic language
									$(".centerboxInvReq").attr("dir", "rtl");

									//Set header align               
									$('#Back_inner')
											.removeClass(
													'ui-btn-left ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
									$('#Back_inner')
											.addClass(
													'ui-btn-right ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
									$('#lang_inner')
											.removeClass(
													'ui-btn-right ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
									$('#lang_inner')
											.addClass(
													'ui-btn-left ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
								}
							} else {
								//Change current language to english
								window.lang.change('en', 'en');

								//Set html left alignment for english language
								$(".centerboxInvReq").attr("dir", "ltr");

								//Set header align               
								$('#Back_inner')
										.removeClass(
												'ui-btn-right ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
								$('#Back_inner')
										.addClass(
												'ui-btn-left ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
								$('#lang_inner')
										.removeClass(
												'ui-btn-left ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
								$('#lang_inner')
										.addClass(
												'ui-btn-right ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
							}

						});

		function chkDocCount()
		{
			platform = sessionStorage.getItem("platform");
			
			var selectquery=" select 'sale' type, count(distinct invoicenumber) docCount from invoiceheader join customermaster on customermaster.customercode=invoiceheader.customercode where invoiceheader.issync=0 and invoiceheader.istemp='false' union select 'colle' type, count(distinct invoicenumber) collCount from arheader join customermaster on customermaster.customercode=arheader.customercode where arheader.issync=0 union select 'INV' type, count( distinct documentnumber) as invCount  from inventorytransactionheader where issync=0 ";
			console.log("countsql "+selectquery);
			if (platform == 'Android') {
				
				window.plugins.DataBaseHelper.select(selectquery, function(
						result) {
					if(result.array != undefined){
						alert(platform);
					}else{
						alert("Undfined");
					}					
					
					
				}, function() {
					console.warn("Error calling plugin");
					console.log("WRONG");
				});
			}
		}
		
		function Updateinvoiceheadersyncstatus() {
			$('#ddltransaction').selectmenu('refresh', true);
			$('#ddltransaction').selectmenu('refresh');
			var Qry = "UPDATE invoiceheader SET issync = 0 where transactionkey in (select Distinct transactionkey from invoicedetail where issync=0)";

			if (platform == "iPad") {
				Cordova.exec(function(result) {
					// navigator.notification.alert("Save invoice rxd detail
					// record successfully");
				}, function(error) {
					navigator.notification
							.alert("Error save invoice rxd detail record");
				}, "PluginClass", "InsertUpdateMethod", [ Qry ]);
			} else if (platform == "Android") {
				window.plugins.DataBaseHelper.insert(Qry, function(result) {
					updateOrderSyncStatus();
				}, function() {
					console.warn("Error calling plugin");
				});
			}
		}
		function updateOrderSyncStatus() {

			var Qry = "UPDATE salesorderheader SET issync = 0 where transactionkey in (select Distinct transactionkey from salesorderdetail where issync=0)";

			if (platform == "iPad") {
				Cordova.exec(function(result) {

				}, function(error) {
					navigator.notification
							.alert("Error save invoice rxd detail record");
				}, "PluginClass", "InsertUpdateMethod", [ Qry ]);
			} else if (platform == "Android") {
				window.plugins.DataBaseHelper.insert(Qry, function(result) {

				}, function() {
					console.warn("Error calling plugin");
				});
			}

		}
		function getImages() {
			var Qry = "SELECT imagename,imagepath FROM customerimages WHERE routecode="
					+ sessionStorage.getItem("RouteCode") + " and  issync=0";
			console.log(Qry);
			if (platform == "iPad") {
				Cordova.exec(function(result) {
					BindImages(result);
				}, function(error) {
					navigator.notification.alert("Error in binding Images : "
							+ error);
				}, "PluginClass", "GetdataMethod", [ Qry ]);
			} else if (platform == "Android") {
				window.plugins.DataBaseHelper.select(Qry, function(result) {
					if (result.array != undefined) {
						var array = $.map(result.array, function(item, index) {
							return [ [ item.imagename, item.imagepath ] ];
						});
						BindImages(array);
					} else
						$("#Gallery").html("");
				}, function() {
					console.warn("Error calling plugin");
				});
			}
		}

		function BindImages(result) {
			try {
				imgdata = result;
				var r, cnt = 0;
				var c1;
				$("#Gallery").html("");
				var c = "";
				for (i = 0; i < result.length; i++) {
					console.log("result.length : " + result.length);
					c = "<div style='padding:5px;margin-left:15px;float:left;'>";
					c += "<a href='#' rel='external'><img src='" + result[i][1]
							+ "' id='img" + (i + 1)
							+ "' width='100' height='100' /></a>";
					c += "<div style='text-align:center;padding:5px'><img src='../images/check.png' class='unchk' id = 'chk_"
							+ (i + 1)
							+ "'  onclick='SelectImage(this)' idx='"
							+ i + "'/></div>";
					c += "</div>";
					$("#Gallery").append(c);
				}
				$(document).ready(function() {
					var elm = $("#Gallery a");
					console.log("A length : " + elm.length);
					console.log($("#Gallery").html());
					//var myPhotoSwipe = $("#Gallery a").photoSwipe({ enableMouseWheel: false , enableKeyboard: false });
				});

				$("#divimagebox").show();
				$("#selectall").show();
			} catch (ex) {
				alert(ex);
			}
		}

		function ClearTable(TBL) {
			$("#" + TBL + " tr:gt(0)").remove();
		}

		function SelectImage(selimg) {
			if ($(selimg).hasClass('unchk')) {
				$(selimg).removeClass('unchk').addClass('chk');
				$(selimg).attr("src", "../images/check-box.png");
			} else {
				$(selimg).removeClass('chk').addClass('unchk');
				$(selimg).attr("src", "../images/check.png");
			}
		}

		function SelectAll(obj) {
			if ($(obj).attr("src") == '../images/check.png') {
				$(obj).attr("src", "../images/check-box.png");
				$(".unchk").attr("src", "../images/check-box.png");
				$(".unchk").removeClass('unchk').addClass('chk');
			} else {
				$(obj).attr("src", "../images/check.png");
				$(".chk").attr("src", "../images/check.png");
				$(".chk").removeClass('chk').addClass('unchk');
			}
		}

		
		//adde by ARUN
		function SendDataS(){
			//alert('SALE');
			getTransactionList2(1);
			
		}
		function SendDataC(){
			//alert('COLLECTION');
			getTransactionList2(3);
			
		}
		function SendDataI(){
			//alert('INVENTORY');
			getTransactionList2(7);
			
		}
		function getTransactionList2(typeVal) {

			platform = sessionStorage.getItem("platform");
			//alert("TYpeval "+ typeVal);
			var selectquery = '';
			$("#divgrid").show();
			$("#divimagebox").hide();
			$("#selectall").hide();
			$("#chkall").attr("src", "../images/check.png");
			if (typeVal == 0) {
				
				selectquery = " select invoiceheader.customercode,invoicenumber,strftime('%d-%m-%Y',transactiondate) as transactiondate,totalinvoiceamount,routekey,transactionkey,visitkey,customername from invoiceheader join customermaster on customermaster.customercode=invoiceheader.customercode where invoiceheader.issync=0 and invoiceheader.istemp='false' union select arheader.customercode,invoicenumber,strftime('%d-%m-%Y',transactiondate) as transactiondate,totalinvoiceamount,routekey,transactionkey,visitkey,customername from arheader join customermaster on customermaster.customercode=arheader.customercode where arheader.issync=0 UNION select 0 as customercode,documentnumber as invoicenumber,strftime('%d-%m-%Y',transactiondate) as transactiondate,0 as totalinvoiceamount,routekey,inventorykey as transactionkey,detailkey as visitkey,0 as customername  from inventorytransactionheader where issync=0 ";
			} else if (typeVal == 1) //get invoice header transaction
			{
				selectquery = "select invoiceheader.customercode,invoicenumber,strftime('%d-%m-%Y',transactiondate) as transactiondate,totalinvoiceamount,routekey,transactionkey,visitkey,customername from invoiceheader join customermaster on customermaster.customercode=invoiceheader.customercode where invoiceheader.issync=0 and invoiceheader.istemp='false'";

			} else if (typeVal == 2) //get sales order header transaction
			{
				selectquery = "select salesorderheader.customercode,invoicenumber,strftime('%d-%m-%Y',transactiondate) as transactiondate,totalinvoiceamount,routekey,transactionkey,visitkey,customername from salesorderheader join customermaster on customermaster.customercode=salesorderheader.customercode where salesorderheader.issync=0 and salesorderheader.istemp='false' AND COALESCE(dexflag,0)=0";
			} else if (typeVal == 3) //get collection transaction 
			{
				selectquery = "select arheader.customercode,invoicenumber,strftime('%d-%m-%Y',transactiondate) as transactiondate,totalinvoiceamount,routekey,transactionkey,visitkey,customername from arheader join customermaster on customermaster.customercode=arheader.customercode where arheader.issync=0";
			} else if (typeVal == 4) //get payment transaction 
			{
				selectquery = "select arheader.customercode,invoicenumber,strftime('%d-%m-%Y',transactiondate) as transactiondate,totalinvoiceamount,routekey,transactionkey,visitkey,customername from arheader join customermaster on customermaster.customercode=arheader.customercode where arheader.issync=0 and advancepaymentflag = 1";
			} else if (typeVal == 5) //get survey,pos
			{
				selectquery = "select distinct customeroperationscontrol.customercode as customercode,0 as invoicenumber,customeroperationscontrol.visitstartdate as transactiondate,0 as totalinvoiceamount,customeroperationscontrol.routekey as routekey,0 as transactionkey,customeroperationscontrol.visitkey as visitkey,customername from customeroperationscontrol join surveyauditdetail on surveyauditdetail.routekey = customeroperationscontrol.routekey and surveyauditdetail.visitkey = customeroperationscontrol.visitkey join customermaster on customermaster.customercode=customeroperationscontrol.customercode where customeroperationscontrol.issync=0                    union select distinct customeroperationscontrol.customercode,0 as invoicenumber,customeroperationscontrol.visitstartdate as transactiondate,0 as totalinvoiceamount,customeroperationscontrol.routekey,0 as transactionkey,customeroperationscontrol.visitkey,customername from customeroperationscontrol join posequipmentchangedetail on posequipmentchangedetail.routekey = customeroperationscontrol.routekey and posequipmentchangedetail.visitkey = customeroperationscontrol.visitkey join customermaster on customermaster.customercode=customeroperationscontrol.customercode where customeroperationscontrol.issync=0 union SELECT DISTINCT customeroperationscontrol.customercode,0 AS invoicenumber,customeroperationscontrol.visitstartdate AS transactiondate,0 AS totalinvoiceamount,customeroperationscontrol.routekey,0 AS transactionkey,customeroperationscontrol.visitkey,customername FROM customeroperationscontrol JOIN customerinventorycheck ON customerinventorycheck.routekey = customeroperationscontrol.routekey AND customerinventorycheck.visitkey = customeroperationscontrol.visitkey JOIN customermaster ON  customermaster.customercode=customeroperationscontrol.customercode WHERE customeroperationscontrol.issync=0 union SELECT DISTINCT customeroperationscontrol.customercode,0 AS invoicenumber,customeroperationscontrol.visitstartdate AS transactiondate,0 AS totalinvoiceamount,customeroperationscontrol.routekey,0 AS transactionkey,customeroperationscontrol.visitkey,customername FROM customeroperationscontrol JOIN customerdistributioncheck ON customerdistributioncheck.routekey = customeroperationscontrol.routekey AND customerdistributioncheck.visitkey = customeroperationscontrol.visitkey JOIN customermaster ON customermaster.customercode=customeroperationscontrol.customercode WHERE customeroperationscontrol.issync=0 union SELECT DISTINCT customeroperationscontrol.customercode,0 AS invoicenumber,customeroperationscontrol.visitstartdate AS transactiondate,0 AS totalinvoiceamount,customeroperationscontrol.routekey,0 AS transactionkey,customeroperationscontrol.visitkey,customername FROM customeroperationscontrol JOIN visualsfeedback ON visualsfeedback.routekey = customeroperationscontrol.routekey AND visualsfeedback.visitkey = customeroperationscontrol.visitkey JOIN customermaster ON customermaster.customercode=customeroperationscontrol.customercode WHERE customeroperationscontrol.issync=0";
			} else if (typeVal == 6) //get others
			{
				selectquery = "select customeroperationscontrol.customercode,0 as invoicenumber,visitstartdate as transactiondate,0 as totalinvoiceamount,routekey,customeroperationscontrol.customercode as transactionkey,visitkey,customername from customeroperationscontrol join customermaster on customermaster.customercode=customeroperationscontrol.customercode where customeroperationscontrol.issync=0";
			} else if (typeVal == 7) //get inventory
			{
				selectquery = "select 0 as customercode,documentnumber as invoicenumber,strftime('%d-%m-%Y',transactiondate) as transactiondate,0 as totalinvoiceamount,routekey,inventorykey as transactionkey,detailkey as visitkey,0 as customername  from inventorytransactionheader where issync=0";
			} else if (typeVal == 8) {
				$("#divgrid").hide();
				getImages();
			}
			console.log("selectquery "+selectquery);
			if (platform == 'iPad') {

				Cordova.exec(function(result) {
					ClearTable();
					BindData(result);
				}, function(error) {
					navigator.notification
							.alert("Error in binding transaction list : "
									+ error);
				}, "PluginClass", "GetdataMethod", [ selectquery ]);
			} else if (platform == 'Android') {
				window.plugins.DataBaseHelper.select(selectquery, function(
						result) {
					ClearTable();
					var array = $.map(result.array, function(item, index) {

						return [ [ item.customercode, item.invoicenumber,
								item.transactiondate, item.totalinvoiceamount,
								item.routekey, item.transactionkey,
								item.visitkey, item.customername ] ];
					});

					data = array;
					BindData(data, typeVal);
					
				}, function() {
					console.warn("Error calling plugin");
				});
			}
		}
		
		//--end of added by arun
		
		
		
		function getTransactionList() {

			platform = sessionStorage.getItem("platform");

			var selectquery = '';
			$("#divgrid").show();
			$("#divimagebox").hide();
			$("#selectall").hide();
			$("#chkall").attr("src", "../images/check.png");
			if ($("#ddltransaction").val() == 0) {
				
				selectquery = " select invoiceheader.customercode,invoicenumber,strftime('%d-%m-%Y',transactiondate) as transactiondate,totalinvoiceamount,routekey,transactionkey,visitkey,customername from invoiceheader join customermaster on customermaster.customercode=invoiceheader.customercode where invoiceheader.issync=0 and invoiceheader.istemp='false' union select arheader.customercode,invoicenumber,strftime('%d-%m-%Y',transactiondate) as transactiondate,totalinvoiceamount,routekey,transactionkey,visitkey,customername from arheader join customermaster on customermaster.customercode=arheader.customercode where arheader.issync=0 UNION select 0 as customercode,documentnumber as invoicenumber,strftime('%d-%m-%Y',transactiondate) as transactiondate,0 as totalinvoiceamount,routekey,inventorykey as transactionkey,detailkey as visitkey,0 as customername  from inventorytransactionheader where issync=0 ";
			} else if ($("#ddltransaction").val() == 1) //get invoice header transaction
			{
				selectquery = "select invoiceheader.customercode,invoicenumber,strftime('%d-%m-%Y',transactiondate) as transactiondate,totalinvoiceamount,routekey,transactionkey,visitkey,customername from invoiceheader join customermaster on customermaster.customercode=invoiceheader.customercode where invoiceheader.issync=0 and invoiceheader.istemp='false'";

			} else if ($("#ddltransaction").val() == 2) //get sales order header transaction
			{
				selectquery = "select salesorderheader.customercode,invoicenumber,strftime('%d-%m-%Y',transactiondate) as transactiondate,totalinvoiceamount,routekey,transactionkey,visitkey,customername from salesorderheader join customermaster on customermaster.customercode=salesorderheader.customercode where salesorderheader.issync=0 and salesorderheader.istemp='false' AND COALESCE(dexflag,0)=0";
			} else if ($("#ddltransaction").val() == 3) //get collection transaction 
			{
				selectquery = "select arheader.customercode,invoicenumber,strftime('%d-%m-%Y',transactiondate) as transactiondate,totalinvoiceamount,routekey,transactionkey,visitkey,customername from arheader join customermaster on customermaster.customercode=arheader.customercode where arheader.issync=0";
			} else if ($("#ddltransaction").val() == 4) //get payment transaction 
			{
				selectquery = "select arheader.customercode,invoicenumber,strftime('%d-%m-%Y',transactiondate) as transactiondate,totalinvoiceamount,routekey,transactionkey,visitkey,customername from arheader join customermaster on customermaster.customercode=arheader.customercode where arheader.issync=0 and advancepaymentflag = 1";
			} else if ($("#ddltransaction").val() == 5) //get survey,pos
			{
				selectquery = "select distinct customeroperationscontrol.customercode as customercode,0 as invoicenumber,customeroperationscontrol.visitstartdate as transactiondate,0 as totalinvoiceamount,customeroperationscontrol.routekey as routekey,0 as transactionkey,customeroperationscontrol.visitkey as visitkey,customername from customeroperationscontrol join surveyauditdetail on surveyauditdetail.routekey = customeroperationscontrol.routekey and surveyauditdetail.visitkey = customeroperationscontrol.visitkey join customermaster on customermaster.customercode=customeroperationscontrol.customercode where customeroperationscontrol.issync=0                    union select distinct customeroperationscontrol.customercode,0 as invoicenumber,customeroperationscontrol.visitstartdate as transactiondate,0 as totalinvoiceamount,customeroperationscontrol.routekey,0 as transactionkey,customeroperationscontrol.visitkey,customername from customeroperationscontrol join posequipmentchangedetail on posequipmentchangedetail.routekey = customeroperationscontrol.routekey and posequipmentchangedetail.visitkey = customeroperationscontrol.visitkey join customermaster on customermaster.customercode=customeroperationscontrol.customercode where customeroperationscontrol.issync=0 union SELECT DISTINCT customeroperationscontrol.customercode,0 AS invoicenumber,customeroperationscontrol.visitstartdate AS transactiondate,0 AS totalinvoiceamount,customeroperationscontrol.routekey,0 AS transactionkey,customeroperationscontrol.visitkey,customername FROM customeroperationscontrol JOIN customerinventorycheck ON customerinventorycheck.routekey = customeroperationscontrol.routekey AND customerinventorycheck.visitkey = customeroperationscontrol.visitkey JOIN customermaster ON  customermaster.customercode=customeroperationscontrol.customercode WHERE customeroperationscontrol.issync=0 union SELECT DISTINCT customeroperationscontrol.customercode,0 AS invoicenumber,customeroperationscontrol.visitstartdate AS transactiondate,0 AS totalinvoiceamount,customeroperationscontrol.routekey,0 AS transactionkey,customeroperationscontrol.visitkey,customername FROM customeroperationscontrol JOIN customerdistributioncheck ON customerdistributioncheck.routekey = customeroperationscontrol.routekey AND customerdistributioncheck.visitkey = customeroperationscontrol.visitkey JOIN customermaster ON customermaster.customercode=customeroperationscontrol.customercode WHERE customeroperationscontrol.issync=0 union SELECT DISTINCT customeroperationscontrol.customercode,0 AS invoicenumber,customeroperationscontrol.visitstartdate AS transactiondate,0 AS totalinvoiceamount,customeroperationscontrol.routekey,0 AS transactionkey,customeroperationscontrol.visitkey,customername FROM customeroperationscontrol JOIN visualsfeedback ON visualsfeedback.routekey = customeroperationscontrol.routekey AND visualsfeedback.visitkey = customeroperationscontrol.visitkey JOIN customermaster ON customermaster.customercode=customeroperationscontrol.customercode WHERE customeroperationscontrol.issync=0";
			} else if ($("#ddltransaction").val() == 6) //get others
			{
				selectquery = "select customeroperationscontrol.customercode,0 as invoicenumber,visitstartdate as transactiondate,0 as totalinvoiceamount,routekey,customeroperationscontrol.customercode as transactionkey,visitkey,customername from customeroperationscontrol join customermaster on customermaster.customercode=customeroperationscontrol.customercode where customeroperationscontrol.issync=0";
			} else if ($("#ddltransaction").val() == 7) //get inventory
			{
				selectquery = "select 0 as customercode,documentnumber as invoicenumber,strftime('%d-%m-%Y',transactiondate) as transactiondate,0 as totalinvoiceamount,routekey,inventorykey as transactionkey,detailkey as visitkey,0 as customername  from inventorytransactionheader where issync=0";
			} else if ($("#ddltransaction").val() == 8) {
				$("#divgrid").hide();
				getImages();
			}
			console.log("selectquery "+selectquery);
			if (platform == 'iPad') {

				Cordova.exec(function(result) {
					ClearTable();
					BindData(result);
				}, function(error) {
					navigator.notification
							.alert("Error in binding transaction list : "
									+ error);
				}, "PluginClass", "GetdataMethod", [ selectquery ]);
			} else if (platform == 'Android') {
				window.plugins.DataBaseHelper.select(selectquery, function(
						result) {
					ClearTable();
					var array = $.map(result.array, function(item, index) {

						return [ [ item.customercode, item.invoicenumber,
								item.transactiondate, item.totalinvoiceamount,
								item.routekey, item.transactionkey,
								item.visitkey, item.customername ] ];
					});

					data = array;
					BindData(data);
				}, function() {
					console.warn("Error calling plugin");
				});
			}
		}

		//Bind data dynamically
		function BindData(result, typeVal) {

			var CellCount = $("#tblHeaderContent tr:eq(0) th").length;

			data = result;
			//alert(data.length);
			if(data.length <=0){
				alert("No Document To Upload");
			}
			for (i = 0; i < data.length; i++) {
				var r = "<tr class='contentFont'>";

				for (j = 1; j <= CellCount; j++) {
					var c = '';
					var temp = (j == 2) ? 'class = leftAlign'
							: "class = 'leftAlign last'";
					if (j == 1) {
						c = "<td>"
								+ "<img src='../images/check_1.png' height='25' id = check_"
								+ (i + 1) + " />" + "</td>";
					} else {
						if (j == 2 || j == 3) {
							data[i][j - 2] = parseInt(data[i][j - 2]);
						}

						if (j == 5) {
							data[i][j - 2] = eval(data[i][j - 2]).toFixed(
									decimalplace);
						}
						c = "<td " + temp + ">" + data[i][j - 2] + "</td>";
					}
					r += c;
				}
				r += "</tr>";

				$('#tblContent tbody').append(r);

				// ARUN added -> select all rows initially
				dataRoutekey.push(eval(data[i][4]));
				dataTranskey.push(eval(data[i][5]));
				dataVisitkey.push(eval(data[i][6]));
				countRecord += 1;

				//-----END-----------------------------------

			}

			//Select first row of table when screen load
			//$("#tblContent tr:eq(1)").trigger('click');

			//Set background for odd and even row.
			$("#tblContent tr:odd").addClass('oddRow');
			$("#tblContent tr:even").addClass('evenRow');
			//alert("In Bindata "+ typeVal);
			SendData(typeVal);
		}

		function ClearTable() {
			$("#tblContent tr:gt(0)").remove();
		}

		
		
		function SendData(typeVal) {
			//alert("In SendData "+ typeVal);
			if (countRecord > 0) {

				if (platform == 'iPad') {

					var selectquery = "select previousdayuploadflag from setup where setupid=1";
					var qry = "select routestartdate from startendday where routekey="
							+ sessionStorage.getItem("RouteKey");
					Cordova
							.exec(
									function(result) {
										if (result[0][0] == 0) {
											Cordova
													.exec(
															function(result) {
																if (eval(result[0][0]) < getTabletDate()) {
																	getLangText("You are not allow to previous day data upload");
																	return false;
																} else {
																	uploaddatas();
																}
															},
															function(error) {
																navigator.notification
																		.alert("Error in binding transaction list : "
																				+ error);
															}, "PluginClass",
															"GetdataMethod",
															[ qry ]);
										} else {
											uploaddatas();
										}
									},
									function(error) {
										navigator.notification
												.alert("Error in binding transaction list : "
														+ error);
									}, "PluginClass", "GetdataMethod",
									[ selectquery ]);
				} else if (platform == 'Android') {
					var selectquery = "select previousdayuploadflag from setup where setupid=1";
					var qry = "select routestartdate from startendday where routekey="
							+ sessionStorage.getItem("RouteKey");
					window.plugins.DataBaseHelper
							.select(
									selectquery,
									function(result) {
										if (result.array[0].previousdayuploadflag == 0) {
											window.plugins.DataBaseHelper
													.select(
															qry,
															function(result) {
																if (eval(result.array[0].routestartdate) < getTabletDate()) {
																	navigator.notification
																			.alert("You are not allow to previous day data upload");
																	return false;
																} else {
																	//alert("In sendData2 "+typeVal);
																	uploaddatas(typeVal);
																}
															},
															function() {
																console
																		.warn("Error calling plugin");
															});
										} else {
											//alert("In sendData3 "+typeVal);
											uploaddatas(typeVal);
										}
									}, function() {
										console.warn("Error calling plugin");
									});
				}

			} else {
				if ($("#ddltransaction").val() == 8) {
					getImagesToUpload();
				} else
					getLangText("Please Select A Transaction.");
				alert("No Document to Upload");
			}

		}
		function uploaddatas(typeVal) {
			//alert("In uploaddatas "+typeVal);
			dataRoutekey = $.unique(dataRoutekey);

			var dataRouteString = dataRoutekey.toString();

			var dataTransString = dataTranskey.toString();
			var datavisitString = dataVisitkey.toString();
			console.log(datavisitString);
			if (typeVal == 1) //get invoice header transaction
			//if ($("#ddltransaction").val() == 1)
			{

				var transkey = dataTransString.split(",");
				var visitkey = datavisitString.split(",");
				SimulateFunction(dataRouteString, transkey, visitkey, 'sale');

			} else if (typeVal == 2) {
				var transkey = dataTransString.split(",");
				var visitkey = datavisitString.split(",");
				SimulateFunction(dataRouteString, transkey, visitkey, 'order');

				/*  //Sales order detail data
				  getSendData(dataRouteString,dataTransString,"","salesorderdetail",false);
				  
				  //Sales order header data
				  getSendData(dataRouteString,dataTransString,"","salesorderheader",false);
				  
				//Sales order RXD data
				  getSendData(dataRouteString,dataTransString,"","orderrxddetail",false);
				  
				  
				  //promotiondetail data
				  getSendData(dataRouteString,datavisitString,"","promotiondetail",false);
				  
				  //signature data
				  getSendData(dataRouteString,datavisitString,"","sigcapturedata",false);
				  
				   //customerinventorydetail
				  getSendData(dataRouteString,datavisitString,"","customeroperationscontrol",false);
				  
				  //routesequencecustomerstatus
				  getSendData(dataRouteString,"","","routesequencecustomerstatus",false);
				  
				  //customermaster data
				  getSendData("","","","customermaster",true);*/

			} //else if ($("#ddltransaction").val() == 3) {
			else if (typeVal == 3) {
				var transkey = dataTransString.split(",");
				var visitkey = datavisitString.split(",");
				SimulateFunction(dataRouteString, transkey, visitkey, 'sale');
				//AR header data
				//getSendData("",dataTransString,"","arheader",false);

				//AR detail data
				//getSendData(dataRouteString,dataTransString,"","ardetail",false);
				//Invoice cash check data
				//getSendData(dataRouteString,datavisitString,"","cashcheckdetail",false);
				//customerinventorydetail
				// getSendData(dataRouteString,datavisitString,"","customeroperationscontrol",false);

				//routesequencecustomerstatus
				// getSendData(dataRouteString,"","","routesequencecustomerstatus",true);
			} else if (typeVal == 4) {
				var transkey = dataTransString.split(",");
				var visitkey = datavisitString.split(",");
				SimulateFunction(dataRouteString, transkey, visitkey, 'sale');
				//AR header data
				// getSendData("",dataTransString,"","arheader",false);

				//AR detail data
				// getSendData(dataRouteString,dataTransString,"","ardetail",false);

				//customer invoice data
				//getSendData(dataRouteString,dataTransString,"","customerinvoice",false);

				//Invoice cash check data
				// getSendData(dataRouteString,datavisitString,"","cashcheckdetail",false);

				//customerinventorydetail
				// getSendData(dataRouteString,datavisitString,"","customeroperationscontrol",false);

				//routesequencecustomerstatus
				//getSendData(dataRouteString,"","","routesequencecustomerstatus",true);
			} else if (typeVal == 5) {
				//survetauditdetail
				getSendData(dataRouteString, datavisitString, "",
						"surveyauditdetail", false);

				//customerinventorydetail
				getSendData(dataRouteString, datavisitString, "",
						"customeroperationscontrol", false);
				//pos data
				getSendData(dataRouteString, datavisitString, "",
						"posequipmentchangedetail", false);

				//pos data
				getSendData(dataRouteString, dataTransString, "", "posmaster",
						false);

				getSendData(dataRouteString, datavisitString, "",
						"customerinventorycheck", false);

				//routesequencecustomerstatus
				getSendData(dataRouteString, "", "",
						"routesequencecustomerstatus", true);
			} else if (typeVal == 6) {
				//customerinventorydetail
				getSendData(dataRouteString, dataTransString, "",
						"nosalesheader", false);
				//customerinventorydetail
				getSendData(dataRouteString, dataTransString, "",
						"nonservicedcustomer", false);
				//customerinventorydetail
				getSendData(dataRouteString, datavisitString, "",
						"customeroperationscontrol", false);

				//customerinventorydetail
				getSendData(dataRouteString, datavisitString, "",
						"customerinventorydetail", false);

				//routesequencecustomerstatus
				getSendData(dataRouteString, "", "",
						"routesequencecustomerstatus", true);

			} //else if ($("#ddltransaction").val() == 7) {
			else if (typeVal == 7) {
				//inventorytransaction header
				//getSendData(dataRouteString,datavisitString,"","inventorytransactionheader",false);

				//inventorytransactiondetail
				//getSendData(dataRouteString,datavisitString,"","inventorytransactiondetail",false);

				//inventorytransactiondetail
				//getSendData(dataRouteString,dataTransString,"","inventorysummarydetail",false);

				//routemaster
				//getSendData("","","","routemaster",false);

				//batchexpirydetail
				//getSendData(dataRouteString,0,"","batchexpirydetail",true);

				var transkey = dataTransString.split(",");
				var visitkey = datavisitString.split(",");
				SimulateFunction(dataRouteString, transkey, visitkey, 'inv');

			}
		}

		function getImagesToUpload() {
			try {
				if (imgdata != null && imgdata.length > 0) {
					elm = $(".chk");
					curridx = 0;
					cntupload = 0;
					cntupload = elm.length - 1;
					if (elm.length > 0) {
						CallImageUpload();
					} else
						getLangText("Please Select Image.");
				} else
					getLangText("No Images To Upload.");
			} catch (ex) {
				alert(ex);
			}
		}

		function CallImageUpload() {
			idx = $(elm[curridx]).attr("idx");
			fileName = imgdata[idx][0];
			filePath = imgdata[idx][1];
			filePath2 = filePath;
			UploadImages(fileName, filePath);
		}

		function refreshTable() {
			data = null;
			index = 0;
			dataRoutekey = new Array();
			dataTranskey = new Array();
			dataVisitkey = new Array();
			countRecord = 0;
			getTransactionList();
		}

		function gotFS1(fileSystem) {

			fileSystem.root.getFile(filePath2, null, gotFileEntry, fail);

		}
		function fail(evt) {
			console.log(evt.target.error.code);
		}
		function gotFileEntry(fileEntry) {
			fileEntry.file(gotFile, fail);
		}

		function gotFile(file) {
			readDataUrl(file);

		}

		function readDataUrl(file) {
			var reader = new FileReader();
			reader.onloadend = function(evt) {
				console.log("Read as data URL");
				var imagedata = evt.target.result;
				console.log(imagedata);
				$
						.ajax({
							type : "post",
							url : "http://mpfuae.dyndns.org:8095/sfa/modernpoultry/api/image/upload",
							data : {
								myfile : imagedata
							},
							crossDomain : true,
							cache : false,
							timeout : 10000,
							success : function(data) {
								console.log("data" + data);
							}
						});
			};
			reader.readAsDataURL(file);
		}
		function UploadImages(fileName, filePath) {

			//filePath = "file://localhost"+filePath;
			console.log("filepath : " + filePath);
			currfilename = fileName;
			var options = new FileUploadOptions();
			options.fileKey = "file";
			options.fileName = fileName;
			options.mimeType = "image/jpeg";

			var params = new Object();
			params.value1 = "test";
			params.value2 = "param";

			//	options.params = params;
			options.chunkedMode = false;
			var ft = new FileTransfer();
			var url = wsurl + "image/upload"
			ft.upload(filePath, url, win, fail, options, true);
			//ft.upload(filePath, "https://rp-bo-qa.alghanim.com/sfa/routepro_qlty/api/image/upload", win, fail, options,true);

		}
		function onFail(message) {
			alert('Failed because: ' + message);
		}
		function win(r) {
			console.log("Code = " + r.responseCode);
			console.log("Response = " + r.response);
			console.log("Sent = " + r.bytesSent);
			var Qry = "UPDATE customerimages SET issync= 1 WHERE imagename = '"
					+ currfilename + "'";
			if (platform == "iPad") {
				Cordova.exec(function(result) {
					UpdateImageSuccess();
				}, function(error) {
					navigator.notification.alert(error);
				}, "PluginClass", "InsertUpdateMethod", [ Qry ]);
			} else if (platform == "Android") {
				window.plugins.DataBaseHelper.insert(Qry, function(result) {
					UpdateImageSuccess();
				}, function() {
					console.warn("Error calling plugin");
				});
			}

		}

		var tblcustomerimage = {};
		function UpdateImageSuccess() {

			if (cntupload == 0) {
				/*navigator.notification.alert("Images Uploaded Successfully.");
				DeleteImages();*/
				var qry = "SELECT imagename,customercode,imageno,imagepath,routecode,routekey,transactiondate,transactiontime,visitkey,issync FROM customerimages WHERE issync = 1";
				if (platform == "iPad") {
					Cordova.exec(function(result) {
						if (result != '')
							tblcustomerimage = result;
						UploadImageData();
					}, function(error) {
						navigator.notification.alert(error);
					}, "PluginClass", "GetfielddataMethod", [ qry ]);
				} else if (platform == "Android") {
					window.plugins.DataBaseHelper.select(qry, function(result) {
						if (!$.isEmptyObject(result)) {
							for (i = 0; i < result.array.length; i++) {
								tblcustomerimage[i] = result.array[i];
							}
						}
						tblcustomerimage = JSON.stringify(tblcustomerimage);
						console.log("customerimage : " + tblcustomerimage);
						UploadImageData();
					}, function() {
						console.warn("Error calling plugin");
					});
				}
			} else {
				if (curridx < elm.length - 1) {
					cntupload = cntupload - 1;
					curridx = curridx + 1;
					CallImageUpload();
				}
			}
		}

		function UploadImageData() {
			//url: wsurl + "sync/senddata",
			try {
				$.ajax({
					type : "post",
					url : wsurl + "sync/senddata",
					data : {
						customerimages : tblcustomerimage
					},
					cache : false,
					timeout : 10000,
					success : function(data) {
						getLangText("Images Uploaded Successfully.");
						//DeleteImages();
						getImages();
					},
					error : function(qXHR, textStatus, errorThrown) {
						alert("failure: " + qXHR.status + ":" + textStatus
								+ errorThrown);
					}
				});
			} catch (ex) {
				alert(ex);
			}
		}

		function fail(error) {
			alert("An error has occurred: Code = " + error.code);
			console.log("upload error source " + error.source);
			console.log("upload error target " + error.target);
		}

		function DeleteImages() {
			try {
				var elm = $(".chk");
				var filePath = "";
				var idx;
				if (elm.length > 0) {
					/*for(i=0;i<elm.length;i++)
					{
					    idx = $(elm[i]).attr("idx");
					    fileName = imgdata[idx][0];                        
					    DeleteImageByName(fileName);
					}*/
					DeleteImageByName(elm, 0)
				} else
					getLangText("Please Select Image.");
			} catch (ex) {
				alert(ex);
			}
		}

		function DeleteImageByName(elm, i) {
			var idx = $(elm[i]).attr("idx");
			var fileName = imgdata[idx][0];
			try {
				var Qry = "DELETE FROM customerimages WHERE imagename='"
						+ fileName + "'";
				console.log(Qry);
				if (platform == "iPad") {
					Cordova.exec(function(result) {
						if (i + 1 < elm.length)
							DeleteImageByName(elm, i + 1);

						console.log(i + " : " + (elm.length - 1));
						if (i == (elm.length - 1)) {
							getImages();
						}
					}, function(error) {
						navigator.notification.alert(error);
					}, "PluginClass", "InsertUpdateMethod", [ Qry ]);
				} else if (platform == "Android") {
					window.plugins.DataBaseHelper.insert(Qry, function(result) {
						if (i + 1 < elm.length)
							DeleteImageByName(elm, i + 1);

						console.log(i + " : " + (elm.length - 1));
						if (i == (elm.length - 1)) {
							getImages();
						}
					}, function() {
						console.warn("Error calling plugin");
					});
				}
			} catch (ex) {
				alert(ex);
			}
		}
	</script>

</body>
</html>
