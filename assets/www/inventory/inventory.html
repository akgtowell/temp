<!--
 '  Created By   : Pratik Raval
 '  Created Date : 09/03/2012
 '  Description  : This page is used for inventory screen.
-->
<!DOCTYPE html>
<html>
<head>
<title>Inventory</title>
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1.0;maximum-scale=1.0;user-scalable=0; target-densitydpi=device-dpi">

<meta name="format-detection" content="telephone=no">
<link rel="stylesheet" href="../css/style.css" />
<link rel="stylesheet" href="../css/en.css" lang="en" />
<link rel="stylesheet" href="../css/jquery.mobile-1.0.min.css" />
<link rel="stylesheet"
	media="only screen and (min-width: 1200px) and (max-width: 1500px)"
	href="../css/style_1400.css">
<link rel="stylesheet"
	media="only screen and (min-width: 1000px) and (max-width: 1200px)"
	href="../css/style_1200.css">
<link rel="stylesheet"
	media="only screen and (min-width: 700px) and (max-width: 800px)"
	href="../css/style_800.css">
<!-- <link rel="stylesheet"
	media="only screen and (min-width: 600px) and (max-width: 700px)"
	href="../css/style_700.css">
<link rel="stylesheet"
	media="only screen and (min-width: 320px) and (max-width: 600px)"
	href="../css/style_600.css"> -->
	 <link rel="stylesheet"
	media="only screen and (min-height: 0px) and (max-height: 576px)"
	href="../css/style_480.css"> 
 <link rel="stylesheet"
	media="only screen and (min-width: 360px) and (max-width: 479px)"
	href="../css/style_600.css">
<link rel="stylesheet" href="css/style.css">

<link rel="stylesheet" href="../css/boostrap/css/bStyle.css"/>
        <link rel="stylesheet" href="../css/boostrap/css/bootstrap.min.css"/>
        <link rel="stylesheet" href="../css/boostrap/css/bootstrap-grid.css"/>
        <link rel="stylesheet" href="../css/boostrap/css/bootstrap-grid.min.css"/>
        <link rel="stylesheet" href="../css/boostrap/css/bootstrap.css"/>


<script type="text/javascript" src="../js/jquery.js"></script>

<script type="text/javascript" src="../js/jquery.mobile-1.0.js"></script>

<script type="text/javascript" src="../js/common.js"></script>
<script type="text/javascript" src="../js/batch.js"></script>
<script>
if (navigator.userAgent.toLowerCase().match(/android/)) {
document.write('<script charset="utf-8" src="../cordova-2.0.0.js"><\/script>');
document.write('<script charset="utf-8" src="../directoryListing.js"><\/script>');
} else if (navigator.userAgent.toLowerCase().match(/iphone/) || navigator.userAgent.toLowerCase().match(/ipad/)) {
document.write('<script charset="utf-8" src="../cordova-1.5.0.js"><\/script>');
}
</script>
<script type="text/javascript" src="../js/jquery.json-2.3.min.js"></script>

<script src="../LangJS/jquery-lang.js" charset="utf-8"
	type="text/javascript"></script>

<script src="../LangJS/langpack/AR.js" charset="utf-8"
	type="text/javascript" lang="en"></script>

<link rel="stylesheet" type="text/css"
	href="../css/jquery.mobile.simpledialog.css" />

<script type="text/javascript" src="../js/jquery.mobile.simpledialog.js"></script>
<!-- SCRIPT FOR PUSHBAR -->
        <link rel="stylesheet" type="text/css" href="../pushbar/milligram.css">
    		<link rel="stylesheet" type="text/css" href="../pushbar/normalize.css">
    	<link rel="stylesheet" type="text/css" href="../pushbar/pushbar.css">
    		<link rel="stylesheet" type="text/css" href="../pushbar/demo.css">
    	<script type="text/javascript" src="../pushbar/pushbar.js"></script>
</head>
<body>
	<div data-role="page" data-theme="d" data-title="Inventory" id="myPage">
		<div>
			<img title="" alt="" src="../images/bg.png" id="background">
		</div>
		<div data-role="header" data-position="inline" id="bgclheader">
			                           	<div class="wrapper">
			<div class="card_content">
				<div>
<!-- 				<button data-pushbar-target="left"  src="../images/icons8-menu-50.png" >Left pushbar</button> -->
				 <img title="" alt="" data-pushbar-target="left"  src="../images/icons8-menu-50.png" id="setting">
				 </div>
			</div>
	</div> 
			<a id="Back_inner" href="../home/home.html" rel="external" lang="en">Back</a>
			<h1 lang="en">Inventory</h1>
			<a href="#" id="lang_inner">EN</a><input value='' />
		</div>
		<div data-role="content" class="centerbox" id="test1">
			<div class="crad border-success">
				<div class="row">
					<div class="col-6">
						<div class="card shadow bg-info text-center" style="height: 150px;">
							<a href="#" id="lnkLoad" rel="external" onclick="PopupPasswordEntry(this.id,'loadselection.html',tblPassword.innerHTML,'inventory.html');">
								<img src="../images/load.png" class="center-block" style="width: 50%;top:10px" />
								<p class="text-white" style="font-size:16px">LOAD</p>
							</a>
						</div>											
					</div>
					<div class="col-6">
						<div class="card shadow bg-info text-center" style="height: 150px;">
							<a href="#" id="lnkUnload" rel="external" onclick="checkOnHoldOrders();">
								<img src="../images/unload.png" class="center-block" style="width: 50%;top:10px" />
								<p class="text-white" style="font-size:16px">UNLOAD</p>
							</a>
						</div>											
					</div>
					
				</div>
				<div class="row">
					<div class="col-6">
						<div class="card shadow bg-info text-center" style="height: 150px;">
							<a href="#" id="lnkLoadTransfer" rel="external" onclick="PopupPasswordEntry(this.id,'loadtransfer.html',tblPasswordTransfer.innerHTML,'inventory.html');">
								<img src="../images/loadtransfer.png" class="center-block" style="width: 50%;top:10px" />
								<p class="text-white" style="font-size:16px">LOAD TRANSFER</p>
							</a>
						</div>											
					</div>
					<div class="col-6">
						<div class="card shadow bg-info text-center" style="height: 150px;">
							<a href="#" id="lnkLoadRequest" rel="external" onclick="PopupPasswordEntry(this.id,'requestselection.html',tblPasswordLoadRequest.innerHTML,'inventory.html');">
								<img src="../images/icn-3.png" class="center-block" style="width: 50%;top:10px" />
								<p class="text-white" style="font-size:16px">LOAD REQUEST</p>
							</a>
						</div>											
					</div>
					
				</div>
				<div class="row">
					<div class="col-6">
						<div class="card shadow bg-info text-center" style="height: 150px;">
							<a href="#" rel="external" id="lnkVanStock" onclick="PopupPasswordEntry(this.id,'routeinventory.html',tblPasswordVanStock.innerHTML,'inventory.html');">
								<img src="../images/vanstock.png" class="center-block" style="width: 50%;top:10px" />
								<p class="text-white" style="font-size:16px">VAN STOCK</p>
							</a>
						</div>											
					</div>
					<div class="col-6">
																
					</div>
					
				</div>
			</div>
			
<!-- 			<div class="second-primary"> -->
<!--                 <ul data-role="listview"> -->
<!--                     <li><a href="../review/warehousestock.html" rel="external"> -->
<!--                         <img src="../images/icn-warehouse.png" class="HomeIconPosEN" /> -->
<!--                         <h3 id="H7" lang="en"> -->
<!--                             Warehouse Stock</h3> -->
<!--                     </a></li> -->
<!--                 </ul> -->
<!--             </div> -->
<!-- 			<div class="content-primary"> -->
<!-- 				<ul data-role="listview" id="MenuList"> -->
<!-- 					<li><a href="../home/home.html" id="simplestring" -->
<!-- 						style="text-decoration: none" data-role="none" rel="external"> -->
<!-- 							<img src="../images/info-8.png" class="HomeIconPosEN" /> -->
<!-- 							<h3 id="lblInformation" lang="en">Exit</h3> -->
<!-- 					</a></li> -->
<!-- 				</ul> -->
<!-- 			</div> -->
		</div>
		<div id="f1" data-role="footer" class="ui-bar">
			<div class="footer">
				<div class="leftfooter">09 November 2011</div>
				<div class="rightfooter">Mirnah Technology Systems</div>
			</div>
		</div>
		<div id="f2" data-role="footer"
			style="bottom: 0; position: absolute; z-index: 5;">
			 <aside data-pushbar-id="left" class="pushbar from_left">
		<div class="title"><span data-pushbar-close class="close push_right"></span>
			<span id="txtroute"></span>
		</div>

		<ul class="menu">
		<li style="margin-bottom: 0 !important;" > 
		<img title="" alt="" src="../images/startday-icon.png" id="day"  class="leftmenu" >
		 <a href="#"
						class="ui-btn-active" rel="external" id="day" data-icon="custom"  
						lang="en" onclick="footerredict('../startofday/startofday.html')">Start day</a></li>
					<li style="margin-bottom: 0 !important;">
					 <img title="" alt="" src="../images/Inventoryicon.png" id="inve"  class="leftmenu">
					 <a href="#" id="inve"
						rel="external" data-icon="custom" lang="en"
						onclick="footerredict('../inventory/inventory.html')">Inventory</a></li>
					<li style="margin-bottom: 0 !important;">
					 <img title="" alt="" src="../images/customer-icon.png" id="cust" class="leftmenu">
					 <a href="#"
						rel="external" id="cust" data-icon="custom" lang="en"
						onclick="footerredict('../customer/customer_operation.html')">Customer</a></li>
					<li style="margin-bottom: 0 !important;">
					<img title="" alt="" src="../images/Money-icon.png" id="sett" class="leftmenu">
					<a href="#"
						rel="external" id="sett" data-icon="custom" lang="en"
						onclick="footerredict('../settlement/managesettlement.html')">Settlement</a></li>
					<li style="margin-bottom: 0 !important;">
					<img title="" alt="" src="../images/expense-icon.png" id="expe" class="leftmenu">
					<a href="#"
						rel="external" id="expe" data-icon="custom" lang="en"
						onclick="footerredict('../settlement/expenseentry.html')">Expenses</a></li>
					<li style="margin-bottom: 0 !important;">
					<img title="" alt="" src="../images/information-icon.png" id="info" class="leftmenu" >
					<a href="#"
						rel="external" id="info" data-icon="custom" lang="en"  
						onclick="footerredict('../information/information.html')">Information</a></li>
					<li style="margin-bottom: 0 !important; ">
					 <img title="" alt="" src="../images/user-settings-icon.png" id="setup" class="leftmenu">
					 <a href="#" rel="external" id="setup" data-icon="custom" lang="en"
						onclick="footerredict('../utilities/utilities.html')">Utilities</a></li>
		</ul>

	</aside>
			<div data-role="navbar" data-iconpos="top" data-grid="f">
				<ul>
					<li style="margin-bottom: 0 !important;"><a href="#"
						rel="external" id="day" data-icon="custom" lang="en"
						onclick="footerredict('../startofday/startofday.html')">Start day</a></li>
					<li style="margin-bottom: 0 !important;"><a href="#" id="inve"
						class="ui-btn-active" rel="external" data-icon="custom" lang="en">Inventory</a></li>
					<li style="margin-bottom: 0 !important;"><a href="#"
						rel="external" id="cust" data-icon="custom" lang="en"
						onclick="footerredict('../customer/customer_operation.html')">Customer</a></li>
					<li style="margin-bottom: 0 !important;"><a href="#"
						rel="external" id="sett" data-icon="custom" lang="en"
						onclick="footerredict('../settlement/managesettlement.html')">Settlement</a></li>
					<li style="margin-bottom: 0 !important;"><a href="#"
						rel="external" id="expe" data-icon="custom" lang="en"
						onclick="footerredict('../settlement/expenseentry.html')">Expenses</a></li>
					<li style="margin-bottom: 0 !important;"><a href="#"
						rel="external" id="info" data-icon="custom" lang="en"
						onclick="footerredict('../information/information.html')">Information</a></li>
					<li style="margin-bottom: 0 !important;width:14%;"><a
						href="#" rel="external" id="setup" data-icon="custom" lang="en"
						onclick="footerredict('../utilities/utilities.html')">Utilities</a></li>
				</ul>
			</div>
		</div>		
		<table id="tblPassword" border="0" cellpadding="2" cellspacing="0"
			width="100%;" style="display: none;">
			<tr>
				<th class="tblHeader captionLabel leftAlign popupTitle" colspan="2"
					lang="en">Password Entry</th>
			</tr>
			<tr class="popupRow">
				<td colspan="2">&nbsp;</td>
			</tr>
			<tr class="popupRow">
				<td colspan="2" colspan="2" class="popupSubTitle" lang="en">
					Load</td>
			</tr>
			<tr class="popupRow">
				<td colspan="2" lang="en" class="popupInfo">Please Enter The Security Password</td>
			</tr>
			<tr class="popupRow">
				<td colspan="2"><input id="txtPassword" type="tel" pattern="[0-9]*" value="" maxlength="10" class="textWidth textFont passwordCenter"
					 /> <label id="lblMessage" lang="en"
					style="display: none">Enter Correct Password</label></td>
			</tr>
			<tr class="popupRow">
				<td style="width: 50%;"><input id="btnSubmit" type="button"
					value="Submit"
					onclick="VerifyPassword('btnSubmit','loadselection.html',tblOdoMeter.innerHTML);"
					data-role="none" lang="en" /></td>
				<td style="width: 50%;"><input id="btnCancel" type="button"
					rel="close" value="Cancel" onclick="ClearPassword();"
					data-role="none" lang="en" /></td>
			</tr>
		</table>
		<table id="tblPasswordUnload" border="0" cellpadding="2"
			cellspacing="0" width="100%;" style="display: none;">
			<tr>
				<th class="tblHeader captionLabel leftAlign popupTitle" colspan="2"
					lang="en">Password Entry</th>
			</tr>
			<tr class="popupRow">
				<td colspan="2">&nbsp;</td>
			</tr>
			<tr class="popupRow">
				<td colspan="2" colspan="2" class="popupSubTitle" lang="en">
					Unload</td>
			</tr>
			<tr class="popupRow">
				<td colspan="2" lang="en" class="popupInfo">Please Enter The Security Password</td>
			</tr>
			<tr class="popupRow">
				<td colspan="2"><input id="txtPassword" type="tel" pattern="[0-9]*" value="" maxlength="10" class="textWidth textFont passwordCenter"
				/> <label id="lblMessage" lang="en"
					style="display: none">Enter Correct Password</label></td>
			</tr>
			<tr class="popupRow">
				<td style="width: 50%;"><input id="Button3" type="button"
					value="Submit"
					onclick="VerifyPassword('Button3','unload_option.html',tblOdoMeter.innerHTML);"
					data-role="none" lang="en" /></td>
				<td style="width: 50%;"><input id="Button4" type="button"
					rel="close" value="Cancel" onclick="ClearPassword();"
					data-role="none" lang="en" /></td>
			</tr>
		</table>
		<table id="tblPasswordTransfer" border="0" cellpadding="2"
			cellspacing="0" width="100%;" style="display: none;">
			<tr>
				<th class="tblHeader captionLabel leftAlign popupTitle" colspan="2"
					lang="en">Password Entry</th>
			</tr>
			<tr class="popupRow">
				<td colspan="2">&nbsp;</td>
			</tr>
			<tr class="popupRow">
				<td colspan="2" colspan="2" class="popupSubTitle" lang="en">
					Load Transfer</td>
			</tr>
			<tr class="popupRow">
				<td colspan="2" lang="en" class="popupInfo">Please Enter The Security Password</td>
			</tr>
			<tr class="popupRow">
				<td colspan="2"><input id="txtPassword" type="tel" pattern="[0-9]*" value="" maxlength="10" class="textWidth textFont passwordCenter"
					 /> <label id="lblMessage" lang="en"
					style="display: none">Enter Correct Password</label></td>
			</tr>
			<tr class="popupRow">
				<td style="width: 50%;"><input id="Button5" type="button"
					value="Submit"
					onclick="VerifyPassword('Button5','loadtransfer.html',tblOdoMeter.innerHTML);"
					data-role="none" lang="en" /></td>
				<td style="width: 50%;"><input id="Button6" type="button"
					rel="close" value="Cancel" onclick="ClearPassword();"
					data-role="none" lang="en" /></td>
			</tr>
		</table>
		<table id="tblPasswordLoadRequest" border="0" cellpadding="2"
			cellspacing="0" width="100%;" style="display: none;">
			<tr>
				<th class="tblHeader captionLabel leftAlign popupTitle" colspan="2"
					lang="en">Password Entry</th>
			</tr>
			<tr class="popupRow">
				<td colspan="2">&nbsp;</td>
			</tr>
			<tr class="popupRow">
				<td colspan="2" colspan="2" class="popupSubTitle" lang="en">
					Load Request</td>
			</tr>
			<tr class="popupRow">
				<td colspan="2" lang="en" class="popupInfo">Please Enter The Security Password</td>
			</tr>
			<tr class="popupRow">
				<td colspan="2"><input id="txtPassword" type="tel" pattern="[0-9]*"
					value="" maxlength="10" class="textWidth textFont passwordCenter"
				 /> <label id="lblMessage" lang="en"
					style="display: none">Enter Correct Password</label></td>
			</tr>
			<tr class="popupRow">
				<td style="width: 50%;"><input id="Button7" type="button"
					value="Submit"
					onclick="VerifyPassword('Button5','requestselection.html',tblOdoMeter.innerHTML);"
					data-role="none" lang="en" /></td>
				<td style="width: 50%;"><input id="Button8" type="button"
					rel="close" value="Cancel" onclick="ClearPassword();"
					data-role="none" lang="en" /></td>
			</tr>
		</table>
		<table id="tblPasswordVanStock" border="0" cellpadding="2"
			cellspacing="0" width="100%;" style="display: none;">
			<tr>
				<th class="tblHeader captionLabel leftAlign popupTitle" colspan="2"
					lang="en">Password Entry</th>
			</tr>
			<tr class="popupRow">
				<td colspan="2">&nbsp;</td>
			</tr>
			<tr class="popupRow">
				<td colspan="2" colspan="2" class="popupSubTitle" lang="en">
					Van Stock</td>
			</tr>
			<tr class="popupRow">
				<td colspan="2" lang="en" class="popupInfo">Please Enter The Security Password</td>
			</tr>
			<tr class="popupRow">
				<td colspan="2"><input id="txtPassword" type="tel" pattern="[0-9]*"
					value="" maxlength="10"  class="textWidth textFont passwordCenter"
				 /> <label id="lblMessage" lang="en"
					style="display: none">Enter Correct Password</label></td>
			</tr>
			<tr class="popupRow">
				<td style="width: 50%;"><input id="Button9" type="button"
					value="Submit"
					onclick="VerifyPassword('Button5','routeinventory.html',tblOdoMeter.innerHTML);"
					data-role="none" lang="en" /></td>
				<td style="width: 50%;"><input id="Button10" type="button"
					rel="close" value="Cancel" onclick="ClearPassword();"
					data-role="none" lang="en" /></td>
			</tr>
		</table>

		<table id="tblOdoMeter" border="0" cellpadding="2" cellspacing="0"
			width="100%" style="display: none;">
			<tr>
				<th class="tblHeader captionLabel leftAlign" colspan="2"
					style="font-weight: bold; font-size: 18px;" lang="en">Enter Odometer</th>
			</tr>
			<tr class="popupRow">
				<td colspan="2">&nbsp;</td>
			</tr>
			<tr class="popupRow">
				<td colspan="2"  class="captionLabel leftAlign textWidth passwordCenter">
					<div style="width: 100%; float: left">
						<div style="float: left;" lang="en">Last Reading: </div>
						<div style="float: left" id="lastreading"></div>
					</div>
				</td>
			</tr>
			<tr style="background-color: #EFF9FE;">
				<td colspan="2">
					<!--<input id="endodometer" type="tel" pattern="[0-9]*" maxlength="10" class="textWidthOdo textFont" style="margin: 10px;" />-->
					<input id="endodometer" type="tel" maxlength="10"
					class="textWidthOdo textFont" style="margin: 10px;" />
				</td>
			</tr>
			<tr style="background-color: #EFF9FE;">
				<td style="width: 50%;"><input id="Button1" lang="en"
					type="button" value="Ok" data-role="none" onclick="SaveOdometer();"
					lang="en" /></td>
				<td style="width: 50%;"><input id="Button2" type="button"
					value="Cancel" data-role="none" rel="close"
					onclick="ClearOdometer('inventory.html');" lang="en" /></td>
			</tr>
		</table>
	</div>

	<script type="text/javascript" language="javascript">
        window.lang = new jquery_lang_js();
         var platform=''; 
         var routekey='';
         var visitkey='';
        $(document).ready(function() {
                         
        // $("#myPage").live('pageinit', function() {
            $(".leftfooter").html(getCurrentDate());
            platform= sessionStorage.getItem("platform");
			routekey=sessionStorage.getItem("RouteKey");
            visitkey=sessionStorage.getItem("VisitrKey");
            document.addEventListener("deviceready", getSettings, false); 

            // sujee added side bar ----------------- START ------------------------ 
         	          var pushbar = new Pushbar({
         	      		blur:true,
         	      		overlay:true,
         	      	});
         	          $("#txtroute").text("ROUTE #: " + sessionStorage.getItem("RouteCode")); 
         	          window.setInterval(function(){
         	       		var randomColor = '#'+ ('000000' + Math.floor(Math.random()*16777215).toString(16)).slice(-6);
         	       		$('#txtroute').css({
         	         			'color' : randomColor,
         	       		});
         	     			}, 2000);
         	          
         	          //----------------------------- END -------------------------  
            var lan = sessionStorage.getItem("Language");
	    
            window.lang.run(lan);
           if (sessionStorage.getItem("Language")  != "en") 
           {
               
                window.lang.change('Inventory'+lan,lan);
                window.lang.change('Footer'+lan,lan);
                if(lan=="AR")
                {
                    $('#MenuList .ui-icon').removeClass('ui-icon-arrow-r');
                    $('#MenuList .ui-icon').addClass('ui-icon-arrow-r1');
                    $('#MenuList li.ui-btn').removeClass('ui-btn-icon-right');
                    $('#MenuList li.ui-btn').addClass('ui-btn-icon-left');
                    $('#Back_inner').removeClass('ui-btn-left ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
				    $('#Back_inner').addClass('ui-btn-right ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
				    $('#lang_inner').removeClass('ui-btn-right ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
				    $('#lang_inner').addClass('ui-btn-left ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
                }
		
            }
		    else
		    {
		    		window.lang.change('en','en');
		    		$('#MenuList .ui-icon').removeClass('ui-icon-arrow-r1');
	                $('#MenuList .ui-icon').addClass('ui-icon-arrow-r');
	                $('#MenuList li.ui-btn').removeClass('ui-btn-icon-left');
	                $('#MenuList li.ui-btn').addClass('ui-btn-icon-right');
					$('#Back_inner').removeClass('ui-btn-right ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
					$('#Back_inner').addClass('ui-btn-left ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
					$('#lang_inner').removeClass('ui-btn-left ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
					$('#lang_inner').addClass('ui-btn-right ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
		    }
           

           
        });

        function Exit() {
            window.location = '../home/home.html';
        }
        
        
        
        function getSettings()
        {
            // var Qry = "SELECT (SELECT transferinventoryflag FROM setup)
			// setting1,(SELECT enableloadtransfer from routemaster WHERE
			// routecode = " + sessionStorage.getItem("RouteCode") + ")
			// setting2,(SELECT autocalculateloadin from routemaster WHERE
			// routecode = " + sessionStorage.getItem("RouteCode") + ")
			// setting3,(SELECT max(detailkey) from inventorytransactionheader
			// WHERE routecode = " + sessionStorage.getItem("RouteCode") + " and
			// routekey="+sessionStorage.getItem("RouteKey")+" and
			// transactiontype=3) unloadsetting,(SELECT includeloadrequest from
			// routemaster WHERE routecode = " +
			// sessionStorage.getItem("RouteCode") + ") loadrequestsetting";
        	window.localStorage.setItem("urgentAuto",0);
        	 sessionStorage.setItem('isInsertflag', 0);
            var Qry="SELECT (SELECT transferinventoryflag FROM setup) setting1,(SELECT enableloadtransfer from routemaster WHERE routecode = " + sessionStorage.getItem("RouteCode") + ") setting2,(SELECT autocalculateloadin from routemaster WHERE routecode = " + sessionStorage.getItem("RouteCode") + ") setting3,(SELECT max(detailkey) from inventorytransactiondetail WHERE routekey="+sessionStorage.getItem("RouteKey")+" and transactiontypecode IN(5,6,7) and istemp='false')  unloadsetting,(SELECT includeloadrequest from routemaster WHERE routecode = " + sessionStorage.getItem("RouteCode") + ") loadrequestsetting,(select routestartodometer From startendday where routekey = "+ sessionStorage.getItem("RouteKey") + ") startodometer";
            //var Qry="SELECT (SELECT transferinventoryflag FROM setup) setting1, (SELECT enableloadtransfer from routemaster WHERE routecode = " + sessionStorage.getItem("routeCode") + ") setting2,(SELECT autocalculateloadin from routemaster WHERE routecode = " + sessionStorage.getItem("RouteCode") + ") setting3,(SELECT max(detailkey) from inventorytransactiondetail WHERE transactiontypecode IN(5,6,7))  unloadsetting,(SELECT includeloadrequest from routemaster WHERE routecode = " + sessionStorage.getItem("RouteCode") + ") loadrequestsetting,(select routestartodometer From startendday where routekey = "+ sessionStorage.getItem("RouteKey") + ") startodometer";
            console.log(Qry);
            if(platform == "iPad")
            {
                        Cordova.exec(function(result) {
                           if(result.length > 0)
                            {
                                if(result[0][0] == 0 || result[0][1] == 0 || result[0][3] !='')
                                {
                                    $("#lnkLoadTransfer").attr("href","#");
                                    $("#lnkLoadTransfer").attr("onclick","");
                                    $("#lnkLoadTransfer img").attr("src","../images/loadtransfer-gray.png");
                                    $("#lnkLoadTransfer h3").addClass('MenuGray');
                                }
                                if(result[0][2] == 0 || result[0][3] !='' )
                                {
                                      $("#lnkUnload").attr("href","#");
                                      $("#lnkUnload").attr("onclick","");
                                      $("#lnkUnload img").attr("src","../images/unload-gray.png");
                                      $("#lnkUnload h3").addClass('MenuGray');
                                }
                                 if(result[0][4] == 0 || result[0][3] !='' ) 
                                {
                                      $("#lnkLoadRequest").attr("href","#");
                                      $("#lnkLoadRequest").attr("onclick","");  
                                      $("#lnkLoadRequest img").attr("src","../images/loadrequest-gray.png");
                                      $("#lnkLoadRequest h3").addClass('MenuGray');
                                }
                                      if(result[0][3] !='' )
                                      {
                                      $("#lnkLoad").attr("href","#");
                                      $("#lnkLoad").attr("onclick","");
                                      $("#lnkLoad img").attr("src","../images/load-gray.png");
                                      $("#lnkLoad h3").addClass('MenuGray');
                                      }
                                      
                            }                       
                            getlastOdometer();
                            getLoadCount();
                        },
                        function(error) {
                            navigator.notification.alert(error);
                        },
                        "PluginClass",
                        "GetdataMethod",
                        [Qry]);
            }
            else if(platform == "Android")
            {
                window.plugins.DataBaseHelper.select(Qry, function(result) {
                	if(result.array != undefined)
                	{
                    result = $.map(result.array, function(item, index) {
                        return [[item.setting1, item.setting2, item.setting3, item.unloadsetting, item.loadrequestsetting,item.startodometer]];
                    });                    
                    if (result.length > 0) {
                        if (result[0][0] == 0 || result[0][1] == 0 || eval(result[0][3]) > 0) {
                            $("#lnkLoadTransfer").attr("href", "#");
                            $("#lnkLoadTransfer").attr("onclick", "");
                            $("#lnkLoadTransfer img").attr("src", "../images/loadtransfer-gray.png");
                            $("#lnkLoadTransfer h3").addClass('MenuGray');
                        }
                        if (result[0][2] == 0 || eval(result[0][3]) > 0) {
                            $("#lnkUnload").attr("href", "#");
                            $("#lnkUnload").attr("onclick", "");
                            $("#lnkUnload img").attr("src", "../images/unload-gray.png");
                            $("#lnkUnload h3").addClass('MenuGray');
                        }
                        if (result[0][4] == 0 || eval(result[0][3]) > 0) {
                            $("#lnkLoadRequest").attr("href", "#");
                            $("#lnkLoadRequest").attr("onclick", "");
                            $("#lnkLoadRequest img").attr("src", "../images/loadrequest-gray.png");
                            $("#lnkLoadRequest h3").addClass('MenuGray');
                        }
                        
                        if (result[0][3] != '' && eval(result[0][3]) > 0) {
                            $("#lnkLoad").attr("href", "#");
                            $("#lnkLoad").attr("onclick", "");
                            $("#lnkLoad img").attr("src", "../images/load-gray.png");
                            $("#lnkLoad h3").addClass('MenuGray');
                        }
                        if (result[0][5] != '' && eval(result[0][5]) > 0) {
                        	localStorage.lastreading =  parseInt(result[0][5]);
                        	$("#lastreading").text(parseInt(localStorage.lastreading));
                        }else{
                        	localStorage.lastreading = 0;
                        	$("#lastreading").text(parseInt(localStorage.lastreading));
                        	
                        }
						 
                    }
                    }  
                    
                    getLoadCount();
                },
                        function() {
                            console.warn("Error calling plugin");
                        });
            }
        }
        
        function getLoadCount()
        {
            var Qry = "Select (SELECT COUNT(*) FROM inventorytransactiondetail WHERE routekey=" + sessionStorage.getItem("RouteKey") + " AND istemp = 'false') as loadcount,(SELECT COUNT(*) FROM inventorytransactiondetail WHERE transactiontypecode = 12) as opening";
            if(platform == "iPad")
            {
                Cordova.exec(function(result) {                        
                              if(result[0][1]==0){
                              if(result[0][0] == 0)
                              {
                              $("#lnkUnload").attr("href","#");
                              $("#lnkUnload").attr("onclick","");
                              $("#lnkUnload img").attr("src","../images/unload-gray.png");
                              $("#lnkUnload h3").addClass('MenuGray');
                              
                             // $("#lnkLoadTransfer").attr("href","#");
                            // $("#lnkLoadTransfer").attr("onclick","");
                            // $("#lnkLoadTransfer
							// img").attr("src","../images/loadtransfer-gray.png");
                            // $("#lnkLoadTransfer h3").addClass('MenuGray');
                              
                              $("#lnkVanStock").attr("href","#");
                              $("#lnkVanStock").attr("onclick","");
                              $("#lnkVanStock img").attr("src","../images/vanstock-gray.png");
                              $("#lnkVanStock h3").addClass('MenuGray');
                              
                              $("#lnkLoadRequest").attr("href","#");
                              $("#lnkLoadRequest").attr("onclick","");
                              $("#lnkLoadRequest img").attr("src","../images/loadrequest-gray.png");
                              $("#lnkLoadRequest h3").addClass('MenuGray');
                              }
                              }
                              
                              getPassword();                     
                              },
                              function(error) {
                              navigator.notification.alert(error);
                              },
                              "PluginClass",
                              "GetdataMethod",
                              [Qry]);                
            }
            else if(platform == "Android")
            {                
                window.plugins.DataBaseHelper.select(Qry, function(result) {
                                                    if(result.array[0].opening == 0)
                                                     {
                                                     if(result.array[0].loadcount == 0)
                                                     {
                                                     $("#lnkUnload").attr("href","#");
                                                     $("#lnkUnload").attr("onclick","");
                                                     $("#lnkUnload img").attr("src","../images/unload-gray.png");
                                                     $("#lnkUnload h3").addClass('MenuGray');
                                                     
                                                    
                                                     $("#lnkVanStock").attr("href","#");
                                                     $("#lnkVanStock").attr("onclick","");
                                                     $("#lnkVanStock img").attr("src","../images/vanstock-gray.png");
                                                     $("#lnkVanStock h3").addClass('MenuGray');
                                                     
//                                                     $("#lnkLoadRequest").attr("href","#");
//                                                     $("#lnkLoadRequest").attr("onclick","");
//                                                     $("#lnkLoadRequest img").attr("src","../images/loadrequest-gray.png");
//                                                     $("#lnkLoadRequest h3").addClass('MenuGray');
                                                     }
                                                     }
                                                     
                                                     getPassword();                       
                                                     },
                                                     function() {
                                                     console.warn("Error calling plugin");
                                                     });
            }
        }
        
        // Function for get password
        function getPassword()
        {   
            if(localStorage.lastreading=='')
            localStorage.lastreading=0;
            $("#lastreading").text(parseInt(localStorage.lastreading));
            if(platform=='iPad')
		    {
            Cordova.exec(function(result) {                                             
                                       
                          if (result.length > 0) 
                          {
                            var i = result[0][0]; 
                            var j = result[0][7];
                            var k = result[0][9];
                            var l = result[0][6];
                            var m = result[0][10];
                            localStorage.LoadPassword = ((result[0][0] == 0) ? 0 : result[0][i]);
                            localStorage.LoadPassword2 = result[0][5];
                            localStorage.AdjustLoadPassword = result[0][6];
                            localStorage.UnloadPassword = ((result[0][7] == 0) ? 0 : result[0][j]);
                            localStorage.TransferPassword = ((result[0][9] == 0) ? 0 : result[0][k]);
                            localStorage.LoadRequestPassword = ((result[0][6] == 0) ? 0 : result[0][l]);
                            localStorage.VanStockPassword = ((result[0][10] == 0) ? 0 : result[0][m]);
                            console.log(result[0][8]);
                            if(eval(result[0][8]) == 0)
                                localStorage.enableodioinput = 0;
                            else
                                localStorage.enableodioinput = 1;
                          }
                          else {
                          localStorage.LoadPassword = "";
                          localStorage.LoadPassword2 = "";
                          localStorage.AdjustLoadPassword = "";
                          localStorage.UnloadPassword = "";
                          localStorage.enableodioinput ="";
                          localStorage.TransferPassword = "";
                          }
                                     // addbatchdata();
                                    },
                                    function(error) {
                                        alert("Error in getting Password : " + error);
                                    },
                                    "PluginClass", 
                                    "GetdataMethod", 
                                    ["select passwordarray12,password1,password2,password3,password4,password5,passwordarray15,passwordarray11,promptodominput,passwordarray14,passwordarray16 From routemaster where routecode = "+ sessionStorage.getItem('RouteCode') +""]);         
            }
            else if(platform=='Android')
           		{
	           		window.plugins.DataBaseHelper.select("select passwordarray12,password1,password2,password3,password4,password5,passwordarray15,passwordarray11,promptodominput,passwordarray14,passwordarray16 From routemaster where routecode = "+ sessionStorage.getItem('RouteCode') +"",function(result)
					{
					 	
		                    result = $.map(result.array, function (item, index) {
                
                				return [[item.passwordarray12, item.password1,item.password2,item.password3,item.password4,item.password5,item.passwordarray15,item.passwordarray11,item.promptodominput,item.passwordarray14,item.passwordarray16]];
            				});
		                    console.log("rer"+result);
                            if (result!='') 
                            {
		                        var i = result[0][0]; 
		                        var j = result[0][7]; 
		                        var k = result[0][9];
		                        var l = result[0][6];
		                        var m = result[0][10];
	                            localStorage.LoadPassword = ((result[0][0] == 0) ? 0 : result[0][i]);
	                            localStorage.LoadPassword2 = result[0][5];
	                            localStorage.AdjustLoadPassword = result[0][6];
	                            localStorage.UnloadPassword = ((result[0][7] == 0) ? 0 : result[0][j]);
	                            localStorage.TransferPassword = ((result[0][9] == 0) ? 0 : result[0][k]);
	                            localStorage.LoadRequestPassword = ((result[0][6] == 0) ? 0 : result[0][l]);
	                            localStorage.VanStockPassword = ((result[0][10] == 0) ? 0 : result[0][m]);
	                            if(eval(result[0][8]) == 0)
	                                localStorage.enableodioinput = 0;
	                            else
	                                localStorage.enableodioinput = 1;
                            }
                            else 
                            {
                            	  localStorage.LoadPassword = "";
		                          localStorage.LoadPassword2 = "";
		                          localStorage.AdjustLoadPassword = "";
		                          localStorage.UnloadPassword = "";
		                          localStorage.TransferPassword = "";
		                          localStorage.LoadRequestPassword = "";
		                          localStorage.VanStockPassword = "";
                           }
                           UpdateDocumentSequence();        
		                
					},
					function()
					{
				   	 console.warn("Error calling plugin");
					});
           		} 
            
        }
        
        function UpdateDocumentSequence(){
        	
        	var routecode=sessionStorage.getItem("RouteCode");
        	var selectQry="select (select bodocseq from routemaster where routecode="+routecode+") as bodseq,max(documentnumber) as maxdoc from (select documentnumber from invoiceheader union all select documentnumber from inventorytransactionheader union all select documentnumber from arheader union all select documentnumber from salesorderheader)";
        	
        	if (platform == "iPad") {
       		  
           	  
       	  	}
       	    else
       	    {
       	     window.plugins.DataBaseHelper.select(selectQry,function(result)
           		  {		
                             var array = $.map(result.array, function (item, index) {               
                               return [[item.maxdoc,item.bodseq]];
                             });
                             if(array!=undefined && array!=null){
                           	  var routecodelength=eval(routecode.length);
                           	  var docMAX=array[0][0];
                           	  var docSeq=array[0][1];
                           	  
                           	  var diffDoc=0;
                           	  if(docMAX!=undefined && docMAX!=0){
                           		  var acDocMax=parseInt(docMAX.substr(routecodelength,docMAX.length),10);
                           		
                           		  diffDoc=eval(acDocMax)-eval(docSeq);
                           		
                           		  if(diffDoc==null || diffDoc < 0 || diffDoc==undefined){
                           			 diffDoc=0;
                           			  
                           		  }
                           		  
                           	  }
                           	 
                           	  var updateQry = "UPDATE routemaster SET bodocseq = (ifnull(bodocseq,0) + "+diffDoc+") WHERE routecode=" + sessionStorage.getItem("RouteCode");
                           	  window.plugins.DataBaseHelper.insert(updateQry,function(result){   
                             		console.log("Updated document Successfully");
                             		CheckLoadStatus();
                           	  },
                           	  function()
                           	  {
                                    console.warn("Error calling plugin");
                           	  });   
                           	 
                             }
                         	                                                
 					  },
					  function()
					  {
					   	 console.warn("Error calling plugin");
					  });
       	     
       	    }
        	
        	
        	
        }
        
 		function CheckLoadStatus(){
 			var routeCode=sessionStorage.getItem("RouteCode");
 			var Qry="select (select Distinct loadperiodnumber From startingloaddetail where routecode=" + routeCode + " and strftime('%Y-%m-%d',ddate) = '" + getTabletDate() + "' and status = 1 order by loadperiodnumber) usedload,(select Distinct loadperiodnumber From startingloaddetail where routecode=" + routeCode + " and status = 0 order by loadperiodnumber Limit 1) nextload"
 			
 			console.log(Qry);
            if(platform == "iPad")
            {
                        Cordova.exec(function(result) {
                           if(result.length > 0)
                            {
                               
                                      
                            }                       
                          
                        },
                        function(error) {
                            navigator.notification.alert(error);
                        },
                        "PluginClass",
                        "GetdataMethod",
                        [Qry]);
            }
            else if(platform == "Android")
            {
                window.plugins.DataBaseHelper.select(Qry, function(result) {
                	if(result.array != undefined)
                	{
	                    result = $.map(result.array, function(item, index) {
	                        return [[item.usedload, item.nextload]];
	                    });                    
	                    if (result.length > 0) {
							 	
	                    	if(eval(result[0][0])>0 && eval(result[0][1])>0)
	                    	{
	                    		getLangText("Another Load Is Available To Process, Please Go To Load Section To Process Another Load");
	                    		
	                    	}
	                    }
                    }  
                    
                    
                },
                function() {
                    console.warn("Error calling plugin");
                });
            }
 			
 		}
 
        function addbatchdata()
        {
             var routecode=sessionStorage.getItem("RouteCode");
            
            if(platform=='iPad')
		    {
            return abc = Cordova.exec(function(result) {
                                       checkbatch(result);
                                       },
                                       function(error) {
                                       alert(error);},
                                       "PluginClass", 
                                       "GetdataMethod", 
                                       ["select batchnumber,expirydate,itemcode,cases,units,upc from startingloaddetail where routecode="+routecode]);
        	}
        	else if(platform=='Android')
           		{
	           		window.plugins.DataBaseHelper.select("select batchnumber,expirydate,itemcode,cases,units,upc from startingloaddetail where routecode="+routecode,function(result)
					{
					 	
		                    result = $.map(result.array, function (item, index) {
                
                				return [[item.batchnumber, item.expirydate,item.itemcode, item.cases,item.units, item.upc]];
            				});
		                 checkbatch(result);	
		                
					},
					function()
					{
				   	 console.warn("Error calling plugin");
					});
           		} 
        }
        function checkbatch(data)
        {
            if(platform=='iPad')
		    {
            return abc = Cordova.exec(function(result) {
                                       if(result!='')
                                       {
                                       insert_batchdetaildata(data,'insert');
                                       }
                                       else
                                       {
                                       insert_batchdetaildata(data,'update');
                                       }
                                       },
                                       function(error) {
                                       alert(error);},
                                       "PluginClass", 
                                       "GetdataMethod", 
                                       ["select batchnumber from batchexpirydetail where routekey="+routekey+" and visitkey="+visitkey+" and itemcode="+data[0][2]+" and batchnumber='"+data[0][0]+"'"]);
        	}
        	else if(platform=='Android')
           		{
	           		window.plugins.DataBaseHelper.select("select batchnumber from batchexpirydetail where routekey="+routekey+" and visitkey="+visitkey+" and itemcode="+data[0][2]+" and batchnumber='"+data[0][0]+"'",function(result)
					{
					 	
		                    result = $.map(result.array, function (item, index) {
                
                				return [[item.batchnumber]];
            				});
		               if(result!='')
                       {
                       insert_batchdetaildata(data,'insert');
                       }
                       else
                       {
                       insert_batchdetaildata(data,'update');
                       }	
		                
					},
					function()
					{
				   	 console.warn("Error calling plugin");
					});
           		} 
        }
        function insert_batchdetaildata(batchdata,flag)
        {
            console.log("batch");
            
            var cases = batchdata[0][3];
            var units = batchdata[0][4];
            var upc = batchdata[0][5];
            var qty = (cases*upc)+units;
            if(flag=="insert")
            {
                if(platform=='iPad')
		    	{
                return abc = Cordova.exec(function(result) {
                                           // alert(result);
                                           return true;
                                           },
                                           function(error) {
                                           alert(error);},
                                           "PluginClass", 
                                           "InsertUpdateMethod", 
                                           ["INSERT INTO `batchexpirydetail` ('routekey','batchnumber','itemcode','expirydate','quantity','visitkey')VALUES ("+routekey+",'"+batchdata[0][0] +"','"+batchdata[0][2] +"','"+batchdata[0][1] +"','"+qty +"',"+visitkey+")"]);
            	}
            	else if(platform=='Android')
           	  	{
	           		window.plugins.DataBaseHelper.insert("INSERT INTO `batchexpirydetail` ('routekey','batchnumber','itemcode','expirydate','quantity','visitkey')VALUES ("+routekey+",'"+batchdata[0][0] +"','"+batchdata[0][2] +"','"+batchdata[0][1] +"','"+qty +"',"+visitkey+")",function(result)
					{
					 	 return true;
					},
					function()
					{
				   	 console.warn("Error calling plugin");
					});
           	 	} 
            }else
            {
                if(platform=='iPad')
		    	{
                return abc = Cordova.exec(function(result) {
                                           // alert(result);
                                           return true;
                                           },
                                           function(error) {
                                           alert(error);},
                                           "PluginClass", 
                                           "InsertUpdateMethod", 
                                           ["update batchexpirydetail set expirydate='"+batchdata[0][1]+"',quantity='"+qty+"' where itemcode='"+batchdata[0][2]+"' and batchnumber='"+batchdata[0][0]+"'"]);
            	}
            	else if(platform=='Android')
           	  	{
	           		window.plugins.DataBaseHelper.insert("update batchexpirydetail set expirydate='"+batchdata[0][1]+"',quantity='"+qty+"' where itemcode='"+batchdata[0][2]+"' and batchnumber='"+batchdata[0][0]+"'",function(result)
					{
					 	 return true;
					},
					function()
					{
				   	 console.warn("Error calling plugin");
					});
           	 	} 
            }
            
        }
        function SaveOdometer()
        {
            var endodometer = $(".ui-simpledialog-container #endodometer").val();
             
            
            if(eval(endodometer) > 0)
            {
                if(platform=='iPad')
                {
                    console.log("select routestartodometer from startendday where routekey='"+sessionStorage.getItem("RouteKey")+"'");
                    return abc = Cordova.exec(function(result) {
                                               if(eval(result[0][0]) > eval(endodometer))
                                               {
                                               navigator.notification.alert("Enter Odometer Greater Than "+parseInt(result[0][0]));
                                               return false;
                                               }
                                               else
                                               {
                                               updatetransactiondetail();
                                               console.log("update startendday set routeendodometer='"+endodometer+"' where routekey='"+routekey+"'");
                                               return abc = Cordova.exec(function(result) {
                                                                          // alert(result);
                                                                          deletebatchmaster('unload_option.html');
                                                                          },
                                                                          function(error) {
                                                                          alert(error);},
                                                                          "PluginClass", 
                                                                          "InsertUpdateMethod", 
                                                                          ["update startendday set routeendodometer='"+endodometer+"' where routekey='"+routekey+"'"]);
                                               }
                                               
                                               },
                                               function(error) {
                                               alert(error);},
                                               "PluginClass", 
                                               "GetdataMethod", 
                                               ["select routestartodometer from startendday where routekey='"+sessionStorage.getItem("RouteKey")+"'"]);
                }
                else if(platform=='Android')
                {
                    window.plugins.DataBaseHelper.select("select routestartodometer from startendday where routekey='"+sessionStorage.getItem("RouteKey")+"'",function(result)
                                                         {
                                                         console.log(result.array[0].routestartodometer);
                                                         if(parseInt(endodometer)<=parseInt(result.array[0].routestartodometer))
                                                         {
                                                        	 navigator.notification.alert(getLangTextdata("Enter Odometer Grater Than")+parseInt(result.array[0].routestartodometer));
                                                         }
                                                         else
                                                         {
                                                         
                                                        	 		  window.plugins.DataBaseHelper.insert("update startendday set routeendodometer='"+endodometer+"' where routekey='"+routekey+"'",function(result)
	                                                                  {
                                                        	 			  	CheckLoadMessage('inventory',true);	
	                            	 										
	                                                                  },
	                                                                  function()
	                                                                  {
	                                                                  console.warn("Error calling plugin");
	                                                                  });
                                                         }
                                                         },
                                                         function()
                                                         {
                                                         console.warn("Error calling plugin");
                                                         });
                } 
              
        }
        else
        {
            getLangText("Enter Odometer Greater Than Zero.");
            return false;
        }
    }
	// ------21 May
	function endstockqtyupdate()
    {
       
        if(platform=='iPad')
        {
            return abc = Cordova.exec(function(result) {
                                       updatetransactiondetail();
                                       },
                                       function(error) {
                                       alert(error);},
                                       "PluginClass", 
                                       "InsertUpdateMethod", 
                                       ["UPDATE inventorysummarydetail SET endstockqty = (ifnull(beginstockqty,0)+ifnull(loadqty,0)+ifnull(loadaddqty,0)-ifnull(loadcutqty,0)-ifnull(saleqty,0)+ifnull(returnqty,0)-ifnull(freesampleqty,0)-ifnull(promoqty,0)+ifnull(returnfreeqty,0)-ifnull(rentqty,0))"]);
        }
        else if(platform=='Android')
        {
            window.plugins.DataBaseHelper.insert("UPDATE inventorysummarydetail SET endstockqty = (ifnull(beginstockqty,0)+ifnull(loadqty,0)+ifnull(loadaddqty,0)-ifnull(loadcutqty,0)-ifnull(saleqty,0)+ifnull(returnqty,0)-ifnull(freesampleqty,0)-ifnull(promoqty,0)+ifnull(returnfreeqty,0)-ifnull(rentqty,0))",function(result)
                                                 {
                                                 updatetransactiondetail();
                                                 },
                                                 function()
                                                 {
                                                 console.warn("Error calling plugin");
                                                 });
        } 
    }
	// ------
	// -----------------
	function Updateinventoryvalue() {
           
            var Qry ="UPDATE inventorysummarydetail SET saleqty = (SELECT IFNULL(SUM(IFNULL(id.salesqty,0)),0) FROM invoicedetail id JOIN invoiceheader ih ON ih.transactionkey=id.transactionkey Where inventorysummarydetail.routekey = id.routekey AND inventorysummarydetail.itemcode = id.itemcode AND id.istemp = 'false' AND ih.voidflag IS NOT 1), returnqty = (SELECT IFNULL(SUM(IFNULL(id.returnqty,0)),0) FROM invoicedetail id JOIN invoiceheader ih ON ih.transactionkey=id.transactionkey Where inventorysummarydetail.routekey = id.routekey AND inventorysummarydetail.itemcode = id.itemcode AND id.istemp = 'false' AND ih.voidflag IS NOT 1), returnfreeqty = (SELECT IFNULL(SUM(IFNULL(id.returnfreeqty,0)),0) FROM invoicedetail id  JOIN invoiceheader ih ON ih.transactionkey=id.transactionkey Where inventorysummarydetail.routekey = id.routekey AND inventorysummarydetail.itemcode = id.itemcode AND id.istemp = 'false' AND ih.voidflag IS NOT 1), damageqty = (SELECT IFNULL(SUM(IFNULL(id.damagedqty,0)),0) FROM invoicedetail id JOIN invoiceheader ih ON ih.transactionkey=id.transactionkey Where inventorysummarydetail.routekey = id.routekey AND inventorysummarydetail.itemcode = id.itemcode AND id.istemp = 'false' AND ih.voidflag IS NOT 1), expiryqty = (SELECT IFNULL(SUM(IFNULL(id.expiryqty,0)),0) FROM invoicedetail id JOIN invoiceheader ih ON ih.transactionkey=id.transactionkey Where inventorysummarydetail.routekey = id.routekey AND inventorysummarydetail.itemcode = id.itemcode AND id.istemp = 'false' AND ih.voidflag IS NOT 1),freesampleqty = (SELECT IFNULL(SUM(IFNULL(id.manualfreeqty,0)+IFNULL(id.freesampleqty,0)),0) FROM invoicedetail id JOIN invoiceheader ih ON ih.transactionkey=id.transactionkey Where inventorysummarydetail.routekey = id.routekey AND inventorysummarydetail.itemcode = id.itemcode AND id.istemp = 'false' AND ih.voidflag IS NOT 1),rentqty = (SELECT IFNULL(SUM(IFNULL(id.rebaterentqty,0)+IFNULL(id.fixedrentqty,0)),0) FROM invoicedetail id JOIN invoiceheader ih ON ih.transactionkey=id.transactionkey Where inventorysummarydetail.routekey = id.routekey AND inventorysummarydetail.itemcode = id.itemcode AND id.istemp = 'false' AND ih.voidflag IS NOT 1)";
            console.log(Qry);
            if(platform == "iPad")
            {
                Cordova.exec(function(result) {
                    // navigator.notification.alert("Save invoice rxd detail
					// record successfully");
                },
                function(error) {
                    navigator.notification.alert("Error save invoice rxd detail record");
                },
                "PluginClass",
                "InsertUpdateMethod",
                [Qry]);
            }
            else if(platform == "Android")
            {
                window.plugins.DataBaseHelper.insert(Qry, function(result) {
                     inserttransationdetail();
                },
                function() {
                    console.warn("Error calling plugin");
                });
            }
        }
	// --------------------
    function updatetransactiondetail()
    {
       
        if(platform=='iPad')
        {
            return abc = Cordova.exec(function(result) {
                                       Updateinventoryvalue();
                                       },
                                       function(error) {
                                       alert(error);},
                                       "PluginClass", 
                                       "InsertUpdateMethod", 
                                       ["delete from transactiondetailtemp"]);
        }
        else if(platform=='Android')
        {
		
            window.plugins.DataBaseHelper.insert("delete from transactiondetailtemp",function(result)
                                                 {
                                                 Updateinventoryvalue();
                                                 },
                                                 function()
                                                 {
                                                 console.warn("Error calling plugin");
                                                 });
        } 
    }
        function inserttransationdetail()
        {
		//alert("inserttransationdetail");
            // var qry ="insert into
			// transactiondetailtemp('itemcode','vanstock','freshunloadqty','endinvqty','truckdamageqty','varianceqty')
			// select
			// itemcode,(ifnull(inventorysummarydetail.loadqty,0)+ifnull(inventorysummarydetail.loadadjustqty,0)+ifnull(beginstockqty,0)+ifnull(loadaddqty,0)-ifnull(loadcutqty,0)-ifnull(saleqty,0)+ifnull(returnqty,0)+ifnull(returnfreeqty,0)-ifnull(freesampleqty,0)),0,0,0,0
			// from inventorysummarydetail where routekey="+routekey+" and
			// (ifnull(inventorysummarydetail.loadqty,0)+ifnull(inventorysummarydetail.loadadjustqty,0)+ifnull(beginstockqty,0)+ifnull(loadaddqty,0)-ifnull(loadcutqty,0)-ifnull(saleqty,0)+ifnull(returnqty,0)+ifnull(returnfreeqty,0)-ifnull(freesampleqty,0))
			// > 0";
			
			//org qry sujee comemnted 23/09/2020 added expiry 
			//var qry="insert into transactiondetailtemp('itemcode','vanstock','freshunloadqty','endinvqty','truckdamageqty','varianceqty','badreturnqty') select itemcode,(ifnull(inventorysummarydetail.loadqty,0)+ifnull(inventorysummarydetail.loadadjustqty,0)+ifnull(beginstockqty,0)+ifnull(loadaddqty,0)-ifnull(loadcutqty,0)-ifnull(saleqty,0)+ifnull(returnqty,0)+ifnull(returnfreeqty,0)-ifnull(freesampleqty,0)),0,0,0,0,ifnull(damageqty,0) from inventorysummarydetail where routekey="+routekey+"";
			
			var qry="insert into transactiondetailtemp('itemcode','vanstock','freshunloadqty','endinvqty','truckdamageqty','varianceqty','badreturnqty') select itemcode,(ifnull(inventorysummarydetail.loadqty,0)+ifnull(inventorysummarydetail.loadadjustqty,0)+ifnull(beginstockqty,0)+ifnull(loadaddqty,0)-ifnull(loadcutqty,0)-ifnull(saleqty,0)+ifnull(returnqty,0)+ifnull(returnfreeqty,0)-ifnull(freesampleqty,0)),0,0,0,0,ifnull(damageqty,0)+ ifnull(expiryqty,0) from inventorysummarydetail where routekey="+routekey+"";
            console.log(qry);
			
            if(platform=='iPad')
            {
                return abc = Cordova.exec(function(result) {
                                           // window.location
											// ='unload_option.html';
                                           },
                                           function(error) {
                                           alert(error);},
                                           "PluginClass", 
                                           "InsertUpdateMethod", 
                                           [qry]);
            }
            else if(platform=='Android')
            {
                window.plugins.DataBaseHelper.insert(qry,function(result)
                                                     {
                                                     // window.location
														// ='unload_option.html';
                                                      deletebatchmaster('unload_option.html');
                                                     },
                                                     function()
                                                     {
                                                     console.warn("Error calling plugin");
                                                     });
            } 
        }
        function deletebatchmaster(url)
        {
            var platform= sessionStorage.getItem("platform");
            var qry ="delete from batchmaster_temp";
            var deleteqry ="delete from batchexpirydetail where istemp='true'";
            console.log(qry);
            if(platform=='iPad')
            {
                Cordova.exec(function(result) {
                                           
                                           },
                                           function(error) {
                                           alert(error);},
                                           "PluginClass", 
                                           "InsertUpdateMethod", 
                                           [deleteqry]);
                Cordova.exec(function(result) {
                              insertbatchmaster(url);
                              },
                              function(error) {
                              alert(error);},
                              "PluginClass", 
                              "InsertUpdateMethod", 
                              [qry]);
            }
            else if(platform=='Android')
            {
                window.plugins.DataBaseHelper.insert(deleteqry,function(result)
                                                     {
                                                     
                                                     },
                                                     function()
                                                     {
                                                     console.warn("Error calling plugin");
                                                     });
                window.plugins.DataBaseHelper.insert(qry,function(result)
                                                     {
                                                     insertbatchmaster(url);
                                                     },
                                                     function()
                                                     {
                                                     console.warn("Error calling plugin");
                                                     });
            } 
        }
        function insertbatchmaster(url)
        {
		
            var platform= sessionStorage.getItem("platform");
            var qry ="insert into batchmaster_temp('quantity','badquantity','itemcode','batchdetailkey','batchnumber','expirydate') select ifnull(quantity,0),ifnull(damagequantity,0),itemcode,batchdetailkey,batchnumber,expirydate from batchmaster where batchnumber IS NOT NULL";
            console.log(qry);
            if(platform=='iPad')
            {
                return abc = Cordova.exec(function(result) {
                                           window.location =url;
                                           },
                                           function(error) {
                                           alert(error);},
                                           "PluginClass", 
                                           "InsertUpdateMethod", 
                                           [qry]);
            }
            else if(platform=='Android')
            {
                window.plugins.DataBaseHelper.insert(qry,function(result)
                                                     {
                                                     console.log(result);
                                                     console.log(url);
                                                     window.location =url;
                                                     },
                                                     function()
                                                     {
                                                     console.warn("Error calling plugin");
                                                     });
            } 
        }
      
        
        function checkLoadRequest(){
        	
        	var platform= sessionStorage.getItem("platform");
            var qry="SELECT (SELECT transferinventoryflag FROM setup) setting1,(SELECT enableloadtransfer from routemaster WHERE routecode = " + sessionStorage.getItem("RouteCode") + ") setting2,(SELECT autocalculateloadin from routemaster WHERE routecode = " + sessionStorage.getItem("RouteCode") + ") setting3,(SELECT max(detailkey) from inventorytransactiondetail WHERE routekey="+sessionStorage.getItem("RouteKey")+" and transactiontypecode IN(5,6,7) and istemp='false') unloadsetting,(SELECT includeloadrequest from routemaster WHERE routecode = " + sessionStorage.getItem("RouteCode") + ") loadrequestsetting";
            console.log(qry);
            if(platform=='iPad')
            {
                return abc = Cordova.exec(function(result) {
                                         
                                           },
                                           function(error) {
                                           alert(error);},
                                           "PluginClass", 
                                           "InsertUpdateMethod", 
                                           [qry]);
            }
            else if(platform=='Android')
            {
            	window.plugins.DataBaseHelper.select(qry,function(result)
        		{
            			// alert(JSON.stringify(result.array));
                    	if(result.array != undefined)
						{
			                    result = $.map(result.array, function(item, index) {
			                        return [[item.setting1, item.setting2, item.setting3, item.unloadsetting, item.loadrequestsetting]];
			                    });  
			                    // alert("length of result"+result.length);
			                    if (result.length > 0) {
			                    	// alert(JSON.stringify(result));
									if (result[0][4] == 1)
									{
										// alert("In Request
										// Count"+result[0][4]);
										checkLoadrequestCount();
									
									}else
									{
									
										 updatetransactiondetail();
									}
			                    }else
			                    {
			                    	 updatetransactiondetail();
			                    
			                    }
	                    }else
	                    {
	                    	 updatetransactiondetail();
	                    }
                 },
                 function()
                 {
                 console.warn("Error calling plugin");
                 });
            } 
        
        }
        function checkLoadrequestCount(){
        
        	var platform= sessionStorage.getItem("platform");
            var qry="SELECT COALESCE(COUNT(*),0) as count FROM inventorytransactionheader WHERE transactiontype = 4";
            console.log(qry);
            if(platform=='iPad')
            {
                return abc = Cordova.exec(function(result) {
                                         
                                           },
                                           function(error) {
                                           alert(error);},
                                           "PluginClass", 
                                           "InsertUpdateMethod", 
                                           [qry]);
            }
            else if(platform=='Android')
            {
                 window.plugins.DataBaseHelper.select(qry,function(result)
                 {
                    	if(result.array != undefined)
						{
			                    result = $.map(result.array, function(item, index) {
			                        return [[item.count]];
			                    });  
			                   if (result.length > 0) {
									if (result[0][0]>0)
									{
										
										updatetransactiondetail();
									
									}else
									{
										 var res = navigator.notification.confirm(getLangTextdata("Load Request Is Not Place. Do You Want To Place A Request?"),onConfirm);
									
									}
			                    }
	                    }
                 },
                 function()
                 {
                	 updatetransactiondetail();
                	 console.warn("Error calling plugin");
                 });
            } 
        
        
        
         }
         function onConfirm(button)
         {
        	 		// alert("on Confirm Called");
                    if(button == 1)
                    {
                    	window.location = "requestselection.html";
                    
                    }
                    else
                    {
                    	updatetransactiondetail();
                    	
                    }
         }
         
         function checkNonVisitedCustomers(){
        if( sessionStorage.getItem("enablenosale")>0){	 
        	 var seqweeknumber = sessionStorage.getItem("rp32weeknumber");
        	 var rp32weeknumber=sessionStorage.getItem("rp32weeknumber");
        	 
        	 var days=sessionStorage.getItem("days");
             var calldays=sessionStorage.getItem("calldays");  
           
             var Qry="select strftime('%Y-%m-%d',routestartdate) as routestartdate from startendday where routekey="+sessionStorage.getItem("RouteKey");
          
             if(platform=='Android'){
             
             window.plugins.DataBaseHelper.select(Qry, function(result) {
            	sessionStorage.setItem("routestartdate",result.array[0].routestartdate);
            	var startDate=new Date(result.array[0].routestartdate).getDay()==0?7:new Date(result.array[0].routestartdate).getDay();
            	var currentDate=new Date().getDay()==0?7:new Date().getDay();
            	
            	var callDays="";
            	  
            	if (startDate == currentDate) {
        			callDays="callrestrictiondays" + startDate + "=1 and ";
        		} 
            	
            	else if (startDate>currentDate){
            	
            		for(var i=startDate;i<=7;i++){
            			if (i == startDate)
        					callDays = "(";
        					callDays += "callrestrictiondays" + i + "=1 OR "
        			
            		}
            		for(var i=1;i<=currentDate;i++){
            			if (i != currentDate) {
        					callDays += "callrestrictiondays" + i + "=1 OR "
        				} else {
        					callDays += "callrestrictiondays" + i + "=1) and "
        				}
            		}
            	
            	}
            	
            	else {
        			for (var i = startDate; i <= currentDate; i++) {
        				if (i == startDate)
        					callDays = "(";
        				if (i != currentDate) {
        					callDays += "callrestrictiondays" + i + "=1 OR "
        				} else {
        					callDays += "callrestrictiondays" + i + "=1) and "
        				}
        			}
        		}
             
        		var Qry = "SELECT DISTINCT c.customercode FROM customermaster c JOIN routesequence"
    				+ " AS r ON r.customercode=c.customercode  WHERE "
    				+ callDays
    				+ " c.customercode NOT IN "
    				+ "(SELECT customercode from routesequencecustomerstatus where routekey="
    				+ sessionStorage.getItem("RouteKey")
    				+ ") AND  c.customercode NOT IN (SELECT customercode from "
    				+ "nonservicedcustomer where routekey="
    				+ sessionStorage.getItem("RouteKey") + ") ";
    				
		             window.plugins.DataBaseHelper.select(Qry, function(result) {
		            
		             
		            	 if(!$.isEmptyObject(result)){
		            		 navigator.notification.alert("There are non serviced customers.Please select a reason for not visiting.",navigateToNoSaleReasons);
		            	 }else{
		            	 checkInvUnload();
		            	 }
		            	 
		             },function(){
		            	 console.warn("Error calling plugin"); 
		            	 checkInvUnload();
		             });
             
             },function(){
            	 console.warn("Error calling plugin"); 
             });
           }
        }else{
        	checkInvUnload();
        	 
        	}
   
         }
        
        /*
        *@method navigateToNoSaleReasons
        *function excecuted when the ok button of no sale reason alert is clicked
        */
        function navigateToNoSaleReasons(){
        	
        	window.location="nosalereasons.html";
        }

        /*
        *@method checkOnHoldOrders
        *Function to check whether there is any onhold orders
        */
        function checkOnHoldOrders(){
        	//alert('Hi');
        	var Qry="select invoicenumber from salesorderheader where issync=0 and istemp='false' and"
        	+" dexflag=1 and COALESCE(voidflag,0)<>1";
        	if(platform == "Android")
            {
                window.plugins.DataBaseHelper.select(Qry, function(result) {
                	 if(!$.isEmptyObject(result)){
                		 navigator.notification.alert("There are on hold orders.Please upload the details.",navigateToOnHoldOrders);
                		 
                	 }else{
                		 checkNonVisitedCustomers();
                	 }
                   
                },
                function() {
                    console.warn("Error calling plugin");
                    checkNonVisitedCustomers();
                });
            }
        	
        }
        /*
        *@method navigateToOnHoldOrders
        *Function to navigate to on hold orders screen
        */
        function navigateToOnHoldOrders(){
        	sessionStorage.setItem("backScreen","inventory.html");
        	window.location="onholdorders.html";
        }
        
         function checkInvUnload(){
        	 
        	 var Qry="SELECT (SELECT autocalculateloadin from routemaster WHERE routecode = " + sessionStorage.getItem("RouteCode") + ") setting1,(SELECT max(detailkey) from inventorytransactiondetail WHERE routekey="+sessionStorage.getItem("RouteKey")+" and transactiontypecode IN(5,6,7) and istemp='false')  unloadsetting";
             
        	 
        	 if(platform == "iPad")
             {
                      
             }
             else if(platform == "Android")
             {
                // alert('Unload');
            	 window.plugins.DataBaseHelper.select(Qry, function(result) {
                 	if(result.array != undefined)
                 	{
                   //  alert('Defibed');
                 		result = $.map(result.array, function(item, index) {
                         return [[item.setting1, item.unloadsetting]];
                     });                    
	                     if (result.length > 0) {
	                         
	                         if (eval(result[0][1]) > 0) {
	                        	 getLangText("Unload Done Already.");
			                 
	                         }else{
	                        	// alert('Popup');
	                        	 PopupPasswordEntry('lnkUnload','unload_option.html',tblPasswordUnload.innerHTML,'inventory.html');
	                             
	                        	 		
	                         }
	                         
	 						 
	                     }
                     }  
                     
                    
                 },
                 function() {
                     console.warn("Error calling plugin");
                 });
             }
         
         }
          
    </script>

</body>
</html>
