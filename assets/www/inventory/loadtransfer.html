<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Load Transfer</title>
    <meta name="viewport"
	content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />

    <meta name="format-detection" content="telephone=no"/>
    <link rel="stylesheet" href="../css/style.css" />
    <link rel="stylesheet" href="../css/en.css" lang="en" />
    <link rel="stylesheet" href="../css/jquery.mobile-1.0.min.css" />
    <link rel="stylesheet" media="only screen and (min-width: 320px) and (max-width: 600px)"
        href="../css/style_600.css"/>
    <!--Black P-->
    <link rel="stylesheet" media="only screen and (min-width: 600px) and (max-width: 700px)"
        href="../css/style_700.css"/>
    <!--Iphone 4 P-->
    <link rel="stylesheet" media="only screen and (min-width: 700px) and (max-width: 800px)"
        href="../css/style_800.css"/>
    <!--Ipad P-->
    <!--Black L-->
    <link rel="stylesheet" media="only screen and (min-width: 1000px) and (max-width: 1200px)"
        href="../css/style_1200.css"/>
    <!--Ipad L-->
    <link rel="stylesheet" media="only screen and (min-width: 1200px) and (max-width: 1500px)"
        href="../css/style_1400.css"/>
        
        <link rel="stylesheet" href="../css/boostrap/css/bStyle.css"/>
        <link rel="stylesheet" href="../css/boostrap/css/bootstrap.min.css"/>
        <link rel="stylesheet" href="../css/boostrap/css/bootstrap-grid.css"/>
        <link rel="stylesheet" href="../css/boostrap/css/bootstrap-grid.min.css"/>
        <link rel="stylesheet" href="../css/boostrap/css/bootstrap.css"/> 
        
<script>
        if (navigator.userAgent.toLowerCase().match(/android/)) {
            document.write('<script charset="utf-8" src="../cordova-2.0.0.js"><\/script>');
            document.write('<script charset="utf-8" src="../directoryListing.js"><\/script>');
        } else if (navigator.userAgent.toLowerCase().match(/iphone/) || navigator.userAgent.toLowerCase().match(/ipad/)) {
            document.write('<script charset="utf-8" src="../cordova-1.5.0.js"><\/script>');
        }
    </script>
    <script type="text/javascript" src="../js/jquery.js"></script>

    <script type="text/javascript" src="../js/jquery.mobile-1.0.js"></script>

    <script type="text/javascript" src="../js/common.js"></script>
        <script type="text/javascript" src="../js/batch.js"></script>
    <script src="../LangJS/jquery-lang.js" charset="utf-8" type="text/javascript"></script>

    <script src="../LangJS/langpack/AR.js" charset="utf-8" type="text/javascript" lang="en"></script>   
    
</head>
<body>
    <div data-role="page" data-theme="d" data-title="Order Request">
        <div>
            <img title="" alt="" src="../images/bg.png" id="background">
        </div>
        <div data-role="header" data-position="inline" id="bgclheader">
            <a href="#" id="Back_inner" rel="external" onclick="OnCancel();" lang="en">Back</a> <div class="wrapper"><div class="card_content"><div><img title="" alt="" data-pushbar-target="left"  src="../images/icons8-menu-50.png" id="setting"></div></div></div> 
            <h1 lang="en">Load Transfer</h1>
            <a href="#" id="lang_inner" lang="en">EN</a>
        </div>
        <div data-role="content" class="centerboxInvReq">
            <div class="comm captionLabel">
                
                	<div class="row">
                		<div class="col-4">
                			DEPOT / ROUTE
                		</div>
                		<div class="col-8">
                			<select class="form-select !important"  
                			name="select-choice-1" id="ddlRoute" style="display: inline;width:100%"></select>
                		</div>
                	</div>                    
                
                <div class="tblBox tbltd">
                    <table id="tblHeaderContent" class="tblHeader" cellpadding="0" cellspacing="0" border="0"
                        width="100%">
                        <tr>
                        	<th style="width: 16%;" lang="en">
                                Item Code
                            </th>
                            <th style="width: 30%;" class="leftAlign" lang="en">
                                Item Description
                            </th>
                            <th style="width: 10%;" lang="en">
                                Cases
                            </th>
                            <th style="width: 10%;" lang="en"  class="last">
                                Units
                            </th>
                            <th style="width: 12%;display:none" lang="en">
                                Case Price
                            </th>
                            <th style="width: 12%;display:none" lang="en">
                                Unit Price
                            </th>
                            <th style="width: 16%;display:none" lang="en">
                                Total
                            </th>
                            
                        </tr>
                    </table>
                    <div class="tblLoadTransferHeight">
                        <table id="tblContent" cellpadding="0" cellspacing="0" border="2" width="100%">
                            <tr>
                            	<td style="width: 16%;">                                
                                </td>
                                <td style="width: 30%;">                                
                                </td>
                                <td style="width: 10%;">
                                </td>
                                <td style="width: 10%;"  class="last">                                
                                </td>
                                <td style="width: 12%;display:none">
                                </td>
                                <td style="width: 12%;display:none">                               
                                </td>
                                <td style="width: 16%;display:none">                                
                                </td>
                                
                            </tr>
                        </table>
                    </div>
                </div>
                
                <div class="tabedBar" style="margin-top:5px !important">
                    <div id="TabPanel" class="TabPanelEN">
                        <!-- <div id="TabEndingInventory" class="Tab TabFirst TabActive" style="display: block"
                            db="TI" lang="en">
                            Transfer In</div>
                        <div id="TabFreshUnload" class="Tab Tabmiddle" db="TO" lang="en" style="display: block;
                            white-space: nowrap">
                            Transfer Out</div>
                       <div id="TabFreshUnload" class="Tab TabLast" db="TO" lang="en" style="display: block;
                            white-space: nowrap">
                            Damage Transfer Out</div>-->
                    </div>
                </div>
                <div class="textBar captionLabel">
                	
                    <table cellpadding="2" cellspacing="2" border="0" width="100%">
                        <tr>
                            <td style="width: 28%" lang="en">Price</td>
                            <td style="width: 28%" lang="en">UPC</td>
                            <td style="width: 44%" id="lblQty" lang="en">Inventory Qty</td>
                        </tr>
                        <tr>
                            <td style="width: 28%">
                                <input id="txtItemNo" type="text" class="textFont textWidth" readonly="readonly"/>
                            </td>
                            <td style="width: 28%">
                                <input id="txtUPC" type="text" class="textFont textWidth" readonly="readonly"/>
                            </td>
                            <td style="width: 44%">
                                <!--<input id="txtQty" type="text" class="textWidth textFont" />-->
                                <div class="alert border-info" id="AvailQty">0/0</div>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="leftbotloadTrf card border-info !important" style="margin-top:200px !important">
            
            	<div class="row">                    
                    <div class="col-3" >
                        <div class="card bg-success text-center" style="width:100%">
                            <a href="#" rel="external" id="A1" onclick="OnAdd()" >
                                <img class="bottomicon" src="../images/icn-add.png" alt="sync" />
                                <h4 class="text-white">ADD</h4>
                            </a>
                        </div>                        
                    </div>
                    <div class="col-4" >
                        <div class="card bg-danger text-center" style="width:100%">
                            <a href="#" onclick="OnSummary()" rel="external">
                            <img class="bottomicon" src="../images/doc.png" id="imgexit" alt="Exit" />
                            <h4 class="text-white">SUMMARY</h4>
                            </a>
                        </div>                        
                    </div>
                    <div class="col-3">
                        <div class="card bg-danger text-center" style="width:100%">
                            <a href="#" rel="external" id="lnkPrint" onclick="return ValidateInventory()">
                            <img class="bottomicon" src="../images/print.png" id="imgexit" alt="Exit" />
                            <h4 class="text-white">PRINT</h4>
                            </a>
                        </div>                        
                    </div>
                </div>
            
                
            </div>
        </div>
         <div id="f1" data-role="footer" class="ui-bar">
            <div class="footer">
                <div class="leftfooter">
                    09 November 2011</div>
                <div class="rightfooter">
                    Mirnah Technology Systems</div>
            </div>
        </div>
        <div id="f2" data-role="footer" style="bottom: 0; position: absolute;">
		 <aside data-pushbar-id="left" class="pushbar from_left">
		<div class="title"><span data-pushbar-close class="close push_right"></span>
			<span id="txtroute"></span>
		</div>

		<ul class="menu">
		<li style="margin-bottom: 0 !important;" > 
		<img title="" alt="" src="../images/startday-icon.png" id="day"  class="leftmenu" >
		 <a href="#"
						class="ui-btn-active" rel="external" id="day" data-icon="custom"  
						lang="en" onclick="footerredict('../startofday/startofday.html')">Start day</a></li>
					<li style="margin-bottom: 0 !important;">
					 <img title="" alt="" src="../images/Inventoryicon.png" id="inve"  class="leftmenu">
					 <a href="#" id="inve"
						rel="external" data-icon="custom" lang="en"
						onclick="footerredict('../inventory/inventory.html')">Inventory</a></li>
					<li style="margin-bottom: 0 !important;">
					 <img title="" alt="" src="../images/customer-icon.png" id="cust" class="leftmenu">
					 <a href="#"
						rel="external" id="cust" data-icon="custom" lang="en"
						onclick="footerredict('../customer/customer_operation.html')">Customer</a></li>
					<li style="margin-bottom: 0 !important;">
					<img title="" alt="" src="../images/Money-icon.png" id="sett" class="leftmenu">
					<a href="#"
						rel="external" id="sett" data-icon="custom" lang="en"
						onclick="footerredict('../settlement/managesettlement.html')">Settlement</a></li>
					<li style="margin-bottom: 0 !important;">
					<img title="" alt="" src="../images/expense-icon.png" id="expe" class="leftmenu">
					<a href="#"
						rel="external" id="expe" data-icon="custom" lang="en"
						onclick="footerredict('../settlement/expenseentry.html')">Expenses</a></li>
					<li style="margin-bottom: 0 !important;">
					<img title="" alt="" src="../images/information-icon.png" id="info" class="leftmenu" >
					<a href="#"
						rel="external" id="info" data-icon="custom" lang="en"  
						onclick="footerredict('../information/information.html')">Information</a></li>
					<li style="margin-bottom: 0 !important; ">
					 <img title="" alt="" src="../images/user-settings-icon.png" id="setup" class="leftmenu">
					 <a href="#" rel="external" id="setup" data-icon="custom" lang="en"
						onclick="footerredict('../utilities/utilities.html')">Utilities</a></li>
		</ul>

	</aside>
        
             <div data-role="navbar" data-iconpos="top" data-grid="f">
                <ul>
                    <li style="margin-bottom:0 !important;"><a href="#" rel="external" id="day" data-icon="custom" lang="en" onclick="ClearVariables();RemoveOnQuickAccess();footerredict('../startofday/startofday.html')">Start day</a></li>
			        <li style="margin-bottom:0 !important;"><a href="#" id="inve" class="ui-btn-active" rel="external" data-icon="custom" lang="en">Inventory</a></li>
			        <li style="margin-bottom:0 !important;"><a href="#" rel="external" id="cust" data-icon="custom" lang="en" onclick="ClearVariables();RemoveOnQuickAccess();footerredict('../customer/customer_operation.html')">Customer</a></li>
			        <li style="margin-bottom:0 !important;"><a href="#" rel="external" id="sett" data-icon="custom" lang="en" onclick="ClearVariables();RemoveOnQuickAccess();footerredict('../settlement/managesettlement.html')">Settlement</a></li>
			        <li style="margin-bottom:0 !important;"><a href="#" rel="external" id="expe" data-icon="custom" lang="en" onclick="ClearVariables();RemoveOnQuickAccess();footerredict('../settlement/expenseentry.html')">Expenses</a></li>
			        <li style="margin-bottom:0 !important;"><a href="#" rel="external" id="info" data-icon="custom" lang="en" onclick="ClearVariables();RemoveOnQuickAccess();footerredict('../information/information.html')">Information</a></li>
			        <li style="margin-bottom:0 !important; width:14.0%"><a href="#" rel="external" id="setup" data-icon="custom" lang="en" onclick="ClearVariables();RemoveOnQuickAccess();footerredict('../utilities/utilities.html')">Utilities</a></li>
                </ul>
            </div>
        </div>
    </div>


    <script type="text/javascript">
     
 var data = null;
        var platform = null;
        var CaseEnabled;
        var AvailQty;
        var decimalplace = sessionStorage.getItem("decimalplace"); 
        var transactiontypecode=3;
        var CasePrice = 0;
        var TransferInventory;
        var key;
        var batchqty;
        var ActiveIndex;
        var anytimetabclick = true;
        window.lang = new jquery_lang_js();
        $("#tblContent").click(function() {});
        resizeOrientationWindow();
        $(document).ready(function() {
        	resizeWindow();
        	document.addEventListener("deviceready", onDR, false);
        	  // sujee added side bar ----------------- START ------------------------ 

	          var pushbar = new Pushbar({
	blur:true,
	overlay:true,
});
$("#txtroute").text("ROUTE #: " + sessionStorage.getItem("RouteCode")); 
window.setInterval(function(){
		var randomColor = '#'+ ('000000' + Math.floor(Math.random()*16777215).toString(16)).slice(-6);
		$('#txtroute').css({
			'color' : randomColor,
		});
		}, 2000);
//----------------------------- END -------------------------  
            function onDR() {
                
                if (sessionStorage.getItem("CaseEnabled") == "0" || sessionStorage.getItem("CaseEnabled") == null)
                    CaseEnabled = false;
                else if (sessionStorage.getItem("CaseEnabled") == "1")
                    CaseEnabled = true;
                platform = sessionStorage.getItem("platform");
                 if (!CaseEnabled) {
                    $("#tblHeaderContent tr th:eq(2)").remove();
                    $("#tblHeaderContent tr th:eq(3)").remove();
                    $("#tblContent tr td:eq(2)").remove();
                    $("#tblContent tr td:eq(3)").remove();
                }                  
                
                getSettings();
                if(sessionStorage.getItem('batchsetting') ==1)
                          selectbatchdata();
                          
            }
            $(".leftfooter").html(getCurrentDate());            
            $("#ddlRoute").change(function(){
                localStorage.transactiontypecode = transactiontypecode;
                localStorage.transferroute = $("#ddlRoute option:selected").text();  
                localStorage.transferroutecode = $("#ddlRoute option:selected").val(); 
            });
            
                      
            //Setting Tab Styles
            $('.ui-select .ui-btn-text').css({ 'text-align': 'left', 'color': '#fff' });                        

            
            var lan = sessionStorage.getItem("Language");
	    window.lang.run(lan);
           if (sessionStorage.getItem("Language")  != "en") {
               
                window.lang.change('InventoryUnLoad'+lan,lan);
                window.lang.change('Footer'+lan,lan);
		if(lan=="AR")
                {
                   $(".centerbox").attr("dir", "rtl");
                    $('#Back_inner').removeClass('ui-btn-left ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
		    $('#Back_inner').addClass('ui-btn-right ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
		    $('#lang_inner').removeClass('ui-btn-right ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
		    $('#lang_inner').addClass('ui-btn-left ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
		}
		
            }
	    else
	    {
		window.lang.change('en','en');
		$(".centerbox").attr("dir", "ltr");
		$('#Back_inner').removeClass('ui-btn-right ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
		$('#Back_inner').addClass('ui-btn-left ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
		$('#lang_inner').removeClass('ui-btn-left ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
		$('#lang_inner').addClass('ui-btn-right ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
	    }

            function GetElements(xmlDoc) {
                var PageName = 'orderRequest';
            }

        });

	    function ClearTable(TBL) {
                $("#" + TBL + " tr:gt(0)").remove();
            }        
		
          function getSettings()
            {
               
                if(sessionStorage.getItem('batchsetting') ==0){
                        $("#lnkBatch").attr("href", "#");
                        $("#lnkBatch").attr("onclick", "");
                        $("#imgBatch").attr("src", "../images/batch-gray.png");
                        $("#lnkBatchText").addClass('MenuGray');
                    }
                
                var Qry = "SELECT enableloadtransfer,(SELECT transferinventoryflag FROM setup) as TransferInventory  FROM routemaster WHERE routecode=" + sessionStorage.getItem("RouteCode");
                console.log(Qry);
                if (platform == "iPad") {
                    Cordova.exec(function(result) {
                        TransferInventory = result[0][1];
                        SetTab(result[0][0]);
                        getCount();
                    },
                    function(error) {
                        navigator.notification.alert(error);
                    },
                    "PluginClass",
                    "GetdataMethod",
                    [Qry]);
                }
                else if (platform == "Android") {
                    window.plugins.DataBaseHelper.select(Qry, function(result) {
                        TransferInventory = result.array[0].TransferInventory;
                        SetTab(result.array[0].enableloadtransfer);
                        getCount();
                    },
					function() {
					    console.warn("Error calling plugin");
					});
                }
            }
                          
            function getCount()
            {
                var Qry = "SELECT COUNT(*) as cnt FROM inventorytransactiondetail WHERE transactiontypecode IN(2,3,4) AND istemp = 'true' AND routekey= " + sessionStorage.getItem("RouteKey");
                console.log(Qry);
                if(platform == "iPad")
                {
                    Cordova.exec(function(result) {                        
                        if(result[0][0] == 0)
                        {
                            $("#lnkPrint").attr("href","#");
                            $("#lnkPrint").attr("onclick","");
                            $("#imgPrint").attr("src","../images/print.png");
                            $("#divPrint").addClass('MenuGray');
                        }
                        else
                        {
                            localStorage.po ='inventory';
                            $("#lnkPrint").attr("href","#");                            
                            $("#imgPrint").attr("src","../images/print.png");
                            $("#lnkPrint").attr("onclick","ValidateInventory()");
                              
                            $("#divPrint").removeClass('MenuGray');
                        }
                        getRoutes();
                    },
                    function(error) {
                        navigator.notification.alert(error);
                    },
                    "PluginClass",
                    "GetdataMethod",
                    [Qry]);                
                }
                else if(platform == "Android")
                {                    
                    window.plugins.DataBaseHelper.select(Qry, function(result) {
                        if(result.array[0].cnt == 0)
                        {
                            $("#lnkPrint").attr("href","#");
                            $("#lnkPrint").attr("onclick","");
                            $("#imgPrint").attr("src","../images/print.png");
                            $("#divPrint").addClass('MenuGray');
                        }
                        else
                        {
                             localStorage.po ='inventory';
                            $("#lnkPrint").attr("href","#");                            
                            $("#imgPrint").attr("src","../images/print.png");
                            $("#lnkPrint").attr("onclick","ValidateInventory()");
                              
                            $("#divPrint").removeClass('MenuGray');
                        }
                        getRoutes();
                    },
					function() {
					    console.warn("Error calling plugin");
					});
                }
            }
            
            function SetTransactionTypeCode(CurrentTab)
            {
                if(CurrentTab == 0)
                {
                    transactiontypecode = 3;//Tramsfer In
                    localStorage.batchtranstype=3;
                    batchqty='loadaddqty';
                }
                else if(CurrentTab == 1)
                {
                    transactiontypecode = 2; // Transfer Out
                    localStorage.batchtranstype=2;
                    batchqty='loadcutqty';
                }
                else if(CurrentTab == 2)
                {
                    transactiontypecode = 4; //  Damage Transfer Out
                          localStorage.batchtranstype=4;
                           batchqty='damageunloadqty';
                }
                          
                if(transactiontypecode == 4)
                    $("#lblQty").text(getLangTextdata("Damage Qty"));
                else
                    $("#lblQty").text(getLangTextdata("Inventory Qty"));
            }
            
            function SetTab(val)
            {    
                var strTransferIn = "<div id='TabEndingInventory' CurrentTab='0' class='TabLoadTransfer' style= 'display: block;white-space: nowrap' lang='en'>"+getLangTextdata('Transfer In')+"</div>"
                        
                var strTransferOut = "<div id='TabFreshUnload' CurrentTab='1' class='TabLoadTransfer' style='display: block;white-space: nowrap' lang='en'>"+getLangTextdata('Transfer Out')+"</div>";
                
                var strDamageTransferOut = "<div id='TabFreshUnload' CurrentTab='2' class='TabLoadTransfer' lang='en' style='display: block;white-space: nowrap'>"+getLangTextdata('Damage Out')+"</div>";

                if(val == 1)
                {                    
                    $("#TabPanel").append(strTransferIn);                    
                }
                else if(val == 2)
                {
                    $("#TabPanel").append(strTransferOut);
                }
                else if(val == 3)
                {
                    $("#TabPanel").append(strDamageTransferOut);
                }
                else if(val == 4)
                {
                    $("#TabPanel").append(strTransferIn);
                    $("#TabPanel").append(strTransferOut); 
                }
                else if(val == 5)
                {
                    $("#TabPanel").append(strTransferIn);
                    $("#TabPanel").append(strDamageTransferOut); 
                }
                else if(val == 6)
                {
                    $("#TabPanel").append(strTransferOut); 
                    $("#TabPanel").append(strDamageTransferOut); 
                }
                else if(val == 7)
                {
                    $("#TabPanel").append(strTransferIn);
                    $("#TabPanel").append(strTransferOut); 
                    $("#TabPanel").append(strDamageTransferOut); 
                }
                $("#TabPanel div:eq(0)").addClass("TabActive");
                SetTransactionTypeCode($("#TabPanel div:eq(0)").attr("CurrentTab"))
                
                var TabCount = $("#TabPanel div").length;
                if(TabCount == 1)
                {
                    $("#TabPanel div:eq(0)").addClass("TabFirst");
                }
                if(TabCount >= 2)
                {                 
                    $("#TabPanel div:eq(0)").addClass("TabFirst");
                    $("#TabPanel div:eq(1)").addClass("Tabmiddle");
                }
                $("#TabPanel div:eq(" + (eval(TabCount) - 1) + ")").addClass("TabLast"); //Class for last Tab
                
                $("#TabPanel div").click(function() {
                    if(anytimetabclick)
                    {
                    $("#TabPanel div").removeClass("TabActive");
                    $(this).removeClass("TabInactive").addClass("TabActive"); 
                    var index = $("#TabPanel div").index(this);
                    ActiveIndex = index;
                    var CurrentTab  = $("#TabPanel div:eq(" + index + ")").attr("CurrentTab");
                    SetTransactionTypeCode(CurrentTab);
                        
                    ClearTable('tblContent');
                    data = null;
                    $('#txtItemNo').val("");
                    $('#txtUPC').val("");
                    $("#AvailQty").text("");               
                    getRecord();
                    }
                });
                
                if(localStorage.transactiontypecode == 2)
                {
                    transactiontypecode = 2;
                          localStorage.batchtranstype=2;
                          batchqty='loadcutqty';
                    $("#TabPanel div").removeClass("TabActive");
                    $("#TabPanel div:eq(1)").removeClass("TabInactive").addClass("TabActive");
                }
                else if(localStorage.transactiontypecode == 3)
                {
                    transactiontypecode = 3;
                          localStorage.batchtranstype=3;
                          batchqty='loadaddqty';
                    $("#TabPanel div").removeClass("TabActive");
                    $("#TabPanel div:eq(0)").removeClass("TabInactive").addClass("TabActive");
                }
                else if(localStorage.transactiontypecode == 4)
                {
                    transactiontypecode = 4;
                          localStorage.batchtranstype=4;
                          batchqty='damageunloadqty';
                    $("#TabPanel div").removeClass("TabActive");
                    $("#TabPanel div:eq(2)").removeClass("TabInactive").addClass("TabActive");
                }
                if(sessionStorage.getItem('batchsetting') ==1)
                        selectbatchdata();
                          
            }
            
            
            function getRoutes()
            {            	
                var Qry;
                /*if(TransferInventory == 1)
                    Qry = "SELECT routecode,routename FROM routemaster WHERE depotrouteflag = 0 AND (routetmpl = 0 or routetmpl is null) AND routecode <>" + sessionStorage.getItem("RouteCode");
                else if(TransferInventory == 2)
                    Qry = "SELECT routecode,routename FROM routemaster WHERE depotrouteflag = 1 AND (routetmpl = 0 or routetmpl is null) AND routecode <>" + sessionStorage.getItem("RouteCode");
                else*/
                   // Qry = "SELECT routecode,routename FROM routemaster WHERE (routetmpl = 0 or routetmpl is null) AND routecode <>" + sessionStorage.getItem("RouteCode");
                Qry = "SELECT routecode,routename FROM routemaster WHERE  routecode <>" + sessionStorage.getItem("RouteCode");
                console.log(Qry);
                if(platform == "iPad")
                {
                    Cordova.exec(function(result) { 
						if(result.length > 0)
                         $("<option />" ,{value:"0",text:" -- SELECT --"}).appendTo($("#ddlRoute"));
                        for(i=0;i<result.length;i++){                    
                            $("<option />" ,{value:result[i][0],text:result[i][1]}).appendTo($("#ddlRoute"));                                           
                        }
                        if(localStorage.transferroutecode != "" && localStorage.transferroutecode != undefined && localStorage.transferroutecode != "null")
                            $("#ddlRoute").val(localStorage.transferroutecode);
                        $("#ddlRoute").selectmenu("refresh");      
                        localStorage.transferroute = $("#ddlRoute option:selected").text();  
            			localStorage.transferroutecode = $("#ddlRoute option:selected").val();                  
                        getRecord();
                    },
                    function(error) {
                        navigator.notification.alert("Error in binding Reason : " + error);
                    },
                    "PluginClass", 
                    "GetdataMethod", 
                    [Qry]);
                }
                else if(platform == "Android")
                {
                    window.plugins.DataBaseHelper.select(Qry,function(result)
					{
						if(result.array  != undefined)
						{
                        	result = $.map(result.array, function (item, index) { 
                				return [[item.routecode, item.routename]];
                        	});
							if(result.length > 0)
	                        $("<option />" ,{value:"0",text:" -- SELECT --"}).appendTo($("#ddlRoute"));
                        	for(i=0;i<result.length;i++){                    
	                            $("<option />" ,{value:result[i][0],text:result[i][1]}).appendTo($("#ddlRoute"));                                           
                        	}                        	
                        	if(localStorage.transferroutecode != "" && localStorage.transferroutecode != undefined && localStorage.transferroutecode != "null")
	                            $("#ddlRoute").val(localStorage.transferroutecode);
                        	$("#ddlRoute").selectmenu("refresh");                  
                        	localStorage.transferroute = $("#ddlRoute option:selected").text();  
            				localStorage.transferroutecode = $("#ddlRoute option:selected").val();      
                        	getRecord();
                        }
					},
					function()
					{
				   	 console.warn("Error calling plugin");
					});
                }
            }
            
            function getRecord()
            {
                var Qry;
                if (CaseEnabled) {
                    Qry = "SELECT CASE WHEN '" + sessionStorage.getItem("Language") + "' = 'en' THEN itemdescription ELSE arbitemdescription END as Desc,(case when quantity=0 THEN '' ELSE (quantity/im.unitspercase) END) as cases,(case when quantity=0 THEN '' ELSE  (quantity % im.unitspercase) END) as units,im.caseprice,im.defaultsalesprice as price,NULL as total,CASE WHEN '" + sessionStorage.getItem("CheckCode") + "' = 'alternatecode' THEN im.alternatecode ELSE im.actualitemcode END as Code,im.actualitemcode,im.unitspercase,im.caseprice,(CASE im.printsequencecust WHEN 0 THEN 100000 ELSE im.printsequencecust END) AS seqprint FROM inventorytransactiondetail invd JOIN itemmaster AS im ON im.actualitemcode = invd.itemcode where invd.routekey=" + sessionStorage.getItem("RouteKey") + " AND transactiontypecode = " + transactiontypecode + " AND istemp='true' group by actualitemcode order by seqprint";
                }
                else {
                    Qry = "SELECT CASE WHEN '" + sessionStorage.getItem("Language") + "' = 'en' THEN itemdescription ELSE arbitemdescription END as Desc,(case when quantity=0 THEN '' ELSE  (quantity) END) as units,im.defaultsalesprice as price,NULL as total,CASE WHEN '" + sessionStorage.getItem("CheckCode") + "' = 'alternatecode' THEN im.alternatecode ELSE im.actualitemcode END as Code,im.actualitemcode,im.unitspercase,im.caseprice,(CASE im.printsequencecust WHEN 0 THEN 100000 ELSE im.printsequencecust END) AS seqprint FROM inventorytransactiondetail invd JOIN itemmaster AS im ON im.actualitemcode = invd.itemcode where invd.routekey=" + sessionStorage.getItem("RouteKey") + " AND transactiontypecode = " + transactiontypecode + " AND istemp='true' group by actualitemcode order by seqprint";
                }
                
                console.log(Qry);
                if (platform == "iPad") {
                    Cordova.exec(function(result) {
                        TableDataOffLine(result)
                    },
                    function(error) {
                        navigator.notification.alert(error);
                    },
                    "PluginClass",
                    "GetdataMethod",
                    [Qry]);
                }
                else if (platform == "Android") {
                    window.plugins.DataBaseHelper.select(Qry, function(result) {
                    	if(result.array != undefined)
                    	{
                        	var array = $.map(result.array, function(item, index) {
                        	if (CaseEnabled)
	                            return [[item.Code,item.Desc, item.cases, item.units, item.caseprice, item.price, item.total, item.actualitemcode, item.unitspercase, item.caseprice]];
                        	else
	                            return [[item.Code,item.Desc, item.units, item.price, item.total, item.actualitemcode, item.unitspercase, item.caseprice]];
                        	});
                        	result = array;
                        	TableDataOffLine(result);
                        }
                    },
					function() {
					    console.warn("Error calling plugin");
					});
                }
            }
            
            function TableDataOffLine(result)
            {
            	
                var CellCount = $("#tblHeaderContent tr:eq(0) th").length;
                var temp;
                data = result;
                for (i = 0; i < data.length; i++) {
                    var r = "<tr class='contentFont'>";
                    for (j = 0; j < CellCount; j++) {
                        if (CaseEnabled) {
                            if (j == 2 || j == 3) {
                                temp = "class = 'editable'";                                
                                if (data[i][j] != '' && data[i][j] != undefined)
                                    data[i][j] = parseInt(data[i][j]);
                                else {
                                    data[i][j] = '';
                                }
                            }
                            else
                                temp = '';
                        }
                        else {
                            if (j == 2) {
                                temp = "class = 'editable'";
                                if (data[i][j] != '' && data[i][j] != undefined)
                                    data[i][j] = parseInt(data[i][j]);
                                else
                                    data[i][j] = '';
                            }
                            else
                                temp = '';
                        }
                        temp += (j == 1) ? 'class = leftAlign' : '';
                        if (j == CellCount - 1) {
                            temp += " style='display:none;text-align:right;padding:0px 10px 0px 10px;'";
                            if (data[i][1] == '')
                                data[i][j] = ''; //Overriding total column to set blank;
                            else 
                                data[i][j] = data[i][1];
                                if (CaseEnabled) {
                                    // Total = (case * caseprice) + (Units * salesprice)                                                   
                                    data[i][j] = eval(data[i][1] * data[i][3]) + eval(data[i][2] * data[i][4])
                                }
                                else {
                                    // Total = (Units * salesprice)                  
                                    data[i][j] = eval(data[i][1] * data[i][2])
                                }
                                if (isNaN(data[i][j]))
                                    data[i][j] = 0;
                            
                        }
                        if (j == CellCount - 1)
						temp += " class = 'last'";
                        if (CaseEnabled) {
                            if (j >= 4 && j <= 6) {
                                temp += " style='display:none;text-align:right;padding:0px 10px 0px 10px;'";
                                if (data[i][j] != '' && data[i][j] != undefined)
                                    data[i][j] = eval(data[i][j]).toFixed(decimalplace);
                            }
                        }
                        else {
                            if (j >= 3 && j <= 4){
                            temp += " style='display:none;text-align:right;padding:0px 10px 0px 10px;'";
                                if (data[i][j] != '' && data[i][j] != undefined)
                                data[i][j] = eval(data[i][j]).toFixed(decimalplace);
                            }
                        }
                        var c = "<td " + temp + ">" + data[i][j] + "</td>";
                        r += c;
                    }
                    r += "</tr>";
                    $('#tblContent tbody').append(r);
                }
                
                if(platform == "iPad")
                {
                	$("#tblHeaderContent th.last").show()
                	$("#tblContent td.last").show()
                }
                
                //Click event for each row in table to process row data.
                $("#tblContent tr").live('click', function() {
                    $(this).addClass('clicked');
                    $(this).siblings().removeClass('clicked');
                    var idx = $(this).index();
                    if (CaseEnabled) {
                        $('#txtItemNo').val(data[idx - 1][4]+"/"+data[idx - 1][5]);
                        $('#txtUPC').val(data[idx - 1][8]);
                        AvailQty = null;
                        getAvailQty(data[idx - 1][7]);
                                         localStorage.selecteditem=data[idx - 1][7];              
                                         
                    }
                    else {
                        $('#txtItemNo').val(data[idx - 1][3]);
                        $('#txtUPC').val(data[idx - 1][6]);
                        AvailQty = null;
                        getAvailQty(data[idx - 1][5]);
                                          localStorage.selecteditem=data[idx - 1][5];  
                    }
                });


                $("#tblContent tr:eq(1)").trigger('click');
                $("#tblContent tr:odd").addClass('oddRow');
                $("#tblContent tr:even").addClass('evenRow');
    
                // If Edit is enabled allow editing in grid
                $('#tblContent td.editable').click(function() {
                    anytimetabclick = false;
                    if(eval($(this).text()) <= 0)
                    	$(this).text("");
                    var input = $("<input type='tel'/>").attr('value', $(this).text());
                    var w = $(this).innerWidth();
                    w = w - 50;
                     
                    if(window.innerWidth>1000){
                    	input.css('width', w).css('border', '0').css('height', 60).css('font-size',35);
                    }else{
                    	input.css('width', w).css('border', '0').css('height', 30).css('font-size', 16);
                    }
                                        $(this).empty();                    
                    $(this).append(input);
                    input.bind("keyup",function() { return SetNumberMaxLength(this,4) });        
                    input.focusout(function() { 
                    	var v = parseInt($(input).val(),10);
                        $(input).val(v);
                    	if(ValidateGridCaseUnit(this)) 
                    	{ 
                    		UpdateData(this) 
                    	} 
                    });
                    input.focus();
                    $(this).find('input').live("keypress", function(event) {
                        if (event.keyCode == 13) {
                            input.focusout();
                        }
                    });
                });
            }
            
            // Update Quantity according to changes in grid.
            function UpdateData(obj) {
                var RowIndex = $(obj).parent().parent().index();
                var ObjIndex = $(obj).parent().index();
                $(obj).parent().text(parseInt(CheckIsNaN($(obj).val())));
                var Cases, Units, UnitsPerCase, ItemCode, RouteKey, CurrQty, Price,CasePrice;
                CasePrice = 0;
                if (CaseEnabled) {
                    Cases = eval($("#tblContent tr:eq(" + RowIndex + ") td:eq(2)").text());
                    Units = eval($("#tblContent tr:eq(" + RowIndex + ") td:eq(3)").text());
                    ItemCode = data[RowIndex - 1][7];
                    UnitsPerCase = data[RowIndex - 1][8];
                    RouteKey = sessionStorage.getItem("RouteKey");
                    Cases = (Cases == undefined || Cases == '') ? 0 : parseInt(CheckIsNaN(Cases));
                    Units = (Units == undefined || Units == '') ? 0 : parseInt(CheckIsNaN(Units));
                    CurrQty = (parseInt(Cases) * UnitsPerCase) + parseInt(Units);  
                        
                    if(ObjIndex == 2 || ObjIndex == 3)
                    {
                        if ((CurrQty > AvailQty) && transactiontypecode != 3)
                        {
                            getLangText("Qty not available");
                            $("#tblContent tr:eq(" + RowIndex + ") td:eq(" + ObjIndex + ")").text(0);
                            return false;
                        }
                    }
                        
                    Price = eval(data[RowIndex - 1][5]).toFixed(decimalplace);
                    CasePrice = eval(data[RowIndex - 1][4]).toFixed(decimalplace);
                    $("#tblContent tr:eq(" + RowIndex + ") td:eq(2)").text(parseInt(CurrQty / UnitsPerCase));
                    $("#tblContent tr:eq(" + RowIndex + ") td:eq(3)").text(parseInt(CurrQty % UnitsPerCase));
                    //Calculating Total value
                    var Total = CheckIsNaN(eval(Cases * data[RowIndex - 1][4]) + eval(Units * data[RowIndex - 1][5]));
                    $("#tblContent tr:eq(" + RowIndex + ") td:eq(6)").text(Total.toFixed(decimalplace));                    
                    //Over                                                     
                    CheckInsert(ItemCode, RouteKey, CurrQty, Price,CasePrice);
                }
                else {
                    Units = eval($("#tblContent tr:eq(" + RowIndex + ") td:eq(2)").text());
                    ItemCode = data[RowIndex - 1][5];
                    UnitsPerCase = data[RowIndex - 1][6];
                    RouteKey = sessionStorage.getItem("RouteKey");
                    Units = (Units == undefined || Units == '') ? 0 : parseInt(Units);
                    CurrQty = Units;     
                          
                    if(ObjIndex == 2)
                    {
                        if ((CurrQty > AvailQty) && transactiontypecode != 3)
                        {
                            getLangText("Qty not available");
                            $("#tblContent tr:eq(" + RowIndex + ") td:eq(" + ObjIndex + ")").text(0);
                            return false;
                        }
                    }
                        
                    Price = eval(data[RowIndex - 1][3]).toFixed(decimalplace);
                    //Calculating Total value
                    var Total = CheckIsNaN(eval(Units * data[RowIndex - 1][3]));
                    $("#tblContent tr:eq(" + RowIndex + ") td:eq(4)").text(Total.toFixed(decimalplace));                    
                    //Over                                                  
                    CheckInsert(ItemCode, RouteKey, CurrQty, Price,CasePrice);
                }
            }            

            // Insert/Update Quantity according to result.
            function CheckInsert(ItemCode, RouteKey, CurrQty, Price, CasePrice) {  
                          anytimetabclick = true;
                if(sessionStorage.getItem('batchsetting') ==1){
                          var selectqry = "select allowbatchentry from itemmaster where actualitemcode="+ItemCode;
                          if(platform=='iPad')
                          {
                          Cordova.exec(function(result) {
                                                     
                                                     if(eval(result[0][0]) == 0)
                                                     {
                                                     deletebatchexpiry(ItemCode,RouteKey,0, CurrQty,transactiontypecode,batchqty);                                                     }
                                                     
                                                     },
                                                     function(error) {
                                                     alert(error);},
                                                     "PluginClass", 
                                                     "GetdataMethod", 
                                                     [selectqry]);
                          }
                          else if(platform=='Android')
                          {
                          window.plugins.DataBaseHelper.select(selectqry,function(result)
                                                               {
                                                               
                                                               result = $.map(result.array, function (item, index) {
                                                                              
                                                                              return [[item.allowbatchentry]];
                                                                              });
                                                               if(eval(result[0][0]) == 0)
                                                               {
                                                                deletebatchexpiry(ItemCode,RouteKey,0, CurrQty,transactiontypecode,batchqty);
                                                               }
                                                               
                                                               
                                                               },
                                                               function()
                                                               {
                                                               console.warn("Error calling plugin");
                                                               });
                          }
                          if(CurrQty==0 || CurrQty=='')
                          {
                          console.log("in");
                          deletebatchexpiryreturn(ItemCode,RouteKey,0,CurrQty,transactiontypecode,batchqty);
                          }
                    }
                          var Qry = "UPDATE inventorytransactiondetail SET quantity=" + CurrQty + ",itemprice=" + Price + ",itemcaseprice= " + CasePrice + "  where istemp='true' and itemcode=" + ItemCode + " and routekey=" + RouteKey + " and transactiontypecode=" + transactiontypecode;
                    console.log(Qry);
                    if (platform == "iPad") {
                        Cordova.exec(function(result) {
                            
                        },
                        function(error) {
                            navigator.notification.alert(error);
                        },
                        "PluginClass",
                        "InsertUpdateMethod",
                        [Qry]);
                    }
                    else if (platform == "Android") {
                        window.plugins.DataBaseHelper.insert(Qry, function(result) {
                            
                        },
					    function() {
					        console.warn("Error calling plugin");
					    });
                    }               
            }
        
        // Function for getting Available Qty
        function getAvailQty(ItemNo) {
            //navigator.notification.alert(ItemNo);
            //var Qry = "Select ((ifnull(inventorysummarydetail.loadqty,0)+ifnull(inventorysummarydetail.loadadjustqty,0)+ifnull(inventorysummarydetail.beginstockqty,0) + ifnull(inventorysummarydetail.loadaddqty,0) - ifnull(inventorysummarydetail.loadcutqty,0) - ifnull(inventorysummarydetail.saleqty,0) + ifnull(inventorysummarydetail.returnqty,0) +ifnull(inventorysummarydetail.returnfreeqty,0) - ifnull(inventorysummarydetail.freesampleqty,0))/itemmaster.unitspercase) As LoadQty,(((ifnull(inventorysummarydetail.loadqty,0)+ifnull(inventorysummarydetail.loadadjustqty,0)+ifnull(inventorysummarydetail.beginstockqty,0) + ifnull(inventorysummarydetail.loadaddqty,0) - ifnull(inventorysummarydetail.loadcutqty,0) - ifnull(inventorysummarydetail.saleqty,0) + ifnull(inventorysummarydetail.returnqty,0) + ifnull(inventorysummarydetail.returnfreeqty,0) - ifnull(inventorysummarydetail.freesampleqty,0))%itemmaster.unitspercase)) As LoadUnit,itemmaster.unitspercase,itemmaster.defaultsalesprice,(ifnull(inventorysummarydetail.loadqty,0) +ifnull(inventorysummarydetail.loadadjustqty,0)+ ifnull(inventorysummarydetail.loadaddqty,0)+ifnull(inventorysummarydetail.beginstockqty,0) - ifnull(inventorysummarydetail.loadcutqty,0) - ifnull(inventorysummarydetail.saleqty,0) + ifnull(inventorysummarydetail.returnqty,0) + ifnull(inventorysummarydetail.returnfreeqty,0) - ifnull(inventorysummarydetail.freesampleqty,0)) As AvialableQty,unitspercase,ifnull(damageqty,0) as damageqty from inventorysummarydetail inner join itemmaster on inventorysummarydetail.itemcode = itemmaster.actualitemcode  and inventorysummarydetail.routekey = " + sessionStorage.getItem('RouteKey') + " where itemmaster.actualitemcode = " + ItemNo
             var Qry = "Select CASE WHEN itemmaster.unitspercase=1 THEN 0 ELSE ((ifnull(inventorysummarydetail.loadqty,0)+ifnull(inventorysummarydetail.loadadjustqty,0)+ifnull(inventorysummarydetail.beginstockqty,0) + ifnull(inventorysummarydetail.loadaddqty,0) - ifnull(inventorysummarydetail.loadcutqty,0) -   ifnull(inventorysummarydetail.saleqty,0) + ifnull(inventorysummarydetail.returnqty,0) +ifnull(inventorysummarydetail.returnfreeqty,0) - ifnull(inventorysummarydetail.freesampleqty,0))/itemmaster.unitspercase) END As LoadQty,CASE WHEN itemmaster.unitspercase=1 THEN (((ifnull(inventorysummarydetail.loadqty,0)+ifnull(inventorysummarydetail.loadadjustqty,0)+ifnull(inventorysummarydetail.beginstockqty,0) + ifnull(inventorysummarydetail.loadaddqty,0) - ifnull(inventorysummarydetail.loadcutqty,0) -  ifnull(inventorysummarydetail.saleqty,0) + ifnull(inventorysummarydetail.returnqty,0) + ifnull(inventorysummarydetail.returnfreeqty,0) - ifnull(inventorysummarydetail.freesampleqty,0)))) ELSE (((ifnull(inventorysummarydetail.loadqty,0)+ifnull(inventorysummarydetail.loadadjustqty,0)+ifnull(inventorysummarydetail.beginstockqty,0) + ifnull(inventorysummarydetail.loadaddqty,0) - ifnull(inventorysummarydetail.loadcutqty,0) -  ifnull(inventorysummarydetail.saleqty,0) + ifnull(inventorysummarydetail.returnqty,0) + ifnull(inventorysummarydetail.returnfreeqty,0) - ifnull(inventorysummarydetail.freesampleqty,0))%itemmaster.unitspercase)) END  As LoadUnit,itemmaster.unitspercase,itemmaster.defaultsalesprice,(ifnull(inventorysummarydetail.loadqty,0) +ifnull(inventorysummarydetail.loadadjustqty,0)+ ifnull(inventorysummarydetail.loadaddqty,0) +ifnull(inventorysummarydetail.beginstockqty,0)- ifnull(inventorysummarydetail.loadcutqty,0) - ifnull(inventorysummarydetail.saleqty,0) + ifnull(inventorysummarydetail.returnqty,0) + ifnull(inventorysummarydetail.returnfreeqty,0) - ifnull(inventorysummarydetail.freesampleqty,0)) As AvailableQty from inventorysummarydetail inner join itemmaster on inventorysummarydetail.itemcode = itemmaster.actualitemcode  and inventorysummarydetail.routekey =" + sessionStorage.getItem('RouteKey') + " where itemmaster.actualitemcode = " + ItemNo;
           
            console.log(Qry);
            if (platform == "iPad") {
                Cordova.exec(function(result) {
                    //navigator.notification.alert(result);
                    if (CaseEnabled)
                    {
                        if(ActiveIndex == 2) //for damage out damageqty considered as avail. qty
                            $("#AvailQty").text(parseInt(result[0][6]/result[0][5]) + "/" + parseInt(result[0][6]%result[0][5]));
                        else
                            $("#AvailQty").text(parseInt(result[0][0]) + "/" + parseInt(result[0][1]));
                    }
                    else
                    {
                        if(ActiveIndex == 2)
                            $("#AvailQty").text(parseInt(result[0][6]));
                        else
                            $("#AvailQty").text(parseInt(result[0][4]));
                    }

                    AvailQty = result[0][4];
                },
                function(error) {
                    navigator.notification.alert(error);
                },
                "PluginClass",
                "GetdataMethod",
                [Qry]);
            }
            else if (platform == "Android") {
                window.plugins.DataBaseHelper.select(Qry, function(result) {
                   
                   	if(result.array!=undefined){
	                    var res = $.map(result.array, function(item, index) {
	                        return [[item.LoadQty, item.LoadUnit, item.unitspercase, item.defaultsalesprice, item.AvailableQty,item.unitspercase,item.damageqty]];
	                    });
	
	                    var result = res;
	                    if (CaseEnabled)
	                        $("#AvailQty").text(parseInt(result[0][0]) + "/" + parseInt(result[0][1]));
	                    else
	                        $("#AvailQty").text(parseInt(result[0][4]));
	                    AvailQty = result[0][4];
                    }else{
                    	  $("#AvailQty").text("0/0");
                    	   AvailQty =0;
                    }
                },
				function() {
				    console.warn("Error calling plugin");
				});
            }
        }
        
        function OnAdd()
        {
        	if($("#ddlRoute").get(0).selectedIndex == 0 || eval($('select#ddlRoute option').length)==0)
            {
                getLangText("Please Select Depot/Route.");
                return false;
            }
            localStorage.transactiontypecode = transactiontypecode;
            sessionStorage.addmodule = 'inventory';
            window.location= "loadtransfer_itementry.html";
        }
        
        function OnSummary()
        {                 
        	if($("#ddlRoute").get(0).selectedIndex == 0 || eval($('select#ddlRoute option').length)==0)
            {
                getLangText("Please Select Depot/Route.");
                return false;
            }
            window.location= "transfersummary.html";
        }
        
        function OnBatch()
        {
        	if($("#ddlRoute").get(0).selectedIndex == 0 || eval($('select#ddlRoute option').length)==0)
            {
                getLangText("Please Select Depot/Route.");
                return false;
            }
        	
            localStorage.batchid ='loadtransfer';
            localStorage.transactiontypecode = transactiontypecode;            
            window.location= "../customer_opt/batch.html";
        }
        
        function OnCancel()
        {
            var Qry = "SELECT COUNT(*) as cnt FROM inventorytransactiondetail WHERE transactiontypecode IN(2,3,4) AND istemp = 'true' AND routekey= " + sessionStorage.getItem("RouteKey");
            console.log(Qry);
            if(platform == "iPad")
            {
                Cordova.exec(function(result) {                        
                        if(result[0][0] == 0)
                        {
                             ClearVariables();
                              window.location = "inventory.html";
                        }
                        else
                        {
                              ConfirmDiscard();
                        }
                    },
                    function(error) {
                        navigator.notification.alert(error);
                    },
                    "PluginClass",
                    "GetdataMethod",
                    [Qry]);                
            }
            else if(platform == "Android")
            {
                
                window.plugins.DataBaseHelper.select(Qry, function(result) {
                        if(result.array[0].cnt == 0)
                        {
                            ClearVariables();
                            window.location = "inventory.html";
                        }
                        else
                        {
                            ConfirmDiscard();
                        }
                    },
					function() {
					    console.warn("Error calling plugin");
					});
            } 
        }
        
        function ConfirmDiscard()
        {
            var msg = "Discard All Changes And Exit?";
            navigator.notification.confirm(msg,function(action){
                if(action == 1)
                {
                    var Qry = "DELETE FROM inventorytransactiondetail WHERE routekey=" + sessionStorage.getItem("RouteKey") + " AND istemp='true' AND transactiontypecode IN(2,3,4)";
                    var selectqry ="delete from batchexpirydetail where routekey=" + sessionStorage.getItem("RouteKey") + " AND istemp='true' AND transactiontypecode IN(2,3,4)";                
                    if(platform == "iPad")
                    {
                        Cordova.exec(function(result) {
                            Cordova.exec(function(result) {
                            	window.location = "inventory.html";
                            },
                            function(error) {
                            	navigator.notification.alert(error);
                            },
                            "PluginClass",
                            "InsertUpdateMethod",
                            [selectqry]);                            
                        },
                        function(error) {
                            navigator.notification.alert(error);
                        },
                        "PluginClass",
                        "InsertUpdateMethod",
                        [Qry]);
                    }
                    else if(platform == "Android")
                    {
                        window.plugins.DataBaseHelper.insert(Qry, function(result) {
                        	window.plugins.DataBaseHelper.insert(selectqry, function(result) {                        		
                            	window.location = "inventory.html";
                        	},
                        	function() {
                        		console.warn("Error calling plugin");
                        	});                            
                        },
                        function() {
                            console.warn("Error calling plugin");
                        });
                    }
                }
            });
        }
        
        function RemoveOnQuickAccess()
        {
            var Qry = "DELETE FROM inventorytransactiondetail WHERE routekey=" + sessionStorage.getItem("RouteKey") + " AND istemp='true' AND transactiontypecode IN(2,3,4)";
            var selectqry ="delete from batchexpirydetail where routekey=" + sessionStorage.getItem("RouteKey") + " AND istemp='true' AND transactiontypecode IN(2,3,4)";                
            if(platform == "iPad")
            {
                console.log(Qry);
                Cordova.exec(function(result) {
                    console.log(selectqry);
                    Cordova.exec(function(result) {                        
                    },
                    function(error) {
                        navigator.notification.alert(error);
                    },
                    "PluginClass",
                    "InsertUpdateMethod",
                    [selectqry]);                            
                },
                function(error) {
                    navigator.notification.alert(error);
                },
                "PluginClass",
                "InsertUpdateMethod",
                [Qry]);
            }
            else if(platform == "Android")
            {
                window.plugins.DataBaseHelper.insert(Qry, function(result) {
                    window.plugins.DataBaseHelper.insert(selectqry, function(result) {                        
                    },
                    function() {
                        console.warn("Error calling plugin");
                    });                            
                },
                function() {
                    console.warn("Error calling plugin");
                });
            }
        }
        
        // Checking Value is Number
        function CheckIsNaN(val)
        {
            if(isNaN(val))
                return 0;
            else
                return val;
        }
        
        function ClearVariables()
        {
            localStorage.removeItem("transactiontypecode");
            localStorage.removeItem("transferroute");
            localStorage.removeItem("transferroutecode");
        }
        
		
        function ValidateInventory()
        {          

        	
			//ddlRoute
			if($("#ddlRoute").get(0).selectedIndex == 0 || eval($('select#ddlRoute option').length)==0)
            {
                getLangText("Please Select Depot/Route.");
                return false;
            }
            var Qry = "SELECT IFNULL(SUM(quantity),0) as quantity FROM inventorytransactiondetail WHERE transactiontypecode IN(2,3,4) AND routekey=" + sessionStorage.getItem("RouteKey") + " AND istemp = 'true'";
            console.log(Qry);
            if(platform == "iPad")
            {
                Cordova.exec(function(result) {
                    if(result[0][0] == 0)
                    {
                        getLangText("No Items Entered.");
                        return false;
                    }                    
                    else
                    {
                    if(sessionStorage.getItem('batchsetting') ==1)
                        checkbatchselection();
                     else
                             window.location="printoption_loadtransfer.html";
                        }
                       
                },
                function(error) {
                    alert(error);
                },
                "PluginClass",
                "GetdataMethod",
                [Qry]);
            }
            else if(platform == "Android")
            {
                window.plugins.DataBaseHelper.select(Qry, function(result) 
                {   
                    if(result.array != undefined)
                    {
                        if(result.array[0].quantity == 0)
                        {
                            getLangText("No Items Entered.");
                            return false;
                        }                    
                        else
                        {
                        	if(sessionStorage.getItem('batchsetting') ==1){
                        		checkbatchselection();
                            }
                            else
                            	window.location="printoption_loadtransfer.html";
                        }
                    }
                    else{
                    		if(sessionStorage.getItem('batchsetting') ==1){
                    			checkbatchselection();
                    		}
                    		else
                    			window.location="printoption_loadtransfer.html";
                    }
                },
                function()
                {
                    console.warn("Error calling plugin");
                });
            }
        }
        
        //added by nidhi for check batch select or not
        function checkbatchselection()
        {
               
            var Qry ="select count(*) as cnt from inventorytransactiondetail where routekey="+sessionStorage.getItem("RouteKey")+" and istemp='true' and transactiontypecode in(2,3,4)  and quantity <> (select ifnull(sum(quantity),0) from batchexpirydetail where routekey="+sessionStorage.getItem("RouteKey")+" and transactiontypecode=inventorytransactiondetail.transactiontypecode and itemcode=inventorytransactiondetail.itemcode and istemp='true')";
            if(platform == "iPad")
            {
                Cordova.exec(function(result) { 
                              if(eval(result[0][0]) > 0)
                              {
                              getLangText("Please Select Batch.");
                              }
                              else
                              {
                              window.location="printoption_loadtransfer.html";
                              }
                              },
                              function(error) {
                              getLangText("Error in binding Reason : " + error);
                              },
                              "PluginClass", 
                              "GetdataMethod", 
                              [Qry]);
            }
            else if(platform == "Android")
            {
                window.plugins.DataBaseHelper.select(Qry,function(result)
                                                     {					 	
                                                     result = $.map(result.array, function (item, index) { 
                                                                    return [[item.cnt]];
                                                                    });
                                                     if(eval(result[0][0]) > 0)
                                                     {
                                                     getLangText("Please Select Batch.");
                                                     }
                                                     else
                                                     {
                                                     window.location="printoption_loadtransfer.html";
                                                     }
                                                     },
                                                     function()
                                                     {
                                                     console.warn("Error calling plugin");
                                                     });
            }
        }
        //delete batchentry
        function deletebatchexpiryreturn(ItemCode,RouteKey,VisitKey, CurrQty,transactiontypecode,batchqty)
        {
           
            var selectqry = "select batchnumber from batchexpirydetail where routekey="+RouteKey+" and visitkey="+VisitKey+" and itemcode="+ItemCode+" and transactiontypecode="+transactiontypecode;
            var Qry = "delete from batchexpirydetail where routekey="+RouteKey+" and visitkey="+VisitKey+" and itemcode="+ItemCode+" and transactiontypecode="+transactiontypecode;
            console.log(Qry);
            if(platform == "iPad")
            {
                Cordova.exec(function(result) {
                              if(result.length > 0)
                              {
                              for(i=0;i<result.length;i++)
                              {
                              updatebatchmastertempreturn(ItemCode,RouteKey,VisitKey, CurrQty,transactiontypecode,batchqty,result[i][0]);
                              }
                              Cordova.exec(function(result) {
                                            
                                            
                                            },
                                            function(error) {
                                            navigator.notification.alert(error);
                                            },
                                            "PluginClass",
                                            "InsertUpdateMethod",
                                            [Qry]);
                              }
                              
                              },
                              function(error) {
                              navigator.notification.alert("Error save promtion detail record");
                              },
                              "PluginClass",
                              "GetdataMethod",
                              [selectqry]);
            }
            else if(platform == "Android")
            {
                window.plugins.DataBaseHelper.select(selectqry, function(result) {
                                                     if(result.length > 0)
                                                     {
                                                     for(i=0;i<result.length;i++)
                                                     {
                                                     updatebatchmastertempreturn(ItemCode,RouteKey,VisitKey, CurrQty,transactiontypecode,batchqty,result[i][0]);
                                                     }
                                                     window.plugins.DataBaseHelper.insert(Qry, function(result) {
                                                                                          
                                                                                          
                                                                                          
                                                                                          },
                                                                                          function() {
                                                                                          console.warn("Error calling plugin");
                                                                                          });
                                                     }
                                                     
                                                     },
                                                     function() {
                                                     console.warn("Error calling plugin");
                                                     });
            }
            
            
            
        }
        function updatebatchmastertempreturn(ItemCode,RouteKey,VisitKey, CurrQty,transactiontypecode,batchqty,batchnumber)
        {
            var updateqry = "update batchmaster_temp set "+batchqty+"=0 where itemcode="+ItemCode+" and batchnumber='"+batchnumber+"'";
            console.log(updateqry);
            if(platform == "iPad"){
                Cordova.exec(function(result) {
                              
                              },
                              function(error) {
                              navigator.notification.alert(error);
                              },
                              "PluginClass",
                              "InsertUpdateMethod",
                              [updateqry]);
            }
            else if (platform == "Android") {
                window.plugins.DataBaseHelper.insert(updateqry, function(result) {
                                                     
                                                     },
                                                     function() {
                                                     console.warn("Error calling plugin");
                                                     });
            }
        }
        
        
        
    </script>

</body>
</html>
