<!--
 '  Created By   : Ankur Shah
 '  Created Date : 09/04/2012
 '  Description  : This page is used for sales options.
-->
<!DOCTYPE html>
<html>
<head>
<title>Sales</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0;maximum-scale=1.0;user-scalable=0; target-densitydpi=device-dpi">
	
<meta name="format-detection" content="telephone=no">
<link rel="stylesheet" href="../css/jquery.mobile-1.0.min.css" />
<link rel="stylesheet" href="../css/style.css" />
<link rel="stylesheet" href="../css/en.css" lang="en" />
<link rel="stylesheet"
	media="only screen and (min-width: 320px) and (max-width: 600px)"
	href="../css/style_600.css">
<link rel="stylesheet"
	media="only screen and (min-width: 601px) and (max-width: 700px)"
	href="../css/style_700.css">
<link rel="stylesheet"
	media="only screen and (min-width: 700px) and (max-width: 800px)"
	href="../css/style_800.css">
<link rel="stylesheet"
	media="only screen and (min-width: 1000px) and (max-width: 1200px)"
	href="../css/style_1200.css">
<link rel="stylesheet"
	media="only screen and (min-width: 1200px) and (max-width: 1500px)"
	href="../css/style_1400.css">

<script type="text/javascript" src="../js/jquery.js"></script>

<script type="text/javascript" src="../js/jquery.mobile-1.0.js"></script>

<script type="text/javascript" src="../js/common.js"></script>


<script src="../LangJS/jquery-lang.js" charset="utf-8"
	type="text/javascript"></script>

<script src="../LangJS/langpack/AR.js" charset="utf-8"
	type="text/javascript" lang="en"></script>

<link rel="stylesheet" type="text/css"
	href="../css/jquery.mobile.simpledialog.css" />

<script type="text/javascript" src="../js/jquery.mobile.simpledialog.js"></script>

<script type="text/javascript" src="../js/jquery.json-2.3.min.js"></script>
<script>
if (navigator.userAgent.toLowerCase().match(/android/)) {
document.write('<script charset="utf-8" src="../cordova-2.0.0.js"><\/script>');
document.write('<script charset="utf-8" src="../directoryListing.js"><\/script>');
} else if (navigator.userAgent.toLowerCase().match(/iphone/) || navigator.userAgent.toLowerCase().match(/ipad/)) {
document.write('<script charset="utf-8" src="../cordova-1.5.0.js"><\/script>');
}
</script>

</head>
<body>
	<div data-role="page" data-theme="d">
		<div>
			<img title="" alt="" src="../images/bg.png" id="background">
		</div>
		<div data-role="header" data-position="inline" id="bgclheader">
			<a href="#" id="Back_inner" rel="external" onclick="popup()"
				lang="en">Back</a> <div class="wrapper"><div class="card_content"><div><img title="" alt="" data-pushbar-target="left"  src="../images/icons8-menu-50.png" id="setting"></div></div></div> 
			<h1 lang="en">Unload</h1>
			<a href="#" id="lang_inner">EN</a>
		</div>
		<div data-role="content"
			class="centerbox">
			<div id="MenuListReview1">
			<!--   <div class="content-primary">
					<ul data-role="listview">
						<li><a id="lnkOnShelf" href="unload_empty.html"
							rel="external"> <img src="../images/empty-cont.png"
								class="HomeIconPosEN" />
								<h3 id="lblOnShelf" lang="en">Empty Containers</h3>
						</a></li>
					</ul>
				</div>
				<div class="second-primary">
					<ul data-role="listview">
						<li><a id="lnkSalesInvoice" href="unload_badreturn.html"
							onclick="" rel="external"> <img
								src="../images/bed-return.png" class="HomeIconPosEN" />
								<h3 id="lblSalesInvoice" lang="en">Bad Returns</h3>
						</a></li>
					</ul>
				</div>
				<div class="content-primary">
					<ul data-role="listview">
						<li><a id="lnkGoodReturns" href="unload_truckdamage.html"
							rel="external"> <img src="../images/truck-damage.png"
								class="HomeIconPosEN" />
								<h3 id="lblGoodReturns" lang="en">Truck Damage</h3>
						</a></li>
					</ul>
				</div>
<!-- 				<div class="second-primary">
					<ul data-role="listview">
						<li><a id="lnkBadReturns" href="unload_fresh.html"
							rel="external"> <img src="../images/fresh-unload.png"
								class="HomeIconPosEN" />
								<h3 id="lblBadReturns" lang="en">Fresh Unload</h3>
						</a></li>
					</ul>
				</div> -->
				<div class="content-primary">
					<ul data-role="listview">
						<li><a id="lnkRental" href="unload_endinginv.html"
							rel="external"> <img src="../images/ending-inventory.png"
								class="HomeIconPosEN" />
								<h3 id="lblRental" lang="en">Ending Inventory</h3>
						</a></li>
					</ul>
				</div>

				<div class="second-primary">
					<ul data-role="listview">
						<li><a id="lnkRental" href="unloadsummary.html"
							rel="external"> <img src="../images/doc.png"
								class="HomeIconPosEN" />
								<h3 id="lblRental" lang="en">Unload Summary</h3>
						</a></li>
					</ul>
				</div>
				<div class="content-primary">
					<ul data-role="listview">
						<li><a id="lnkRental" onclick="checkunloadvariance()"
							href="#" rel="external"> <img src="../images/print.png"
								class="HomeIconPosEN" />
								<h3 id="lblRental" lang="en">Print Reports</h3>
						</a></li>
					</ul>
				</div>

			</div>
		</div>
		 <div id="f1" data-role="footer" class="ui-bar">
            <div class="footer">
                <div class="leftfooter">
                    09 November 2011</div>
                <div class="rightfooter">
                    Mirnah Technology Systems</div>
            </div>
        </div>
        <div id="f2" data-role="footer" style="bottom: 0; position: absolute;">
        	 <aside data-pushbar-id="left" class="pushbar from_left">
		<div class="title"><span data-pushbar-close class="close push_right"></span>
			<span id="txtroute"></span>
		</div>

		<ul class="menu">
		<li style="margin-bottom: 0 !important;" > 
		<img title="" alt="" src="../images/startday-icon.png" id="day"  class="leftmenu" >
		 <a href="#"
						class="ui-btn-active" rel="external" id="day" data-icon="custom"  
						lang="en" onclick="footerredict('../startofday/startofday.html')">Start day</a></li>
					<li style="margin-bottom: 0 !important;">
					 <img title="" alt="" src="../images/Inventoryicon.png" id="inve"  class="leftmenu">
					 <a href="#" id="inve"
						rel="external" data-icon="custom" lang="en"
						onclick="footerredict('../inventory/inventory.html')">Inventory</a></li>
					<li style="margin-bottom: 0 !important;">
					 <img title="" alt="" src="../images/customer-icon.png" id="cust" class="leftmenu">
					 <a href="#"
						rel="external" id="cust" data-icon="custom" lang="en"
						onclick="footerredict('../customer/customer_operation.html')">Customer</a></li>
					<li style="margin-bottom: 0 !important;">
					<img title="" alt="" src="../images/Money-icon.png" id="sett" class="leftmenu">
					<a href="#"
						rel="external" id="sett" data-icon="custom" lang="en"
						onclick="footerredict('../settlement/managesettlement.html')">Settlement</a></li>
					<li style="margin-bottom: 0 !important;">
					<img title="" alt="" src="../images/expense-icon.png" id="expe" class="leftmenu">
					<a href="#"
						rel="external" id="expe" data-icon="custom" lang="en"
						onclick="footerredict('../settlement/expenseentry.html')">Expenses</a></li>
					<li style="margin-bottom: 0 !important;">
					<img title="" alt="" src="../images/information-icon.png" id="info" class="leftmenu" >
					<a href="#"
						rel="external" id="info" data-icon="custom" lang="en"  
						onclick="footerredict('../information/information.html')">Information</a></li>
					<li style="margin-bottom: 0 !important; ">
					 <img title="" alt="" src="../images/user-settings-icon.png" id="setup" class="leftmenu">
					 <a href="#" rel="external" id="setup" data-icon="custom" lang="en"
						onclick="footerredict('../utilities/utilities.html')">Utilities</a></li>
		</ul>

	</aside>
            <div data-role="navbar" data-iconpos="top" data-grid="f">
                <ul>
                    <li style="margin-bottom:0 !important;"><a href="#" rel="external" id="day" data-icon="custom" lang="en" onclick="footerredict('../startofday/startofday.html')">Start day</a></li>
			        <li style="margin-bottom:0 !important;"><a href="#" id="inve" class="ui-btn-active" rel="external" data-icon="custom" lang="en" onclick="footerredict('../inventory/inventory.html')">Inventory</a></li>
			        <li style="margin-bottom:0 !important;"><a href="#" rel="external" id="cust" data-icon="custom" lang="en" onclick="footerredict('../customer/customer_operation.html')">Customer</a></li>
			        <li style="margin-bottom:0 !important;"><a href="#" rel="external" id="sett" data-icon="custom" lang="en" onclick="footerredict('../settlement/managesettlement.html')">Settlement</a></li>
			        <li style="margin-bottom:0 !important;"><a href="#" rel="external" id="expe" data-icon="custom" lang="en" onclick="footerredict('../settlement/expenseentry.html')">Expenses</a></li>
			        <li style="margin-bottom:0 !important;"><a href="#" rel="external" id="info" data-icon="custom" lang="en" onclick="footerredict('../information/information.html')">Information</a></li>
			        <li style="margin-bottom:0 !important; width:14.0%"><a href="#" rel="external" id="setup" data-icon="custom" lang="en" onclick="footerredict('../utilities/utilities.html')">Utilities</a></li>
                </ul>
            </div>
        </div>
    </div>    


	<script type="text/javascript" language="javascript">
        window.lang = new jquery_lang_js();
        var platform='';
        var promotionKeyplan=0;
        var InvoiceNumber,DocumentNumber;
        var decimalplace = sessionStorage.getItem("decimalplace");
        var data=[];
         resizeOrientationWindow();
        $(document).ready(function() {
       		resizeWindow();
             platform= sessionStorage.getItem("platform");             
           document.addEventListener("deviceready", getSetting, false);
        // sujee added side bar ----------------- START ------------------------ 

	          var pushbar = new Pushbar({
	blur:true,
	overlay:true,
});
$("#txtroute").text("ROUTE #: " + sessionStorage.getItem("RouteCode")); 
window.setInterval(function(){
	var randomColor = '#'+ ('000000' + Math.floor(Math.random()*16777215).toString(16)).slice(-6);
	$('#txtroute').css({
			'color' : randomColor,
	});
		}, 2000);
//----------------------------- END -------------------------  
                          
            //Set current date in footer
            $(".leftfooter").html(getCurrentDate());

            //Fetch current language and set that language.
            var lan = sessionStorage.getItem("Language");
            window.lang.run(lan);

            //Check for current language and set css for that
            if (sessionStorage.getItem("Language") != "en") {
                var val = 'UnloadOption' + lan;
                window.lang.change(val, lan);
                window.lang.change('Footer' + lan, lan);

                if (lan == "AR") {
                    
                    //Set html right alignment for arbic language
                    $(".centerboxInvReq").attr("dir", "rtl");

                    //Set menu icon with text
                    $('#MenuListReview1 .ui-icon').removeClass('ui-icon-arrow-r');
                    $('#MenuListReview1 .ui-icon').addClass('ui-icon-arrow-r1');
                    $('li.ui-btn').removeClass('ui-btn-icon-right');
                    $('li.ui-btn').addClass('ui-btn-icon-left');

                    //Set header align                    
                    $('#Back_inner').removeClass('ui-btn-left ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
                    $('#Back_inner').addClass('ui-btn-right ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
                    $('#lang_inner').removeClass('ui-btn-right ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
                    $('#lang_inner').addClass('ui-btn-left ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');

                }

            }
            else {

                //Change current language to english
                window.lang.change('en', 'en');

                //Set html left alignment for english language
                $(".centerboxInvReq").attr("dir", "ltr");

                //Set menu icon with text
                $('#MenuListReview1 .ui-icon').removeClass('ui-icon-arrow-r1');
                $('#MenuListReview1 .ui-icon').addClass('ui-icon-arrow-r');
                $('li.ui-btn').removeClass('ui-btn-icon-left');
                $('li.ui-btn').addClass('ui-btn-icon-right');

                //Set header align             
                $('#Back_inner').removeClass('ui-btn-right ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
                $('#Back_inner').addClass('ui-btn-left ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
                $('#lang_inner').removeClass('ui-btn-left ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
                $('#lang_inner').addClass('ui-btn-right ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');

            }

        });
        
        
        function getSetting()
        {
            var Qry ="select autocalculateloadin from routemaster where routecode="+sessionStorage.getItem("RouteCode");
            if (platform == 'iPad') {
                Cordova.exec(function(result) {
                              autoload = result[0][0];
                              sessionStorage.setItem("autoload",autoload); 
                              
                              },
                              function(error) {
                              alert(error);
                              },
                              "PluginClass",
                              "GetdataMethod",
                              [Qry]);
            }
            else if (platform == 'Android') {
                window.plugins.DataBaseHelper.select(Qry, function(result) {
                                                     autoload = result.array[0].autocalculateloadin;
                                                    
                                                     sessionStorage.setItem("autoload",autoload); 
                                                     window.localStorage.setItem("autoloadlocal", autoload);
                                                     checkInvoiceSequence();
                                                     },
                                                     function() {
                                                     console.warn("Error calling plugin");
                                                     });
            }
        }
        //function to check invoice 
        function checkInvoiceSequence(){
        	  var routecode=sessionStorage.getItem("RouteCode");
        	  var selectQry="select (select ifnull(max(invoicenumber),0) from invoiceheader where istemp='false' and ifnull(dexflag,0)=0) as ihMax,(select ifnull(max(invoicenumber),0) from arheader where istemp='false') arMax,(select ifnull(max(invoicenumber),0) from salesorderheader where istemp='false') srMax,(select ifnull(max(invoicenumber),0) from invoiceheader where istemp='false' and ifnull(dexflag,0)=1) as ihretMax,(select hhcarseq from routemaster where routecode="+routecode+") as arseq,(select hhcinvseq from routemaster where routecode="+routecode+") as invseq,(select hhcordseq from routemaster where routecode="+routecode+") as ordseq,(select hhcinvretseq from routemaster where routecode="+routecode+") as invretseq";
        	 
        	  if (platform == "iPad") {
        		  
        	  
        	  }
        	  else
        	  {
        		  
        		  		window.plugins.DataBaseHelper.select(selectQry,function(result)
                		{		
                                  var array = $.map(result.array, function (item, index) {               
                                    return [[item.ihMax,item.arMax,item.srMax,item.ihretMax,item.ihinvswapMax,item.invseq,item.arseq,item.ordseq,item.invretseq,item.invswapseq]];
                                  });
                                 
                                  if(array!=undefined && array!=null){
                                	
                                	  var routecodelength=eval(routecode.length)+1;
                                	  var invMAX=array[0][0];
                                	  var arMAX=array[0][1];
                                	  var ordMAX=array[0][2];
                                	  var invretMAX=array[0][3];
                                	  var invswapMAX=array[0][4];
                                	  
                                	  var invSeq=eval(array[0][5]);
                                	  var arSeq=eval(array[0][6]);
                                	  var ordSeq=eval(array[0][7]);
                                	  var invretSeq=array[0][8];
                                	  var invswapSeq=array[0][9];
                                	  
                                	  var diffINV=0;
                                	  var diffAR=0;
                                	  var diffORD=0;
                                	  var diffRINV=0;
                                	  var diffRSINV=0;
                                	  if(invMAX!=undefined && invMAX!=0){
                                		 
                                		  var acINVMax=parseInt(invMAX.substr(routecodelength,invMAX.length),10);
                                		 
                                		  diffINV=eval(acINVMax)-eval(invSeq);
                                		
                                		  if(diffINV==null || diffINV< 0 || diffINV==undefined){
                                			  diffINV=0;
                                			  
                                		  }
                                		  
                                	  }
                                		  
                                	  
                                	  if(arMAX!=undefined && arMAX!=0){
                                		  var acARMax=parseInt(arMAX.substr(routecodelength,arMAX.length),10);
                                		  diffAR=eval(acARMax)-eval(arSeq);
                                		 
                                		  if(diffAR=='' || diffAR<0 || diffAR==undefined){
                                			  diffAR=0;
                                			  
                                		  }
                                	  }
                                		 
                                	  
                                	  if(ordMAX!=undefined && ordMAX!=0){
                                		  var acORDMax=parseInt(ordMAX.substr(routecodelength,ordMAX.length),10);
                                		  diffORD=eval(acORDMax)-eval(ordSeq);
                                		  if(diffORD=='' || diffORD<0 || diffORD==undefined){
                                			  diffORD=0;
                                			  
                                		  }
                                	  }
                                    	
                                	  if(invretMAX!=undefined && invretMAX!=0){
                                		  var acINVRETMax=parseInt(invretMAX.substr(routecodelength,invretMAX.length),10);
                                		  diffRINV=eval(acINVRETMax)-eval(invretSeq);
                                		  if(diffRINV=='' || diffRINV<0 || diffRINV==undefined){
                                			  diffRINV=0;
                                			  
                                		  }
                                	  }
                                	  
                                	  if(invswapMAX!=undefined && invswapMAX!=0){
                                		  var acINVSWAPMax=parseInt(invswapMAX.substr(routecodelength,invswapMAX.length),10);
                                		  diffRSINV=eval(acINVSWAPMax)-eval(invswapSeq);
                                		  if(diffRSINV=='' || diffRSINV<0 || diffRSINV==undefined){
                                			  diffRSINV=0;
                                			  
                                		  }
                                	  }
                                	  
                                	  
                                	  var updateQry = "UPDATE routemaster SET hhcinvseq = (ifnull(hhcinvseq,0) + "+diffINV+"),hhcarseq = (ifnull(hhcarseq,0) + "+diffAR+"),hhcordseq = (ifnull(hhcordseq,0) + "+diffORD+"),hhcinvretseq = (ifnull(hhcinvretseq,0) + "+diffRINV+"),hhcinvswapseq = (ifnull(hhcinvswapseq,0) + "+diffRSINV+") WHERE routecode=" + sessionStorage.getItem("RouteCode");
                                	  window.plugins.DataBaseHelper.insert(updateQry,function(result){   
                                		  UpdateDocumentSequence();
                                 	     
                                	  },
                                	  function()
                                	  {
                                         console.warn("Error calling plugin");
                                	  });   
                                	 
                                  }
                              	                                                
      					  },
    					  function()
    					  {
    					   	 console.warn("Error calling plugin");
    					  });
        		  
        		  
        	  }
        	
        }
        
        function popup()
        {
            var Qry ="select count(*) as cnt from transactiondetailtemp where freshunloadqty > 0 OR endinvqty > 0 OR truckdamageqty > 0";
            if (platform == 'iPad') {
                Cordova.exec(function(result) {
                              if(eval(result[0][0]) > 0)
                              {
                               var res = navigator.notification.confirm("Discard All Changes And Exit?",onConfirm);
                              }
                              else
                              {
                              window.location ='inventory.html';
                              }
                              
                              },
                              function(error) {
                              alert(error);
                              },
                              "PluginClass",
                              "GetdataMethod",
                              [Qry]);
            }
            else if (platform == 'Android') {
                window.plugins.DataBaseHelper.select(Qry, function(result) {
                                                     if(eval(result.array[0].cnt) > 0)
                                                     {
                                                     	var res = navigator.notification.confirm("Discard All Changes And Exit?",onConfirm);
                                                     }
                                                     else
                                                     {
                                                     window.location ='inventory.html';
                                                     }
                                                     
                                                     },
                                                     function() {
                                                     console.warn("Error calling plugin");
                                                     });
            }
        }
        function onConfirm(button)
        {               
            if(button == 1)
            {
               window.location ='inventory.html';  
            }
        }
        function onConfirm1(button)
        {               
            if(button == 1)
            {
               updateLoadRequesHeadertData();
            }
        }
        function checkunloadvariance()
        {
           	localStorage.printinv ='unload';
            var Qry ="select unloadoversellmessage,inventoryvariance from routemaster where routecode="+sessionStorage.getItem('RouteCode');
            var selectqry ="select count(*) as cnt from transactiondetailtemp where (ifnull(vanstock,0)-ifnull(truckdamageqty,0)-ifnull(freshunloadqty,0)) <> ifnull(endinvqty,0) and ifnull(endinvqty,0) >0";
            console.log(selectqry);
            var selectqry1 ="select count(*) as cnt from transactiondetailtemp where (ifnull(vanstock,0)-ifnull(truckdamageqty,0)-ifnull(freshunloadqty,0)-ifnull(endinvqty,0)) >0";
            console.log(selectqry1);
            if (platform == 'iPad') {
                Cordova.exec(function(result) {
                              if(eval(result[0][0]) ==1 || eval(result[0][1]) ==1 || eval(result[0][1]) ==0)
                              {
                              Cordova.exec(function(result1) {
                                            if(eval(result1[0][0]) >0)
                                            {
                                                if(eval(result[0][0]) ==1)
                                                {
                                                var res = navigator.notification.confirm("Unload Variance is there do you want to continue?",onConfirm1);
                                                }
                                                else if(eval(result[0][1]) ==1 || eval(result[0][1]) ==0)
                                                {
                                                    getLangText("Variance Not Allowed.");
                                                    return false;
                                                }
                                            
                                            
                                            }
                                            else
                                            {
                                            window.location='printoption.html';
                                            }
                                            
                                            },
                                            function(error) {
                                            alert(error);
                                            },
                                            "PluginClass",
                                            "GetdataMethod",
                                            [selectqry]);
                             
                              }
                              else if(eval(result[0][1]) ==3)
                              {
                              Cordova.exec(function(result) {
                                            if(eval(result[0][0]) >0)
                                            {
                                            
                                            getLangText("Only Shortage Variance Qty Allowed.");
                                            return false;
                                           
                                            }
                                            else
                                            {
                                            window.location='printoption.html';
                                            }
                                            
                                            },
                                            function(error) {
                                            alert(error);
                                            },
                                            "PluginClass",
                                            "GetdataMethod",
                                            [selectqry1]);
                              }
                              else
                              {
                              window.location='printoption.html';
                              }
                              
                              },
                              function(error) {
                              alert(error);
                              },
                              "PluginClass",
                              "GetdataMethod",
                              [Qry]);
            }
            else if (platform == 'Android') {
                window.plugins.DataBaseHelper.select(Qry, function(result) {
                                                     if(eval(result.array[0].unloadoversellmessage) ==1 || eval(result.array[0].inventoryvariance) ==1 || eval(result.array[0].inventoryvariance) ==0)
                                                     {
                                                     window.plugins.DataBaseHelper.select(selectqry, function(result1) {
                                                                                          if(eval(result1.array[0].cnt) >0)
                                                                                        {
                                                                                          if(eval(result.array[0].unloadoversellmessage) ==1)
                                                                                          {
                                                                                          var res = navigator.notification.confirm("Unload Variance is there do you want to continue?",onConfirm1);
                                                                                          }
                                                                                          else if(eval(result.array[0].inventoryvariance) ==1 || eval(result.array[0].inventoryvariance) ==0)
                                                                                          {
                                                                                          getLangText("Variance Not Allowed.");
                                                                                          return false;
                                                                                          }
                                                                                          else
                                                                                          {
                                                                                         	updateLoadRequesHeadertData();
                                                                                          }
                                                                                        }
                                                                                        else
                                                                                            {
                                                                                           		updateLoadRequesHeadertData();
                                                                                            }
                                                                                          },
                                                                                          function() {
                                                                                          console.warn("Error calling plugin");
                                                                                          });
                                                     }
                                                     else if(eval(result.array[0].inventoryvariance) ==3)
                                                     {
                                                     window.plugins.DataBaseHelper.select(selectqry1, function(result) {
                                                                                          if(eval(result.array[0].inventoryvariance) >0)
                                                                                          {
                                                                                          
                                                                                          getLangText("Only Shortage Variance Qty Allowed.");
                                                                                          return false;
                                                                                          
                                                                                          }
                                                                                          else
                                                                                          {
                                                                                         	updateLoadRequesHeadertData();
                                                                                          }
                                                                                          
                                                                                          },
                                                                                          function() {
                                                                                          console.warn("Error calling plugin");
                                                                                          });
                                                     }
                                                     else
                                                     {
                                                    	 updateLoadRequesHeadertData();
                                                     }
                                                     
                                                     },
                                                     function() {
                                                     console.warn("Error calling plugin");
                                                     });
            }
            
        }
        
        function updateLoadRequesHeadertData(){
        	
        	
        	var Qry = "Update inventorytransactionheader set issync=0 where transactiontype=4";
            console.log(Qry);
            if(platform == "iPad")
            {
                Cordova.exec(function(result) {    
                              
                     updateLoadRequesDetailData();         
                              
                },
                function(error) {
                
                },
                "PluginClass",
                "InsertUpdateMethod",
                [Qry]);
            }
            else if(platform == "Android")
            {
                window.plugins.DataBaseHelper.insert(Qry, function(result) 
                {                       
                
                		updateLoadRequesDetailData();
                                                       
                },
                function() 
                {
                	updateLoadRequesDetailData();
                	console.warn("Error calling plugin");
                });
            }
        
        
        }
         function updateLoadRequesDetailData(){
        	
        	
        	var Qry = "Update inventorytransactiondetail set issync=0 where transactiontypecode=8";
            console.log(Qry);
            if(platform == "iPad")
            {
                Cordova.exec(function(result) {    
                              
                      window.location ='printoption.html';          
                              
                },
                function(error) {
                
                },
                "PluginClass",
                "InsertUpdateMethod",
                [Qry]);
            }
            else if(platform == "Android")
            {
                window.plugins.DataBaseHelper.insert(Qry, function(result) 
                {                       
                	getAutopostingSetting();
                },
                function() 
                {
                	redirect();
                	console.warn("Error calling plugin");
                });
            }
        
        
        }
        function getAutopostingSetting(){
        	sessionStorage.setItem("varianceavailable",0);
        	sessionStorage.setItem("varianceinvoice",0);
        	var Qry="select rm.enableautopostingaccount as autoposting, rm.variancecustomercode as customercode from startendday sd inner join routemaster rm where sd.routecode=rm.routecode"; 
        
        	if (platform == 'iPad') {
                
            }
            else if (platform == 'Android') {
                window.plugins.DataBaseHelper.select(Qry, function(result) 
                {
                
                			 var autoposting=eval(result.array[0].autoposting);
                			 var customercode=eval(result.array[0].customercode);
                			 	
                              if(eval(autoposting) > 0)
                              {
                            	  
                            	sessionStorage.setItem("customerid",customercode);
                              	getAutoPostingData(customercode);
                              	
                              	
                              }
                              else
                              {
                              		redirect();
                              }
                              
                },
                function() {
                		console.warn("Error calling plugin");
                });
            }
        	
        
        
        
        }
        
        function getAutoPostingData(customercode){
        	
        	var Qry="select actualitemcode,varianceqty,caseprice,defaultsalesprice,im.unitspercase as upc,ifnull(varianceqty*defaultsalesprice,0) as amount from transactiondetailtemp tmp inner join itemmaster im on im.actualitemcode=tmp.itemcode where varianceqty!=0";
        	if (platform == 'iPad') {
                
            }
            else if (platform == 'Android') {
                window.plugins.DataBaseHelper.select(Qry, function(result) 
                {
                	
                	if(result.array!=undefined){
                		
                	
		                	var result = $.map(result.array, function(item, index) {
		                          return [[item.amount,item.actualitemcode,item.varianceqty, item.caseprice, item.defaultsalesprice,item.upc]];
		                    });
		                	data=result;
                
                			if(result.length>0)
		                	{
		                			
		                		CheckSequenceCustomer(customercode);
		                		
		                	}
		                	else
		                	{
		                	
		                		redirect();
		                	
		                	}
                	}else{
                		
                		redirect();
                	}
                },
                function() {
                		console.warn("Error calling plugin");
                });
            }
        
        }
        /* start invoice creation*/
        function CheckSequenceCustomer(customercode){
       	 
       	 	var d = new Date();
            var n = d.getDay();
       	 	var array = ['sunseq','monseq','tueseq','wedseq','thuseq','friseq','satseq'];
            var callarray=['callrestrictiondays7','callrestrictiondays1','callrestrictiondays2','callrestrictiondays3','callrestrictiondays4','callrestrictiondays5','callrestrictiondays6'];
            var days = array[n];
            var calldays = callarray[n];
       	 	var rp32weeknumber=sessionStorage.getItem("rp32weeknumber");
       	 	var routesequenceplanflag= window.localStorage.getItem("routesequenceplanflag");
            if(routesequenceplanflag==1){
				    rp32weeknumber=9;
				    sessionStorage.setItem("rp32weeknumber",rp32weeknumber);
            }
            var seqQuery="select count(*) as count from routesequence where customercode="+customercode+" and rp32weeknumber="+rp32weeknumber+" and "+calldays+"=1";
       	 
            window.plugins.DataBaseHelper.select(seqQuery,function(result)
            {
           	 	
                    if(eval(result.array[0].count)>0)
                    {
                   	 insertroutesequence(customercode,1);
                    }else
                    {
                   	 insertroutesequence(customercode,0);
                    }
                   
            },
            function()
            {
           	 console.warn("Error calling plugin");
            });
       	 
        }   
	    function insertroutesequence(customercode,schedulflag)
	    {
	    	platform= sessionStorage.getItem("platform");
	    	if (platform == 'iPad') {
	        Cordova.exec(function(result) {
			            if (result[0][0] == 0) {
			                var customercode = sessionStorage.getItem("customerid");
			                var seqweeknumber = sessionStorage.getItem("rp32weeknumber");
			                var callarray = ['callrestrictiondays7', 'callrestrictiondays1', 'callrestrictiondays2', 'callrestrictiondays3', 'callrestrictiondays4', 'callrestrictiondays5', 'callrestrictiondays6'];
			                var calldays = sessionStorage.getItem("calldays");
			                var index = $.inArray(calldays, callarray);
			                if (index == 0)
			                    callindex = 7;
			                else
			                    callindex = index;
			                var seqnumber = 0;
			                var seduleflag = schedulflag;
			                var servicedflag = 1;
			                var scannedflag = 0;
			                var platform = sessionStorage.getItem("platform");
			                var insertqry = "insert into routesequencecustomerstatus('routekey','seqweeknumber','seqweekday','routecode','customercode','sequencenumber','schelduledflag','servicedflag','scannedflag','issync') values(" + sessionStorage.getItem("RouteKey") + ",'" + seqweeknumber + "','" + callindex + "','" + sessionStorage.getItem("RouteCode") + "','" + customercode + "','" + seqnumber + "','" + seduleflag + "','" + servicedflag + "','" + scannedflag + "',0)";
			                console.log(insertqry);
			                Cordova.exec(function(result) {
			                   
			                },
			                function(error) {
			                    navigator.notification.alert(error);
			                },
			                "PluginClass",
			                "InsertUpdateMethod",
			                [insertqry]);
			            }
			            else
			            {
								if (msgflag == false)
						                        window.location = '../customer_opt/cust_opt.html';
						                    else {
						                        localStorage.message = 'cust';
						                        window.location = 'customer_messages.html';
						                    }
							    }
			        		},
	                        function(error) {
	                            alert(error);
	                        },
	                        "PluginClass",
	                        "GetdataMethod",
	                        ["select count(*) as cnt from routesequencecustomerstatus where routekey=" + sessionStorage.getItem("RouteKey") + " and customercode=" + sessionStorage.getItem("customerid")]);
	
			    }
			    else if (platform == 'Android') {
	        		window.plugins.DataBaseHelper.select("select count(*) as cnt from routesequencecustomerstatus where routekey=" + sessionStorage.getItem("RouteKey") + " and customercode=" + sessionStorage.getItem("customerid"), function(result) 
	        		{
				            if (result.array[0].cnt == 0) {
				               
				                var seqweeknumber = sessionStorage.getItem("rp32weeknumber");
				                var callarray = ['callrestrictiondays7', 'callrestrictiondays1', 'callrestrictiondays2', 'callrestrictiondays3', 'callrestrictiondays4', 'callrestrictiondays5', 'callrestrictiondays6'];
				                var calldays = sessionStorage.getItem("calldays");
				                var index = $.inArray(calldays, callarray);
				                if (index == 0)
				                    callindex = 7;
				                else
				                    callindex = index;
				                var seqnumber = 0;
				                if(seqnumber==undefined){
				                	seqnumber=0;
				                }
				                var seduleflag = schedulflag;
				                var servicedflag = 1;
				                var scannedflag = 0;
				                var platform = sessionStorage.getItem("platform");
				                var insertqry = "insert into routesequencecustomerstatus('routekey','seqweeknumber','seqweekday','routecode','customercode','sequencenumber','schelduledflag','servicedflag','scannedflag','issync') values(" + sessionStorage.getItem("RouteKey") + ",'" + seqweeknumber + "','" + callindex + "','" + sessionStorage.getItem("RouteCode") + "','" + customercode + "','" + seqnumber + "','" + seduleflag + "','" + servicedflag + "','" + scannedflag + "',0)";
				                console.log(insertqry);
				                window.plugins.DataBaseHelper.insert(insertqry, function(result) {
				                	SetVisitKey();
				                },
				                function() {
				                  console.warn("Error calling plugin");
				                });
				            }
						    else
						    {
						    	SetVisitKey();
						    }
				        },
						function() {
						    console.warn("Error calling plugin");
						});
	        		}
		}
	    function SetVisitKey() {
                      
           
			var selectqry="select ifnull(max(visitkey),0) as VisitKey,totaltransactions,reasoncode from customeroperationscontrol where routekey = " + sessionStorage.getItem("RouteKey")+" and reasoncode=1000";
            console.log(selectqry);
            var platform= sessionStorage.getItem("platform");
            if(platform=='iPad')
            {
                Cordova.exec(function(result) {
                              
                                 if(eval(result[0][1]) > 0 || eval(result[0][2]) > 0)
                                   InserVisitKeys();
                                 else
                                   deletetransaction(result[0][0]);   
                              
                              },
                              function(error) {
                              alert(error);
                              },
                              "PluginClass",
                              "GetdataMethod",
                              [selectqry]);
            }
            else if(platform=='Android')
            {
                 window.plugins.DataBaseHelper.select(selectqry,function(result)
				 {
							 if(eval(result.array[0].reasoncode)==1000)
								 deletetransaction(result.array[0].VisitKey);
							 else
								 InserVisitKeys();
				 },
				 function()
				 {
				 console.warn("Error calling plugin");
				 });
            }
           
        }
	    function deletetransaction(VisitKey)
        {
            var platform= sessionStorage.getItem("platform");
            var deleteqry="delete from customeroperationscontrol where routekey = " + sessionStorage.getItem("RouteKey")+" and visitkey="+VisitKey;
            console.log(deleteqry);
            if(platform=='iPad')
            {
                	Cordova.exec(function(result) 
                    {
                              var Tbls = ["invoicedetail","cashcheckdetail"," invoiceheader","invoicerxddetail"];
                              for(i=0;i<Tbls.length;i++)
                              {
	                                         
		                           var Qry = "DELETE FROM " + Tbls[i] + " WHERE  routekey=" + sessionStorage.getItem("RouteKey") + " and visitkey=" + VisitKey;
		                              
	                               console.log(Qry);
	                               Cordova.exec(function(result) {
	                                           
	                            	   				InserVisitKeys();
	                                            
	                                            },
	                                            function(error) {
	                                            alert(error);},
	                                            "PluginClass", 
	                                            "InsertUpdateMethod", 
	                                            [Qry]);
	                              }
                              
                              
                              
                              },
                              function(error) {
                              alert(error);
                              },
                              "PluginClass",
                              "InsertUpdateMethod",
                              [deleteqry]);
            }
            else if(platform=='Android')
            {
					 window.plugins.DataBaseHelper.insert(deleteqry,function(result)
                     {
						 var Tbls = ["invoicedetail","cashcheckdetail","invoiceheader"];
                         for(var i=0;i<Tbls.length;i++)
                         {
                                     
                              var Qry = "DELETE FROM " + Tbls[i] + " WHERE routekey=" + sessionStorage.getItem("RouteKey") + " and visitkey=" + VisitKey;
                             
                              console.log(Qry);
                              window.plugins.DataBaseHelper.insert(Qry,function(result)
                              {
                            	
                            	
                              },
                              function()
                              {
                              console.warn("Error calling plugin");
                              });
                         }
                         InserVisitKeys();
                    
                     },
                     function()
                     {
                     console.warn("Error calling plugin");
                     });
            }
        }
	    function InserVisitKeys(url)
        {
            
             var Qry = "select (ifnull(max(visitkey),0) + 1) as VisitKey from customeroperationscontrol where routekey = " + sessionStorage.getItem("RouteKey");
			var platform= sessionStorage.getItem("platform");
            if(platform=='iPad')
            {
                Cordova.exec(function(result) {
                               
                     if (result != '')
                         {
                         sessionStorage.setItem("VisitKey", result);
                             var visitkey=result;
                         }
                     else
                         {
                         sessionStorage.setItem("VisitKey", 1);
                             var visitkey=1;
                         }          
                    insertvisitkey(visitkey);    
                        
                },
                function(error) {
                        alert(error);
                },
                "PluginClass",
                "GetdataMethod",
                [Qry]);
            }
	        else if(platform=='Android')
	       	{
	      		window.plugins.DataBaseHelper.select(Qry,function(result)
	      		{
                     		if (result.array[0].VisitKey != undefined)
                     		{
						 		
                         		sessionStorage.setItem("VisitKey", result.array[0].VisitKey);
                                var visitkey=result.array[0].VisitKey;
	                        }
                            else
                            {
                                sessionStorage.setItem("VisitKey", 1);
                                var visitkey=1;
                            }
	                        insertvisitkey(visitkey);               
				},
	            function()
				{
			   	 console.warn("Error calling plugin");
				});
	       	}
         }
	    function insertvisitkey(visitkey)
        {
           
    	   var mydate = new Date();
         
           var thehour = mydate.getHours();
           var theminut = mydate.getMinutes();
           var time = thehour+":"+theminut;	
           var latitude =sessionStorage.getItem("latitude");
           var longitude =sessionStorage.getItem("longitude");
           var platform= sessionStorage.getItem("platform");
           var Odometer= sessionStorage.getItem("Odometer");
           var qry = "insert into customeroperationscontrol ('visitkey','routekey','customercode','routecode','salesmancode','visitstartdate','visitstarttime','visitenddate','visitendtime','latitude','longitude','issync','odometerreading','reasoncode') values ('"+visitkey+"','"+sessionStorage.getItem("RouteKey")+"','"+sessionStorage.getItem("customerid")+"','"+sessionStorage.getItem("RouteCode")+"','"+sessionStorage.getItem("SalesmanCode")+"',date(),'"+time+"',date(),'"+time+"','"+latitude+"','"+longitude+"',0,"+Odometer+",1000) ";
           console.log(qry);
           if(platform=='iPad')
           {
               Cordova.exec(function(result) {
                             
               },
               function(error) {
                       alert(error);
               },
               "PluginClass",
               "InsertUpdateMethod",
               [qry]);
           }
	       else if(platform=='Android')
           {
	      		window.plugins.DataBaseHelper.insert(qry,function(result)
			    {
	      			InsertInvoiceDetail()                           
				},
                function()
				{
			   	 	console.warn("Error calling plugin");
				});
           }
        }
	    
	    function InsertInvoiceDetail(){
	    	
               //var Qry = "INSERT INTO invoicedetail(amount,itemcode,routekey,transactionkey,visitkey,salesqty,istemp,mdat,salesprice,issync,salescaseprice,stdsalesprice,stdsalescaseprice,stdreturnprice,stdreturncaseprice,stdgoodreturnprice,stdgoodreturncaseprice,returnprice,returncaseprice,goodreturnprice,goodreturncaseprice,pricechgindicator) select ifnull(tmp.varianceqty*im.defaultsalesprice,0),itemcode,"+sessionStorage.getItem("RouteKey")+",(SELECT ifnull(max(transactionkey),0) + 1 from invoiceheader),"+sessionStorage.getItem("VisitKey")+",varianceqty,'false',date(),im.defaultsalesprice,0,im.caseprice,im.defaultsalesprice,im.caseprice,im.defaultsalesprice,im.caseprice,im.defaultsalesprice,im.caseprice,im.defaultsalesprice,im.caseprice,im.defaultsalesprice,im.caseprice,0 from transactiondetailtemp tmp inner join itemmaster im where im.actualitemcode=tmp.itemcode and tmp.varianceqty>0";
	    	   var Qry="INSERT INTO invoicedetail(amount,itemcode,routekey,transactionkey,visitkey,salesqty,returnqty,istemp,mdat,salesprice,issync,salescaseprice,stdsalesprice,stdsalescaseprice,stdreturnprice,stdreturncaseprice,stdgoodreturnprice,stdgoodreturncaseprice,returnprice,returncaseprice,goodreturnprice,goodreturncaseprice,pricechgindicator) select ifnull(tmp.varianceqty*im.defaultsalesprice,0),itemcode,"+sessionStorage.getItem("RouteKey")+",(SELECT ifnull(max(transactionkey),0) + 1 from invoiceheader),"+sessionStorage.getItem("VisitKey")+",(CASE WHEN varianceqty>0 THEN varianceqty ELSE 0 END),(CASE WHEN varianceqty<0 THEN abs(varianceqty) ELSE 0 END) ,'false',date(),im.defaultsalesprice,0,im.caseprice,im.defaultsalesprice,im.caseprice,im.defaultsalesprice,im.caseprice,im.defaultsalesprice,im.caseprice,im.defaultsalesprice,im.caseprice,im.defaultsalesprice,im.caseprice,0 from transactiondetailtemp tmp inner join itemmaster im where im.actualitemcode=tmp.itemcode and tmp.varianceqty!=0"; 
               console.log(Qry);
	           if(platform=='iPad')
	           {
	               Cordova.exec(function(result) {
	                             
	               },
	               function(error) {
	                       alert(error);
	               },
	               "PluginClass",
	               "InsertUpdateMethod",
	               [qry]);
	           }
		       else if(platform=='Android')
	           {
		      		window.plugins.DataBaseHelper.insert(Qry,function(result)
				    {
		      			InsertInvoiceRxdDetail();
		      			   
					},
	                function()
					{
				   	 	console.warn("Error calling plugin");
					});
	           } 
	    	
	    	
	    }
	    function InsertInvoiceRxdDetail(){
	    	
            //var Qry = "INSERT INTO invoicedetail(amount,itemcode,routekey,transactionkey,visitkey,salesqty,istemp,mdat,salesprice,issync,salescaseprice,stdsalesprice,stdsalescaseprice,stdreturnprice,stdreturncaseprice,stdgoodreturnprice,stdgoodreturncaseprice,returnprice,returncaseprice,goodreturnprice,goodreturncaseprice,pricechgindicator) select ifnull(tmp.varianceqty*im.defaultsalesprice,0),itemcode,"+sessionStorage.getItem("RouteKey")+",(SELECT ifnull(max(transactionkey),0) + 1 from invoiceheader),"+sessionStorage.getItem("VisitKey")+",varianceqty,'false',date(),im.defaultsalesprice,0,im.caseprice,im.defaultsalesprice,im.caseprice,im.defaultsalesprice,im.caseprice,im.defaultsalesprice,im.caseprice,im.defaultsalesprice,im.caseprice,im.defaultsalesprice,im.caseprice,0 from transactiondetailtemp tmp inner join itemmaster im where im.actualitemcode=tmp.itemcode and tmp.varianceqty>0";
	    	   var Qry="INSERT INTO invoicerxddetail(routekey,visitkey,transactionkey, itemtransactiontype,itemcode,itemtranstypeseq,reasoncode,quantity,istemp) select "+sessionStorage.getItem("RouteKey")+","+sessionStorage.getItem("VisitKey")+",(SELECT ifnull(max(transactionkey),0) + 1 from invoiceheader),1,tmp.itemcode,0,1,abs(varianceqty),'false' from transactiondetailtemp tmp inner join itemmaster im where im.actualitemcode=tmp.itemcode and tmp.varianceqty<0"; 
            console.log(Qry);
	           if(platform=='iPad')
	           {
	               Cordova.exec(function(result) {
	                             
	               },
	               function(error) {
	                       alert(error);
	               },
	               "PluginClass",
	               "InsertUpdateMethod",
	               [qry]);
	           }
		       else if(platform=='Android')
	           {
		      		window.plugins.DataBaseHelper.insert(Qry,function(result)
				    {
		      			getDocInvoiceNumber();                  
					},
	                function()
					{
				   	 	console.warn("Error calling plugin");
					});
	           } 
	    	
	    	
	    }
	    function getDocInvoiceNumber(){
	    	var Qry="SELECT CASE WHEN MAX(hhcinvseq) IS NULL OR MAX(hhcinvseq) = 0 OR MAX(hhcinvseq) = 'null' THEN 0 ELSE hhcinvseq END as invoicenumber,CASE WHEN MAX(bodocseq) IS NULL OR MAX(bodocseq) <=0 OR MAX(bodocseq) = '' OR MAX(bodocseq) = 'null' THEN 0 ELSE bodocseq END AS documentnumber from routemaster WHERE routecode = " + sessionStorage.getItem("RouteCode");
	    	console.log(Qry);
            if(platform == "iPad")
            {
                Cordova.exec(function(result) {
                              if(result.length > 0)
                              {
                            	  var InvoicePrefix  = sessionStorage.getItem("RouteCode").toString() + '2'; // 2 is the prefix for   sales
                                  var InvoiceNumber = InvoicePrefix.toString() + (eval(result.array[0].invoicenumber) + 1).toString().lpad("0",5);
                                  var DocPrefix  = sessionStorage.getItem("RouteCode").toString();
                                  var DocumentNumber = DocPrefix.toString() + (eval(result.array[0].documentnumber) + 1).toString().lpad("0",6);                                                                                                
                                            
                              }
                              },
                              function(error) {
                              alert(error);
                              },
                              "PluginClass",
                              "GetdataMethod",
                              [Qry]);
            }
            else if(platform == "Android")
            {
                window.plugins.DataBaseHelper.select(Qry, function(result) 
                {
                                                     if(result.array != undefined)
                                                     {
	                                                     var InvoicePrefix  = sessionStorage.getItem("RouteCode").toString() + '2'; // 2 is the prefix for   sales
	                                                     var InvoiceNumber = InvoicePrefix.toString() + (eval(result.array[0].invoicenumber) + 1).toString().lpad("0",5);
	                                                 
	                                                     var DocPrefix  = sessionStorage.getItem("RouteCode").toString();
	                                                     var DocumentNumber = DocPrefix.toString() + (eval(result.array[0].documentnumber) + 1).toString().lpad("0",6);                                                                                                
	                                                     InsertInvoiceHeader(InvoiceNumber,DocumentNumber);
                                                     }
                 },
                 function() 
                 {
                 console.warn("Error calling plugin");
               });
            }
	    	
	    	
	    }
	    
	    function InsertInvoiceHeader(invoicenumber,documentnumber){
	    	sessionStorage.setItem("varianceinvoice",invoicenumber);
	    	var QryInsert = "INSERT INTO invoiceheader(istemp,transactionkey,documentnumber,invoicenumber,routekey,visitkey,transactiondate,transactiontime,customercode,routecode,salesmancode,totalsalesamount,totalinvoiceamount,totalreturnamount,totaldamagedamount,totalbuybackfreeamount,totalmanualfree,issync,hhctransactionkey,totaldiscdistributionamount,dexflag) VALUES('false',(SELECT ifnull(max(transactionkey),0) + 1 from invoiceheader),"+documentnumber+","+invoicenumber+"," + sessionStorage.getItem("RouteKey") + "," + sessionStorage.getItem("VisitKey") + ",date('now', 'localtime'),time('now', 'localtime')," + sessionStorage.getItem("customerid") + "," + sessionStorage.getItem("RouteCode") + "," + sessionStorage.getItem("SalesmanCode") + ",(SELECT ifnull(sum(amount),0) from invoicedetail where visitkey="+sessionStorage.getItem("VisitKey")+"),(SELECT ifnull(sum(amount),0) from invoicedetail where visitkey="+sessionStorage.getItem("VisitKey")+"),0,0,0,0,0," + sessionStorage.getItem("VisitKey") + ",0,0)";
	    	if (platform == "iPad") {
	    		   Cordova.exec(function(result) {
                     var invoiceamoint = salesamount - returnamount - damageamount;
                     
                     	checkcreditlimit(invoiceamoint);
                    
			       },
			       function(error) {
			           alert(error);
			       },
			       "PluginClass",
			       "InsertUpdateMethod",
			       [QryUpdate]);
            }
            else if (platform == "Android") {
            	            		
               			
                        window.plugins.DataBaseHelper.insert(QryInsert, function(result) 
                        {
                        	sessionStorage.setItem("varianceavailable",1);
                        	checkPaymentTerms();
                          
                        },
                        function() 
                        {
                           	console.warn("Error calling plugin");
                        });                        
                   
                                  
               
            }
	    	
	    }
	    function checkPaymentTerms(){
            
        	var custid=sessionStorage.getItem("customerid");
            var platform= sessionStorage.getItem("platform");
            var routecode=sessionStorage.getItem("RouteCode");
            var CompanyCode=sessionStorage.getItem("CompanyCode");
            
            
            if(platform=='iPad')
            {
                 Cordova.exec(function(result) {
                              
                             
                  },
                  function(error) {
                  alert(error);
                  },   
                  "PluginClass",
                  "GetdataMethod",
                  ["select invoicepaymentterms from customermaster where customercode="+custid]);
            }
            else if(platform=='Android')
            {
                window.plugins.DataBaseHelper.select("select invoicepaymentterms from customermaster where customercode="+custid,function(result)
                {
						var result = $.map(result.array, function (item, index) {
                         return [[item.invoicepaymentterms]];
                	 	});	
                	
            	 		sessionStorage.setItem("invoicepaymentterms",result[0][0]);
            	 		if (eval(result[0][0]) != 2){
            	 			InsertCashCheckDetail();
                        }
                        else
                        {
                        	 redirect();
                        }
                	 		
                	 	
                 },
                 function()
                 {
                 console.warn("Error calling plugin");
                 });
            }
        
        }
	    function InsertCashCheckDetail(){
	    	
	    	var Qry="INSERT INTO cashcheckdetail(routekey,visitkey,typecode,amount,issync,transactiontype,paymenttype,istemp) VALUES(" + sessionStorage.getItem("RouteKey") + "," +sessionStorage.getItem("VisitKey") + ",0,(SELECT ifnull(sum(amount),0) from invoicedetail where visitkey="+sessionStorage.getItem("VisitKey")+"),0,1," + 2 + ",'false')";
	    	if(platform=='iPad')
            {
                Cordova.exec(function(result) 
                {
                   
                },
                function(error) {
                    alert(error);},
                "PluginClass",
                "InsertUpdateMethod",
                [Qry]);   
            }
            else if(platform=='Android')
            {
                window.plugins.DataBaseHelper.insert(Qry,function(result)
                {                        
                	 redirect();
                },
                function()
                {
                    console.warn("Error calling plugin");
                });
            }
	    	
	    }
	    function redirect(){
        
       			 window.location ='printoption.html'; 
        }
    </script>

</body>
</html>
