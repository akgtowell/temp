<!--
 '  Created By   : Pratik Raval
 '  Created Date : 09/03/2012
 '  Description  : This page is used for item entry screen.
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Item Entry</title>
<meta name="viewport"
	content="width=device-width, initial-scale=1.0;maximum-scale=1.0;user-scalable=0; target-densitydpi=device-dpi">

	<meta name="format-detection" content="telephone=no">
		<link type="text/css" href="../css/jquery.mobile.datebox.min.css"
			rel="stylesheet" />
		<link rel="stylesheet" href="../css/style.css" />
		<link rel="stylesheet" href="../css/en.css" lang="en" />
		<link rel="stylesheet" href="../css/jquery.mobile-1.0.min.css" />
		<link rel="stylesheet"
			media="only screen and (min-width: 320px) and (max-width: 600px)"
			href="../css/style_600.css">
			<!--Black P-->
			<link rel="stylesheet"
				media="only screen and (min-width: 600px) and (max-width: 700px)"
				href="../css/style_700.css">
				<!--Iphone 4 P-->
				<link rel="stylesheet"
					media="only screen and (min-width: 700px) and (max-width: 800px)"
					href="../css/style_800.css">
					<!--Ipad P-->

					<!--Black L-->
					<link rel="stylesheet"
						media="only screen and (min-width: 1000px) and (max-width: 1200px)"
						href="../css/style_1200.css">
						<!--Ipad L-->
						<link rel="stylesheet"
							media="only screen and (min-width: 1200px) and (max-width: 1500px)"
							href="../css/style_1400.css">

							<link rel="stylesheet" href="../css/boostrap/css/bStyle.css" />
							<link rel="stylesheet"
								href="../css/boostrap/css/bootstrap.min.css" />
							<link rel="stylesheet"
								href="../css/boostrap/css/bootstrap-grid.css" />
							<link rel="stylesheet"
								href="../css/boostrap/css/bootstrap-grid.min.css" />
							<link rel="stylesheet" href="../css/boostrap/css/bootstrap.css" />



							<script type="text/javascript" src="../js/jquery.js"></script>

							<script type="text/javascript" src="../js/jquery.mobile-1.0.js"></script>

							<script type="text/javascript" src="../js/common.js"></script>
							<script type="text/javascript" src="../js/batch.js"></script>
							<script type="text/javascript" src="../js/jquery.json-2.3.min.js"></script>
							<script src="../LangJS/jquery-lang.js" charset="utf-8"
								type="text/javascript"></script>
							<script src="../LangJS/langpack/AR.js" charset="utf-8"
								type="text/javascript" lang="en"></script>
							<script type="text/javascript">
								if (navigator.userAgent.toLowerCase().match(
										/android/)) {
									document
											.write('<script charset="utf-8" src="../cordova-2.0.0.js"><\/script>');
									document
											.write('<script charset="utf-8" src="../directoryListing.js"><\/script>');
								} else if (navigator.userAgent.toLowerCase()
										.match(/iphone/)
										|| navigator.userAgent.toLowerCase()
												.match(/ipad/)) {
									document
											.write('<script charset="utf-8" src="../cordova-1.5.0.js"><\/script>');
								}
							</script>
							<script type="text/javascript"
								src="../js/jquery.mobile.datebox.min.js"></script>
							<script type="text/javascript" src="../barcodescanner.js"></script>
</head>
<body>
	<div data-role="page" data-theme="d" data-title="Order Request">
		<div>
			<img title="" alt="" src="../images/bg.png" id="background">
		</div>
		<div data-role="header" data-position="inline" id="bgclheader">
			<!--<a href="load.html" id="Back_inner" rel="external">Back</a>-->
			<a href="#" id="Back_inner" rel="external" lang="en"
				onclick="ClearVariables(0)">Back</a>
			<div class="wrapper">
				<div class="card_content">
					<div>
						<img title="" alt="" data-pushbar-target="left"
							src="../images/icons8-menu-50.png" id="setting">
					</div>
				</div>
			</div>
			<h1 lang="en">Item Entry</h1>
			<a href="#" id="lang_inner">EN</a>
		</div>
		<div data-role="content" class="centerbox bottomInv">
			<div class="boxContent Spacing">
				<table class="topbox" cellpadding="0">
					<tr>
						<td style="width: 25%">
							<table cellpadding="0">
								<tr>
									<td style="width: 10%" lang="en">No.</td>
									<td style="width: 80%;"><input type="tel" name="itemno"
										id="itemno" class="textWidth textFont" value="" /></td>
								</tr>
							</table>
						</td>
						<td style="width: 60%; padding-left: 40px"><label
							class="cus_lable heading" lang="en" id="lblDesc"> </label></td>
					</tr>
				</table>
				<table class="captionLabel" border="0" width="100%" cellpadding="10"
					cellspacing="0" id="tbl1" data-role="none" align="center">
					<tbody>
						<tr>
							<td style="width: 20%"></td>
							<td lang="en" style="width: 40%">Cases</td>
							<td lang="en" style="width: 40%">Units</td>
						</tr>
						<tr>
							<td lang="en" id="lblInvQty">Inventory Qty</td>
							<td>
								<div class="addressdiv" id="case1" style="width: 80%">0</div>

							</td>
							<td>
								<div class="addressdiv" id="units1" style="width: 80%">0</div>

							</td>
						</tr>
						<tr>
							<td lang="en">Quantity</td>
							<td>
								<!--<input type="text" id="case2" pattern="[0-9]*" size="11"  class="textWidth textFont" value="0"/>-->
								<input type="tel" id="case2" size="11"
								class="textWidth textFont" value="0" />
							</td>
							<td>
								<!--<input type="text" pattern="[0-9]*" size="11" id="units2" class="textWidth textFont" value="0"/>-->
								<input type="tel" size="11" id="units2"
								class="textWidth textFont" value="0" />
							</td>
						</tr>
					</tbody>
				</table>
				<table class="captionLabel" border="0" width="100%" cellpadding="10"
					cellspacing="0" id="tbl2" data-role="none" align="center">
					<tbody>
						<tr>
							<td lang="en" style="width: 20%">Expiry Date</td>
							<td style="width: 80%"><input name="startdate" type="date"
								readonly="readonly" data-role="datebox" id="startdate"
								data-options='{"mode": "datebox","dateFormat": "dd-MM-YYYY"}' "/>

							</td>
						</tr>
						<tr>
							<td lang="en" style="width: 20%">Reason</td>
							<td style="width: 80%">
								<div style="width: 93%; text-align: left">
									<select name="select-choice-1" id="reason"
										style="display: inline;">
										<option value="">Select Reason</option>
									</select>
								</div>
							</td>
						</tr>
					</tbody>
					</tr>


				</table>
			</div>
			 <div class="leftbotPromoRevwExpr card border-info">
            	<div class="row">
					<div class="col-2"></div>
					
						<div class="col-3">
							<div class="card bg-success text-center" style="width:100%">
	            				<a href="../customer/item_selection.html" rel="external" id="A1">
	            					<img  class="bottomicon" id="imgPrev" src="../images/search.png" alt="Search" />
	            					<h4 class="text-white">Search</h4>
	            				</a>
	            			</div>
						</div>				
						<div class="col-3">
							<div class="card bg-success text-center" style="width:100%">
	            				<a href="#" rel="external" id="A2" onclick="return InsertCaseQty()">
	            					<img  class="bottomicon" id="imgPrev" src="../images/save.png" alt="Save" />
	            					<h4 class="text-white">SAVE</h4>
	            				</a>
	            			</div>
						</div>						
						<div class="col-3">
							<div class="card bg-success text-center" style="width:100%">
	            				<a id="linkContinue" href="#" rel="external" id="simplestring" onclick="ClearVariables(0)">
	            					<img  class="bottomicon" src="../images/icn-exit.png" alt="Exit" />
	            					<h4 class="text-white">DONE</h4>
	            				</a>
	            			</div>
						</div>
					</div>               
            </div>
		</div>
		<div id="f1" data-role="footer" class="ui-bar">
			<div class="footer">
				<div class="leftfooter">09 November 2011</div>
				<div class="rightfooter">Mirnah Technology Systems</div>
			</div>
		</div>
		<div id="f2" data-role="footer" style="bottom: 0; position: absolute;">
			<aside data-pushbar-id="left" class="pushbar from_left">
			<div class="title">
				<span data-pushbar-close class="close push_right"></span> <span
					id="txtroute"></span>
			</div>

			<ul class="menu">
				<li style="margin-bottom: 0 !important;"><img title="" alt=""
					src="../images/startday-icon.png" id="day" class="leftmenu">
						<a href="#" class="ui-btn-active" rel="external" id="day"
						data-icon="custom" lang="en"
						onclick="footerredict('../startofday/startofday.html')">Start
							day</a></li>
				<li style="margin-bottom: 0 !important;"><img title="" alt=""
					src="../images/Inventoryicon.png" id="inve" class="leftmenu">
						<a href="#" id="inve" rel="external" data-icon="custom" lang="en"
						onclick="footerredict('../inventory/inventory.html')">Inventory</a></li>
				<li style="margin-bottom: 0 !important;"><img title="" alt=""
					src="../images/customer-icon.png" id="cust" class="leftmenu">
						<a href="#" rel="external" id="cust" data-icon="custom" lang="en"
						onclick="footerredict('../customer/customer_operation.html')">Customer</a></li>
				<li style="margin-bottom: 0 !important;"><img title="" alt=""
					src="../images/Money-icon.png" id="sett" class="leftmenu"> <a
						href="#" rel="external" id="sett" data-icon="custom" lang="en"
						onclick="footerredict('../settlement/managesettlement.html')">Settlement</a></li>
				<li style="margin-bottom: 0 !important;"><img title="" alt=""
					src="../images/expense-icon.png" id="expe" class="leftmenu">
						<a href="#" rel="external" id="expe" data-icon="custom" lang="en"
						onclick="footerredict('../settlement/expenseentry.html')">Expenses</a></li>
				<li style="margin-bottom: 0 !important;"><img title="" alt=""
					src="../images/information-icon.png" id="info" class="leftmenu">
						<a href="#" rel="external" id="info" data-icon="custom" lang="en"
						onclick="footerredict('../information/information.html')">Information</a></li>
				<li style="margin-bottom: 0 !important;"><img title="" alt=""
					src="../images/user-settings-icon.png" id="setup" class="leftmenu">
						<a href="#" rel="external" id="setup" data-icon="custom" lang="en"
						onclick="footerredict('../utilities/utilities.html')">Utilities</a></li>
			</ul>

			</aside>

			<div data-role="navbar" data-iconpos="top" data-grid="f">
				<ul>
					<li style="margin-bottom: 0 !important;"><a href="#"
						rel="external" id="day" data-icon="custom" lang="en"
						onclick="footerredict('../startofday/startofday.html')">Start
							day</a></li>
					<li style="margin-bottom: 0 !important;"><a href="#" id="inve"
						class="ui-btn-active" rel="external" data-icon="custom" lang="en">Inventory</a></li>
					<li style="margin-bottom: 0 !important;"><a href="#"
						rel="external" id="cust" data-icon="custom" lang="en"
						onclick="footerredict('../customer/customer_operation.html')">Customer</a></li>
					<li style="margin-bottom: 0 !important;"><a href="#"
						rel="external" id="sett" data-icon="custom" lang="en"
						onclick="footerredict('../settlement/managesettlement.html')">Settlement</a></li>
					<li style="margin-bottom: 0 !important;"><a href="#"
						rel="external" id="expe" data-icon="custom" lang="en"
						onclick="footerredict('../settlement/expenseentry.html')">Expenses</a></li>
					<li style="margin-bottom: 0 !important;"><a href="#"
						rel="external" id="info" data-icon="custom" lang="en"
						onclick="footerredict('../information/information.html')">Information</a></li>
					<li style="margin-bottom: 0 !important; width: 14.0%"><a
						href="#" rel="external" id="setup" data-icon="custom" lang="en"
						onclick="footerredict('../utilities/utilities.html')">Utilities</a></li>
				</ul>
			</div>
		</div>
	</div>

	<script type="text/javascript">
		var data = null;
		window.lang = new jquery_lang_js();
		var platform = '';
		var key;
		var batchqty;
		var osversion;
		var CaseEnabled = sessionStorage.getItem("CaseEnabled");
		if (CaseEnabled == "1")
			CaseEnabled = true;
		else
			CaseEnabled = false;
		var UPC = null;
		var AvailQty;
		var transactiontypecode;
		resizeOrientationWindow();
		// sujee added side bar ----------------- START ------------------------ 

		var pushbar = new Pushbar({
			blur : true,
			overlay : true,
		});
		$("#txtroute").text("ROUTE #: " + sessionStorage.getItem("RouteCode"));
		window.setInterval(function() {
			var randomColor = '#'
					+ ('000000' + Math.floor(Math.random() * 16777215)
							.toString(16)).slice(-6);
			$('#txtroute').css({
				'color' : randomColor,
			});
		}, 2000);
		//----------------------------- END -------------------------  
		$(document)
				.ready(
						function() {
							resizeWindow();

							transactiontypecode = localStorage.transactiontypecode;
							if (transactiontypecode == 3) {
								batchqty = 'loadaddqty';
								$("#tbl2").hide();
							} else if (transactiontypecode == 2) {
								$("#tbl2").show();
								batchqty = 'loadcutqty';
							} else if (transactiontypecode == 4) {
								$("#tbl2").hide();
								batchqty = 'damageunloadqty';
							}
							var cDate = new Date();
							var tDate = ("0" + cDate.getDate()).slice(-2) + '-'
									+ ("0" + (cDate.getMonth() + 1)).slice(-2)
									+ '-' + cDate.getFullYear(); // Change
							$("#startdate").val(tDate);

							if (sessionStorage.getItem('CheckCode') == 'alternatecode')
								$('#itemno').clone().attr('type', 'tel')
										.insertAfter('#itemno').prev().remove();
							else
								$('#itemno').clone().attr('type', 'tel')
										.insertAfter('#itemno').prev().remove();
							$("#case1").ForceNumericOnly();
							$("#case2").ForceNumericOnly();
							$("#units1").ForceNumericOnly();
							$("#units2").ForceNumericOnly();

							var itemno = sessionStorage.getItem("ItemCode");
							$('#lblDesc').text(
									sessionStorage.getItem('ItemDesc'));
							$('#itemno').val(itemno);

							osversion = window.localStorage
									.getItem("osversion");
							osversion = eval(osversion.substring(0, 3));
							//alert('osversion' +osversion);
							if (osversion < 4.3) {
								$("#itemno").keyup(function(event) {
									if (event.keyCode == 13) {
										if ($("#itemno").val != "")
											getFillterItemList();
									}

								});
							} else {
								$("#itemno").keydown(function(event) {

									if (event.keyCode == 13) {
										if ($("#itemno").val != "")
											getFillterItemList();
									}

								});

							}

							if (CaseEnabled) {
								$('#case1').show();
								$('#case2').show();
							} else {
								$('#case1').hide();
								$('#case2').hide();
							}

							if (transactiontypecode == 4)

								$("#lblInvQty").text("Damage Qty");
							$("#lnkScan").click(function() {
								clickScan();
							})
							document.addEventListener("deviceready", onDR,
									false);
							function onDR() {
								platform = sessionStorage.getItem("platform");
								getReasons();

								if (sessionStorage.getItem('batchsetting') == 1)
									selectbatchdata();
							}

							$(".leftfooter").html(getCurrentDate());

							var lan = sessionStorage.getItem("Language");
							window.lang.run(lan);
							if (sessionStorage.getItem("Language") != "en") {

								window.lang.change('ItemEntry' + lan, lan);
								window.lang.change('Footer' + lan, lan);
								if (lan == "AR") {
									$(".centerbox").attr("dir", "rtl");
									$('#Back_inner')
											.removeClass(
													'ui-btn-left ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
									$('#Back_inner')
											.addClass(
													'ui-btn-right ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
									$('#lang_inner')
											.removeClass(
													'ui-btn-right ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
									$('#lang_inner')
											.addClass(
													'ui-btn-left ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
								}

							} else {
								window.lang.change('en', 'en');
								$(".centerbox").attr("dir", "ltr");
								$('#Back_inner')
										.removeClass(
												'ui-btn-right ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
								$('#Back_inner')
										.addClass(
												'ui-btn-left ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
								$('#lang_inner')
										.removeClass(
												'ui-btn-left ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
								$('#lang_inner')
										.addClass(
												'ui-btn-right ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
							}

						});

		$("#case2").blur(function() {
			$(this).val(parseFloat(CheckIsNaN($(this).val())))
		});
		$("#units2").blur(function() {
			$(this).val(parseFloat(CheckIsNaN($(this).val())))
		});

		//-----------------Start---------------------------
		function clickScan() {

			window.plugins.barcodeScanner.scan(scannerSuccess, scannerFailure);
		}

		function scannerSuccess(result) {

			if (result.cancelled) {
				getLangText("the user cancelled the scan");
			} else {
				var itemcode = result.text;
				itemscan(result.text);
			}

		}

		function itemscan(itemcode) {
			var Qry = "SELECT actualitemcode,itemdescription FROM itemmaster   WHERE (barcode1 ='"
					+ itemcode
					+ "'OR barcode2 ='"
					+ itemcode
					+ "'OR barcode3 ='"
					+ itemcode
					+ "'OR barcode4 ='"
					+ itemcode
					+ "'OR barcode5 ='"
					+ itemcode
					+ "' OR barcode6 ='"
					+ itemcode
					+ "'OR barcode7 = '"
					+ itemcode
					+ "' OR barcode8 ='"
					+ itemcode
					+ "' OR barcode9 ='"
					+ itemcode
					+ "' OR barcode10 ='"
					+ itemcode + "')";
			console.log(Qry);
			if (platform == "iPad") {
				Cordova.exec(function(result1) {
					if (result1 != '') {
						//console.log(result1[0][0]);
						if (result1.length > 0) {
							sessionStorage.setItem("itemno", "");
							sessionStorage.setItem("itemno", result1[0][0]);
							$('#itemno').val(result1[0][0]);
							$('#lblDesc').text(result1[0][1]);
							getReasons();
							if (sessionStorage.getItem('batchsetting') == 1)
								selectbatchdata();
						}
					} else {
						alert("Item No found");
					}
				}, function(error) {
					navigator.notification.alert(error);
				}, "PluginClass", "GetdataMethod", [ Qry ]);
			} else if (platform == "Android") {
				window.plugins.DataBaseHelper.select(Qry, function(result1) {
					if (result1.array != undefined) {
						sessionStorage.setItem("itemno", "");
						sessionStorage.setItem("itemno",
								result1.array[0].actualitemcode);
						$('#itemno').val(result1.array[0].actualitemcode);
						$('#lblDesc').text(result1.array[0].itemdescription);
						getReasons();
						if (sessionStorage.getItem('batchsetting') == 1)
							selectbatchdata();
					} else
						getLangText("Item No found");
				}, function() {
					console.warn("Error calling plugin");
				});
			}
		}

		function scannerFailure(message) {
			console.log("scannerFailure: message: " + message)
		}

		function InsertCaseQty() {
			var cases = $("#case2").val();
			var units = $("#units2").val();
			if (units == '')
				units = 0;
			if (cases == '')
				cases = 0;
			var qty = eval((cases * UPC)) + eval(units);

			//navigator.notification.alert(cases + " -- " + units + " -- " + qty);            

			var itemcode = sessionStorage.getItem("itemno");
			if (itemcode == null) {
				getLangText('Select Item');
				return false;
			}
			if (transactiontypecode == 2
					&& eval($('#reason :selected').index()) == 0) {
				getLangText('Please Select Reason');
				return false;

			}
			if (AvailQty == 0 && transactiontypecode != 3) {
				getLangText('Qty Not Available');
				return false;
			}
			if ((eval(AvailQty) < eval(qty)) && transactiontypecode != 3) {
				getLangText('Qty Not Available');
				return false;
			}
			if (eval(qty) <= 0) {
				getLangText('Please Enter Quantity');
				return false;
			}
			var Qry = "SELECT count(*) as totalrec,quantity FROM inventorytransactiondetail where routekey="
					+ sessionStorage.getItem("RouteKey")
					+ " and transactiontypecode = "
					+ transactiontypecode
					+ " and istemp = 'true' and itemcode=" + itemcode;

			if (platform == "iPad") {
				Cordova.exec(function(result) {
					//navigator.notification.alert(result);
					AddData(result);
				}, function(error) {
					navigator.notification.alert(error);
				}, "PluginClass", "GetdataMethod", [ Qry ]);
			} else if (platform == "Android") {
				window.plugins.DataBaseHelper.select(Qry, function(result) {
					var array = $.map(result.array, function(item, index) {
						return [ [ item.totalrec, item.quantity ] ];
					});

					AddData(array);
				}, function() {
					console.warn("Error calling plugin");
				});
			}
		}

		function AddData(result) {

			sessionStorage.setItem("ItemCode", "");
			var cases = $("#case2").val();
			var units = $("#units2").val();
			var date = '';
			var reasoncode = 0;
			if (transactiontypecode == 2) {
				date = parseDate($("#startdate").val());
				reasoncode = $('#reason :selected').val();

			}
			if (units == '')
				units = 0;
			if (cases == '')
				cases = 0;
			var qty;
			if (CaseEnabled)
				qty = eval((cases * UPC)) + eval(units);
			else
				qty = eval(units);
			var itemcode = sessionStorage.getItem("itemno");

			if (sessionStorage.getItem('batchsetting') == 1) {
				var selectqry = "select allowbatchentry from itemmaster where actualitemcode="
						+ itemcode;
				if (platform == 'iPad') {
					Cordova.exec(function(result) {

						if (eval(result[0][0]) == 0) {
							deletebatchexpiry(itemcode, sessionStorage
									.getItem('RouteKey'), 0, qty,
									transactiontypecode, batchqty);
						}

					}, function(error) {
						alert(error);
					}, "PluginClass", "GetdataMethod", [ selectqry ]);
				} else if (platform == 'Android') {
					window.plugins.DataBaseHelper.select(selectqry, function(
							result) {

						result = $.map(result.array, function(item, index) {

							return [ [ item.allowbatchentry ] ];
						});
						if (eval(result[0][0]) == 0) {
							deletebatchexpiry(itemcode, sessionStorage
									.getItem('RouteKey'), 0, qty,
									transactiontypecode, batchqty);
						}

					}, function() {
						console.warn("Error calling plugin");
					});
				}
			}

			if (result[0][0] == 0) {

				var Qry;

				//sujee commented 09/03/2020
				//Qry = "INSERT INTO inventorytransactiondetail(itemcode,routekey,transactiontypecode,quantity,itemprice,itemcaseprice,istemp,reasoncode,expirydate,issync) VALUES(" + itemcode + "," + sessionStorage.getItem("RouteKey") + "," + transactiontypecode + "," + qty + ",(SELECT defaultsalesprice FROM itemmaster WHERE actualitemcode=" + itemcode + "),(SELECT caseprice FROM itemmaster WHERE actualitemcode=" + itemcode + "),'true','"+reasoncode+"','"+date+"',0)";

				Qry = "INSERT INTO inventorytransactiondetail(itemcode,routekey,transactiontypecode,quantity,itemprice,itemcaseprice,istemp,reasoncode,expirydate,issync,detailkey) VALUES("
						+ itemcode
						+ ","
						+ sessionStorage.getItem("RouteKey")
						+ ","
						+ transactiontypecode
						+ ","
						+ qty
						+ ",(SELECT defaultsalesprice FROM itemmaster WHERE actualitemcode="
						+ itemcode
						+ "),(SELECT caseprice FROM itemmaster WHERE actualitemcode="
						+ itemcode
						+ "),'true','"
						+ reasoncode
						+ "','"
						+ date
						+ "',0,0)";

				console.log(Qry);
				//navigator.notification.alert(qry);
				if (platform == "iPad") {
					Cordova.exec(function(result) {
						if (transactiontypecode == 3 && AvailQty == 0)
							CheckSummaryDetailForInsert(qty, itemcode);
						ClearVariables(1);
					}, function(error) {
						navigator.notification.alert(error);
					}, "PluginClass", "InsertUpdateMethod", [ Qry ]);
				} else if (platform == "Android") {
					window.plugins.DataBaseHelper.insert(Qry, function(result) {
						if (transactiontypecode == 3 && AvailQty == 0)
							CheckSummaryDetailForInsert(qty, itemcode);
						ClearVariables(1);
					}, function() {
						console.warn("Error calling plugin");
					});
				}
			} else {

				var Qry = "UPDATE inventorytransactiondetail set quantity="
						+ qty + ",issync=0,reasoncode='" + reasoncode
						+ "',expirydate='" + date + "'  WHERE itemcode = "
						+ itemcode + " AND routekey="
						+ sessionStorage.getItem("RouteKey")
						+ " AND istemp = 'true'";
				if (platform == "iPad") {
					Cordova.exec(function(result) {
						ClearVariables(1);
					}, function(error) {
						navigator.notification.alert(error);
					}, "PluginClass", "InsertUpdateMethod", [ Qry ]);
				} else if (platform == "Android") {
					window.plugins.DataBaseHelper.insert(Qry, function(result) {
						ClearVariables(1);
					}, function() {
						console.warn("Error calling plugin");
					});
				}
			}
		}

		// Function to save load transfer in data to invneotorysummarydetail for itemcode which qty not available
		function CheckSummaryDetailForInsert(qty, itemcode) {
			var QrySelect = "SELECT COUNT(*) as cnt FROM inventorysummarydetail WHERE routekey="
					+ sessionStorage.getItem("RouteKey")
					+ " AND itemcode = "
					+ itemcode;
			var QryInsert = "INSERT INTO inventorysummarydetail(inventorykey,routekey,itemcode,istemp,issync,stdsalesprice,stdsalescaseprice,stdreturnprice,stdreturncaseprice) SELECT "
					+ sessionStorage.getItem("RouteKey")
					+ ","
					+ sessionStorage.getItem("RouteKey")
					+ ","
					+ itemcode
					+ ",'true',0,defaultsalesprice,caseprice,defaultreturnprice,returncaseprice FROM itemmaster WHERE actualitemcode="
					+ itemcode;
			if (platform == "iPad") {
				Cordova.exec(function(result) {
					if (result[0][0] == 0) {
						Cordova.exec(function(result1) {
						}, function(error) {
							navigator.notification.alert(error);
						}, "PluginClass", "InsertUpdateMethod", [ QryInsert ]);
					}
				}, function(error) {
					navigator.notification.alert(error);
				}, "PluginClass", "GetdataMethod", [ QrySelect ]);
			} else if (platform == "Android") {
				window.plugins.DataBaseHelper
						.select(
								QrySelect,
								function(result) {
									if (result.array[0].cnt == 0) {
										window.plugins.DataBaseHelper
												.insert(
														QryInsert,
														function(result) {
														},
														function() {
															console
																	.warn("Error calling plugin");
														});
									}
								}, function() {
									console.warn("Error calling plugin");
								});
			}
		}

		function UpdateSummaryDetail(qtyvalue, action, itemcode) {
			var Qty;
			if (transactiontypecode == "2")
				Qty = "loadcutqty";
			else if (transactiontypecode == "3")
				Qty = "loadaddqty";
			else if (transactiontypecode == "4")
				Qty = "damagedcutqty";

			var Qry = "UPDATE inventorysummarydetail SET " + Qty + " = "
					+ qtyvalue + "issync=0 WHERE routekey = "
					+ sessionStorage.getItem("RouteKey")
					+ " AND istemp = 'true' " + " AND itemcode = " + itemcode;
			console.log(Qry);
			if (platform == "iPad") {
				Cordova.exec(function(result) {
					ClearVariables();
				}, function(error) {
					navigator.notification.alert(error);
				}, "PluginClass", "InsertUpdateMethod", [ Qry ]);
			} else if (platform == "Android") {
				window.plugins.DataBaseHelper.insert(Qry, function(result) {
					ClearVariables();
				}, function() {
					console.warn("Error calling plugin");
				});
			}
		}

		function CheckIsNaN(val) {
			if (isNaN(val) || $.trim(val) == "")
				return 0;
			else
				return val;
		}

		//  Function for getting Available Qty
		function getAvailQty() {

			var ItemNo = sessionStorage.getItem("itemno");
			if (ItemNo == null)
				ItemNo = 0;
			var Qry = "Select ((ifnull(inventorysummarydetail.loadqty,0) +ifnull(inventorysummarydetail.loadadjustqty,0)+ifnull(inventorysummarydetail.beginstockqty,0)+ ifnull(inventorysummarydetail.loadaddqty,0) - ifnull(inventorysummarydetail.loadcutqty,0) - ifnull(inventorysummarydetail.saleqty,0) + ifnull(inventorysummarydetail.returnqty,0) +ifnull(inventorysummarydetail.returnfreeqty,0) - ifnull(inventorysummarydetail.freesampleqty,0))/itemmaster.unitspercase) As LoadQty,(((ifnull(inventorysummarydetail.loadqty,0)+ifnull(inventorysummarydetail.loadadjustqty,0) + ifnull(inventorysummarydetail.loadaddqty,0)+ifnull(inventorysummarydetail.beginstockqty,0) - ifnull(inventorysummarydetail.loadcutqty,0) - ifnull(inventorysummarydetail.saleqty,0) + ifnull(inventorysummarydetail.returnqty,0) + ifnull(inventorysummarydetail.returnfreeqty,0) - ifnull(inventorysummarydetail.freesampleqty,0))%itemmaster.unitspercase)) As LoadUnit,itemmaster.unitspercase,itemmaster.defaultsalesprice,(ifnull(inventorysummarydetail.loadqty,0)+ifnull(inventorysummarydetail.loadadjustqty,0) +ifnull(inventorysummarydetail.beginstockqty,0)+ ifnull(inventorysummarydetail.loadaddqty,0) - ifnull(inventorysummarydetail.loadcutqty,0) - ifnull(inventorysummarydetail.saleqty,0) + ifnull(inventorysummarydetail.returnqty,0) + ifnull(inventorysummarydetail.returnfreeqty,0) - ifnull(inventorysummarydetail.freesampleqty,0)) As AvialableQty,unitspercase,(ifnull(damageqty,0)-ifnull(damagedcutqty,0)) as damageqty from inventorysummarydetail inner join itemmaster on inventorysummarydetail.itemcode = itemmaster.actualitemcode  and inventorysummarydetail.routekey = "
					+ sessionStorage.getItem('RouteKey')
					+ " where itemmaster.actualitemcode = " + ItemNo
			console.log(Qry);
			if (platform == "iPad") {
				Cordova.exec(function(result) {
					//navigator.notification.alert(result);
					if (result.length > 0) {
						if (CaseEnabled) {
							if (transactiontypecode == 4) {
								$("#case1").text(
										parseInt(result[0][6] / result[0][5]));
								$("#units1").text(
										parseInt(result[0][6] % result[0][5]));
								if (result[0][6] == 0)
									AvailQty = 0;
							} else {
								$("#case1").text(parseInt(result[0][0]))
								$("#units1").text(parseInt(result[0][1]));
							}
						} else
							$("#units1").text(parseInt(result[0][4]));

						AvailQty = parseInt(result[0][4]);
						//UPC = result[0][5];
						if (transactiontypecode == 4)
							AvailQty = parseInt(result[0][6]);
					} else {
						$("#case1").text(0);
						$("#units1").text(0);
						AvailQty = 0;
					}
					GetUPC();
				}, function(error) {
					navigator.notification.alert(error);
				}, "PluginClass", "GetdataMethod", [ Qry ]);
			} else if (platform == "Android") {
				window.plugins.DataBaseHelper.select(Qry, function(result) {
					if (result.array != undefined) {
						var res = $.map(result.array, function(item, index) {
							return [ [ item.LoadQty, item.LoadUnit,
									item.unitspercase, item.defaultsalesprice,
									item.AvialableQty, item.unitspercase,
									item.damageqty ] ];
						});

						var result = res;
						if (CaseEnabled) {
							if (transactiontypecode == 4) {
								$("#case1").text(
										parseInt(result[0][6] / result[0][5]));
								$("#units1").text(
										parseInt(result[0][6] % result[0][5]));
								if (result[0][6] == 0)
									AvailQty = 0;
							} else {
								$("#case1").text(parseInt(result[0][0]))
								$("#units1").text(parseInt(result[0][1]));
							}
						} else
							$("#units1").text(parseInt(result[0][4]));

						AvailQty = parseInt(result[0][4]);

					} else {
						$("#case1").text(0);
						$("#units1").text(0);
						AvailQty = 0;
					}
					GetUPC();
				}, function() {
					console.warn("Error calling plugin");
				});
			}
		}

		function GetUPC() {
			var Qry = "SELECT unitspercase FROM itemmaster WHERE actualitemcode = "
					+ sessionStorage.getItem("itemno");
			console.log(Qry);
			if (platform == "iPad") {
				Cordova.exec(function(result) {
					UPC = result[0][0];
				}, function(error) {
					navigator.notification.alert(error);
				}, "PluginClass", "GetdataMethod", [ Qry ]);
			} else if (platform == "Android") {
				window.plugins.DataBaseHelper.select(Qry, function(result) {
					UPC = result.array[0].unitspercase;

				}, function() {
					console.warn("Error calling plugin");
				});
			}
		}
		function getFillterItemList() {
			var qry = "SELECT CASE WHEN '"
					+ sessionStorage.getItem('CheckCode')
					+ "' = 'alternatecode' THEN itemmaster.alternatecode ELSE itemmaster.actualitemcode END AS Code,CASE WHEN '"
					+ sessionStorage.getItem('Language')
					+ "' = 'en' THEN itemmaster.itemdescription ELSE itemmaster.arbitemdescription END As Description,itemmaster.actualitemcode from itemmaster  where (barcode1 ='"
					+ $.trim($("#itemno").val()) + "' OR barcode2 ='"
					+ $.trim($("#itemno").val()) + "' OR barcode3 ='"
					+ $.trim($("#itemno").val()) + "' OR barcode4 ='"
					+ $.trim($("#itemno").val()) + "'OR barcode5 ='"
					+ $.trim($("#itemno").val()) + "' OR barcode6 ='"
					+ $.trim($("#itemno").val()) + "'OR barcode7 = '"
					+ $.trim($("#itemno").val()) + "' OR barcode8 ='"
					+ $.trim($("#itemno").val()) + "' OR barcode9 ='"
					+ $.trim($("#itemno").val()) + "' OR barcode10 ='"
					+ $.trim($("#itemno").val()) + "' OR Code = '"
					+ $("#itemno").val() + "') order by Code";
			if (platform == 'iPad') {
				Cordova.exec(function(result) {
					if (result1 != '') {
						var code = result[0][0];
						var Description = result[0][1];
						var actualitemcode = result[0][2];
						sessionStorage.setItem("ItemCode", code);
						sessionStorage.setItem("ItemDesc", Description);
						sessionStorage.setItem("itemno", actualitemcode);
						$('#lblDesc').text(sessionStorage.getItem('ItemDesc'));
						getReasons();
					} else
						getLangText("Item Not Available");

				}, function(error) {
					alert("Error in binding fillter Item : " + error);
				}, "PluginClass", "GetdataMethod", [ qry ]);
			} else if (platform == 'Android') {
				window.plugins.DataBaseHelper.select(qry, function(result) {
					if (result.array != undefined) {
						var code = result.array[0].Code;
						var Description = result.array[0].Description;
						var actualitemcode = result.array[0].actualitemcode;
						sessionStorage.setItem("ItemCode", code);
						sessionStorage.setItem("ItemDesc", Description);
						sessionStorage.setItem("itemno", actualitemcode);
						$('#lblDesc').text(sessionStorage.getItem('ItemDesc'));
						getReasons();
					} else {
						getLangText("Item Not Available");
					}
				}, function() {
					console.warn("Error calling plugin");
				});
			}
		}
		function getRecord() {
			var itemcode = sessionStorage.getItem("itemno");
			var Qry = "SELECT CASE WHEN ifnull(quantity,0) > 0 THEN (quantity / im.unitspercase) ELSE 0 END cases,CASE WHEN ifnull(quantity,0) > 0 THEN (quantity % im.unitspercase) ELSE 0 END units,reasoncode,strftime('%d-%m-%Y',expirydate) expirydate FROM inventorytransactiondetail JOIN itemmaster im ON im.actualitemcode = inventorytransactiondetail.itemcode where routekey="
					+ sessionStorage.getItem("RouteKey")
					+ " and transactiontypecode = "
					+ transactiontypecode
					+ " and istemp = 'true' and itemcode=" + itemcode;
			console.log(Qry);
			if (platform == "iPad") {
				Cordova.exec(function(result) {
					if (result.length > 0) {
						$("#case2").val(parseInt(result[0][0]));
						$("#units2").val(parseInt(result[0][1]));
					}
					getAvailQty();
				}, function(error) {
					navigator.notification.alert(error);
				}, "PluginClass", "GetdataMethod", [ Qry ]);
			} else if (platform == "Android") {
				window.plugins.DataBaseHelper.select(Qry, function(result) {
					if (result.array != undefined) {
						var result = $.map(result.array, function(item, index) {
							return [ [ item.cases, item.units, item.reasoncode,
									item.expirydate ] ];
						});

						if (result.length > 0) {
							$("#case2").val(parseInt(result[0][0]));
							$("#units2").val(parseInt(result[0][1]));

							if (transactiontypecode == 2) {
								$("#startdate").val(result[0][3]);
								$("#reason").val(parseInt(result[0][2]));
								$("#reason").selectmenu("refresh");
							}
						}
					}
					getAvailQty();
				}, function() {
					console.warn("Error calling plugin");
				});
			}
		}
		function getReasons() {

			if (platform == 'iPad') {
				Cordova
						.exec(
								function(result) {
									if (result.length > 0) {

									}
								},
								function(error) {
									navigator.notification
											.alert("Error in binding inventory detail : "
													+ error);
								},
								"PluginClass",
								"GetdataMethod",
								[ "select CASE WHEN '"
										+ sessionStorage.getItem('Language')
										+ "' = 'en' THEN description Else arbdescription END AS description,code from retitmreasons" ]);

			} else if (platform == 'Android') {
				window.plugins.DataBaseHelper
						.select(
								"select CASE WHEN '"
										+ sessionStorage.getItem('Language')
										+ "' = 'en' THEN description Else arbdescription END AS description,code from retitmreasons",
								function(result) {
									if (result.array != undefined) {
										result = $.map(result.array, function(
												item, index) {
											return [ [ item.description,
													item.code ] ];
										});
										if (result.length > 0) {
											$('#reason').empty();
											$(
													"<option />",
													{
														value : 0,
														text : getLangTextdata("--SELECT--")
													}).appendTo($("#reason"));
											for (i = 0; i < result.length; i++) {
												$("<option />", {
													value : result[i][1],
													text : result[i][0]
												}).appendTo($("#reason"));
											}
											$("#reason").selectmenu("refresh");
											getRecord();
										} else {

											$('#reason').empty();
											$(
													"<option />",
													{
														value : 0,
														text : getLangTextdata("--SELECT--")
													}).appendTo($("#reason"));
											$("#reason").selectmenu("refresh");
											getRecord();
										}
									} else {
										$('#reason').empty();
										$(
												"<option />",
												{
													value : 0,
													text : getLangTextdata("--SELECT--")
												}).appendTo($("#reason"));
										$("#reason").selectmenu("refresh");
										getRecord();
									}
								}, function() {
									console.warn("Error calling plugin");
								});
			}

		}
		function parseDate(str) {
			var mdy = str.split('-');
			var year = mdy[2];

			var month = parseInt(mdy[1], 10);
			if (month <= 9)
				month = '0' + month;

			var day = parseInt(mdy[0], 10);
			if (day <= 9)
				day = '0' + day;

			return year + '-' + month + '-' + day;
		}

		function ClearVariables(Action) {
			$("#itemno").val("");
			$("#lblDesc").text("");
			$("#case1").text("");
			$("#case2").val("");
			$("#units1").text("");
			$("#units2").val("");
			sessionStorage.setItem("ItemCode", "");
			sessionStorage.setItem("ItemDesc", "");
			sessionStorage.setItem("itemno", "");
			var cDate = new Date();
			var tDate = ("0" + cDate.getDate()).slice(-2) + '-'
					+ ("0" + (cDate.getMonth() + 1)).slice(-2) + '-'
					+ cDate.getFullYear(); // Change
			$("#startdate").val(tDate);

			if (Action == 0)
				window.location = "loadtransfer.html";
		}
	</script>
</body>
</html>
