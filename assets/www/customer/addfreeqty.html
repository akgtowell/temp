<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Add Item</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0;maximum-scale=1.0;user-scalable=0; target-densitydpi=device-dpi">
	        <meta name="format-detection" content="telephone=no">
            <link rel="stylesheet" href="../css/style.css" />
            <link rel="stylesheet" href="../css/en.css" lang="en" />
            <link rel="stylesheet" href="../css/jquery.mobile-1.0.min.css" />
            <link rel="stylesheet" media="only screen and (min-width: 320px) and (max-width: 600px)"
                href="../css/style_600.css">
                <!--Black P-->
                <link rel="stylesheet" media="only screen and (min-width: 600px) and (max-width: 700px)"
                    href="../css/style_700.css">
                    <!--Iphone 4 P-->
                    <link rel="stylesheet" media="only screen and (min-width: 700px) and (max-width: 800px)"
                        href="../css/style_800.css">
                        <!--Ipad P-->
                        <link rel="stylesheet" media="only screen and (min-width: 900px) and (max-width: 1100px)"
                            href="../css/style_1100.css">
                            <!--Black L-->
                            <link rel="stylesheet" media="only screen and (min-width: 1000px) and (max-width: 1200px)"
                                href="../css/style_1200.css">
                                <!--Ipad L-->
                                <link rel="stylesheet" media="only screen and (min-width: 1200px) and (max-width: 1500px)" href="../css/style_1400.css">
                                    
                                    <script type="text/javascript" src="../js/jquery.js"></script>
                                    
                                    <script type="text/javascript" src="../js/jquery.mobile-1.0.js"></script>
                                    
                                    <script type="text/javascript" src="../js/common.js"></script>
                                    <script type="text/javascript" src="../cordova-1.5.0.js"></script>
                                    <script type="text/javascript" src="../js/jquery.json-2.3.min.js"></script>
                                    
                                    <script src="../LangJS/jquery-lang.js" charset="utf-8" type="text/javascript"></script>
                                    <script src="../LangJS/langpack/AR.js" charset="utf-8" type="text/javascript" lang="en"></script>
    </head>
    <body>
        <div data-role="page" data-theme="d" data-title="Order Request">
            <div>
                <img title="" alt="" src="../images/bg.png" id="background">
                    </div>
            <div data-role="header" data-position="inline" id="bgclheader">
                <a href="promotion_review.html" id="Back_inner" rel="external" lang="en">Back</a>
                <div class="wrapper"><div class="card_content"><div><img title="" alt="" data-pushbar-target="left"  src="../images/icons8-menu-50.png" id="setting"></div></div></div> 
                <h1 lang="en">
                    Add Free Sample</h1>
                <a href="#" id="lang_inner">EN</a>
            </div>
            <div data-role="content" class="centerbox">
                <div class="boxContent">                   
                    <div class="tblBox tbltd">                                       
                        <table id="tblHeaderContent" cellpadding="0" cellspacing="0" width="100%" class="tblHeader">
                            <tr>                                 
                                <th style="width: 20%;" lang="en" class="leftAlign">
                                    Item Code
                                </th>
                                <th style="width: 60%;" lang="en" class="leftAlign">
                                    Item Description
                                </th>
                               <!-- <th style="width: 15%;" lang="en">
                                    Sales Qty
                                </th>
                                <th style="width: 15%;" lang="en">
                                    Sales Price
                                </th> -->
                                <th style="width: 20%;" lang="en" class="last">
                                    Free Qty
                                </th>
                            </tr>
                        </table>
                        <div id="contentWrapper" class="tblHeightWithTab">
                            <table id="tblContent" cellpadding="0" cellspacing="0" border="0" width="100%">
                                <tr>                              
                                    <td style="width: 20%;" class="leftAlign">
                                    </td>
                                    <td style="width: 60%;" class="leftAlign">
                                    </td>
                                  <!--  <td style="width: 15%;">
                                    </td>
                                    <td style="width: 15%;">
                                    </td> -->
                                    <td style="width: 20%;" class="last">
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <div class="textBar">
                        <table id="tblInput" cellpadding="2" cellspacing="2" border="0" width="100%">
                            <tr>                             
                                <td id="tdCaseLabel" class="captionLabel" lang="en" id="Td1" style="width:30%">
                                    Cases 
                                </td>
                                <td class="captionLabel" lang="en" style="width:30%">   
                                    Units                             
                                </td>
                                <td style="width:40%" lang="en">
                                    Total Free Qty    
                                </td>    
                            </tr>
                            <tr>                              
                                <td>                               
                                    <!--<input id="txtCase" type="text" pattern="[0-9]*" size="11" class="textWidth textFont"  value="0.0"/>-->
                                    <input id="txtCase" type="number" size="11" class="textWidth textFont"  value="0.0"/>                               
                                </td>
                                <td>
                                    <!--<input id="txtUnits" type="text" pattern="[0-9]*" size="11" class="textWidth textFont"  value="0"/>-->
                                    <input id="txtUnits" type="number" size="11" class="textWidth textFont"  value="0"/>
                                </td> 
                                <td>
                                    <!--<input id="txFreeQty" type="text" pattern="[0-9]*" size="11" class="textWidth textFont"  value="0" readonly="readonly"/>-->
                                    <input id="txFreeQty" type="number" size="11" class="textWidth textFont"  value="0" readonly="readonly"/>    
                                <td>    
                            </tr>               
                        </table>
                    </div>
                </div>
                
                <div class="leftbottomMenu">                  
                    <div class="menuPadding">
                        &nbsp;</div>
                    <a href="#" rel="external" id="simplestring" style="text-decoration:none" data-role="none" onclick="UpdateInvoiceDetail();">
                        <div class="MenuPosition">
                            
                            <div class="MenuTextPos"><img src="../images/save.png" alt="Option" /></div>
                            <div class="MenuTextPos MenuText" lang="en">Save</div>                    
                        </div>
                    </a>   
                    <div class="menuPadding">
                        &nbsp;</div>
                    <a href="promotion_review.html" class="enableText" rel="external" ><div class="MenuPosition" >
                        <div class="MenuTextPos">
                            <img src="../images/icn-exit.png" alt="Exit" /></div>
                        <div class="MenuTextPos MenuText" lang="en">
                            Cancel</div>
                    </div></a>
                    <div class="menuPadding">
                        &nbsp;</div>
                </div>
            </div>
            <div  id="f1" data-role="footer" class="ui-bar">
                <div class="footer">
                    <div class="leftfooter">
                        09 November 2011</div>
                    <div class="rightfooter">
                        Mirnah Technology Systems</div>
                </div>
            </div>
            <div  id="f2" data-role="footer" style="bottom: 0; position: absolute;">
             <aside data-pushbar-id="left" class="pushbar from_left">
		<div class="title"><span data-pushbar-close class="close push_right"></span>
			<span id="txtroute"></span>
		</div>

		<ul class="menu">
		<li style="margin-bottom: 0 !important;" > 
		<img title="" alt="" src="../images/startday-icon.png" id="day"  class="leftmenu" >
		 <a href="#"
						class="ui-btn-active" rel="external" id="day" data-icon="custom"  
						lang="en" onclick="footerredict('../startofday/startofday.html')">Start day</a></li>
					<li style="margin-bottom: 0 !important;">
					 <img title="" alt="" src="../images/Inventoryicon.png" id="inve"  class="leftmenu">
					 <a href="#" id="inve"
						rel="external" data-icon="custom" lang="en"
						onclick="footerredict('../inventory/inventory.html')">Inventory</a></li>
					<li style="margin-bottom: 0 !important;">
					 <img title="" alt="" src="../images/customer-icon.png" id="cust" class="leftmenu">
					 <a href="#"
						rel="external" id="cust" data-icon="custom" lang="en"
						onclick="footerredict('../customer/customer_operation.html')">Customer</a></li>
					<li style="margin-bottom: 0 !important;">
					<img title="" alt="" src="../images/Money-icon.png" id="sett" class="leftmenu">
					<a href="#"
						rel="external" id="sett" data-icon="custom" lang="en"
						onclick="footerredict('../settlement/managesettlement.html')">Settlement</a></li>
					<li style="margin-bottom: 0 !important;">
					<img title="" alt="" src="../images/expense-icon.png" id="expe" class="leftmenu">
					<a href="#"
						rel="external" id="expe" data-icon="custom" lang="en"
						onclick="footerredict('../settlement/expenseentry.html')">Expenses</a></li>
					<li style="margin-bottom: 0 !important;">
					<img title="" alt="" src="../images/information-icon.png" id="info" class="leftmenu" >
					<a href="#"
						rel="external" id="info" data-icon="custom" lang="en"  
						onclick="footerredict('../information/information.html')">Information</a></li>
					<li style="margin-bottom: 0 !important; ">
					 <img title="" alt="" src="../images/user-settings-icon.png" id="setup" class="leftmenu">
					 <a href="#" rel="external" id="setup" data-icon="custom" lang="en"
						onclick="footerredict('../utilities/utilities.html')">Utilities</a></li>
		</ul>

	</aside>
                <div data-role="navbar" data-iconpos="top" data-grid="f">
                <ul>
                    <li style="margin-bottom:0 !important;"><a href="#" rel="external" id="day" data-icon="custom" lang="en" onclick="footerredict('../startofday/startofday.html')">Start day</a></li>
			        <li style="margin-bottom:0 !important;"><a href="#" id="inve" rel="external" data-icon="custom" lang="en" onclick="footerredict('../inventory/inventory.html')">Inventory</a></li>
			        <li style="margin-bottom:0 !important;"><a href="#" class="ui-btn-active" rel="external" id="cust" data-icon="custom" lang="en">Customer</a></li>
			        <li style="margin-bottom:0 !important;"><a href="#" rel="external" id="sett" data-icon="custom" lang="en" onclick="footerredict('../settlement/managesettlement.html')">Settlement</a></li>
			        <li style="margin-bottom:0 !important;"><a href="#" rel="external" id="expe" data-icon="custom" lang="en" onclick="footerredict('../settlement/expenseentry.html')">Expenses</a></li>
			        <li style="margin-bottom:0 !important;"><a href="#" rel="external" id="info" data-icon="custom" lang="en" onclick="footerredict('../information/information.html')">Information</a></li>
			        <li style="margin-bottom:0 !important; width:14.0%"><a href="#" rel="external" id="setup" data-icon="custom" lang="en" onclick="footerredict('../utilities/utilities.html')">Utilities</a></li>
                </ul>
            </div>
            </div>
        </div>
        
        <script type="text/javascript">
            var data = null;             
            var index = 0;
            var returnprice = 0;
            var stdreturnprice = 0;
            var promovalue = 0;
            var sumQty = 0;
            window.lang = new jquery_lang_js();
            $("#tblContent").click(function() { });
			resizeOrientationWindow();
            $(document).ready(function() {
			resizeWindow();
                              $(".leftfooter").html(getCurrentDate());
                              $("#txtCase").ForceNumericOnly();
                              $("#txtUnits").ForceNumericOnly();
                              $("#txFreeQty").ForceNumericOnly();
                              document.addEventListener("deviceready", getInvoiceList, false);

                              // sujee added side bar ----------------- START ------------------------ 

                           	          	          var pushbar = new Pushbar({
                           	      		blur:true,
                           	      		overlay:true,
                           	      	});
                           	          $("#txtroute").text("ROUTE #: " + sessionStorage.getItem("RouteCode")); 
                           	          window.setInterval(function(){
                           	       		var randomColor = '#'+ ('000000' + Math.floor(Math.random()*16777215).toString(16)).slice(-6);
                           	       		$('#txtroute').css({
                           	         			'color' : randomColor,
                           	       		});
                           	     			}, 2000);
                           	          //----------------------------- END -------------------------  
                              
                              
                              
                              $("#tblContent tr").live('click', function() {
                                                       $(this).toggleClass('clicked');
                                                       $(this).siblings().removeClass('clicked');
                                                       index = $(this).index();
                                                       });
                              
                              $("#tblContent tr:eq(1)").trigger('click');           
                              
                              
                              var lan = sessionStorage.getItem("Language");
                              window.lang.run(lan);
                              
                              //Dropdown text color and disabled opacity setting
                              $('.ui-select .ui-btn-text').css({ 'text-align': 'left', 'color': '#999' });
                              
                              if (sessionStorage.getItem("Language")  != "en") {
                              
                              window.lang.change('PromotionItem'+lan,lan);
                              window.lang.change('Footer'+lan,lan);
                              if(lan=="AR")
                              {
                              $("#centerboxInvReq").attr("dir", "rtl");
                              $('#Back_inner').removeClass('ui-btn-left ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
                              $('#Back_inner').addClass('ui-btn-right ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
                              $('#lang_inner').removeClass('ui-btn-right ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
                              $('#lang_inner').addClass('ui-btn-left ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
                              }
                              
                              }
                              else
                              {
                              window.lang.change('en','en');
                              $(".centerboxInvReq").attr("dir", "ltr");
                              $('#Back_inner').removeClass('ui-btn-right ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
                              $('#Back_inner').addClass('ui-btn-left ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
                              $('#lang_inner').removeClass('ui-btn-left ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
                              $('#lang_inner').addClass('ui-btn-right ui-btn ui-btn-corner-all ui-shadow ui-btn-up-a');
                              }
                              
                              function GetElements(xmlDoc) {
                              var PageName = 'orderRequest';
                              }          
                              
                              
                              
                              
                              });
            
            //Function for bind invoice list
            function getInvoiceList()
            {      
                promovalue = sessionStorage.getItem("promovalue");
                $('#txFreeQty').val(promovalue);
                
                if(sessionStorage.getItem("CaseEnabled") != 1)
                {
                    $("#tdCaseLabel").hide();
                    $("#txtCase").hide();
                }
                
                Cordova.exec(function(result) {                
                              
                              
                              BindData(result);
                              
                              },
                              function(error) {
                              alert("Error in binding Invoice Detail : " + error);
                              },
                              "PluginClass", 
                              "GetdataMethod",                           
                              ["select CASE WHEN '"+ sessionStorage.getItem('CheckCode') +"' = 'alternatecode' THEN itemmaster.alternatecode ELSE itemmaster.anitemcode END AS Code,CASE WHEN '"+ sessionStorage.getItem('Language') +"' = 'en' THEN itemmaster.itemdescription ELSE itemmaster.arbitemdescription END As Description,ifnull(freesampleqty,0) as freesampleqty,ifnull(invoicedetail.salesqty,0) as salesqty,ifnull(invoicedetail.salesprice,0) as salesprice,itemmaster.unitspercase,itemmaster.actualitemcode from promokeydetail inner join productgroupdetail on  promokeydetail.assignmentgroup = productgroupdetail.groupnumber left join invoicedetail on productgroupdetail.itemcode = invoicedetail.itemcode and invoicedetail.routekey = "+ sessionStorage.getItem('RouteKey') +" and invoicedetail.visitkey  = "+ sessionStorage.getItem('VisitKey') +" inner join itemmaster on productgroupdetail.itemcode = itemmaster.actualitemcode where promokeydetail.promotionkey = (select promotionkey from customermaster where customercode = "+ sessionStorage.getItem('customerid') +") and promokeydetail.plannumber = "+ sessionStorage.getItem('plannumber') +""]);
                
                
            }
            
            function BindData(result)
            {
                var CellCount = $("#tblHeaderContent tr:eq(0) th").length;
                
                data = result;
                
                sumQty = 0;
                for (i = 0; i < data.length; i++) {
                    var r = "<tr class='contentFont'>";
                    for (j = 0; j < CellCount; j++) {
                        var temp = (j == 0 || j == 1) ? 'class = leftAlign' : '';
                        if (j == CellCount - 1)
                        temp += "class = 'leftAlign last'";
                        var c = "<td " + temp + ">" + data[i][j] + "</td>";
                        if(j == 4)
                            sumQty += eval(data[i][j]);
                        r += c;
                    }
                    r += "</tr>";
                    $('#tblContent tbody').append(r);
                }
                
                $("#tblContent tr:odd").addClass('oddRow');
                $("#tblContent tr:even").addClass('evenRow');        
                
                $("#tblContent tr:eq(1)").trigger('click');
            }   
            
            
            function UpdateInvoiceDetail()
            { 
               
                var Qty = 0; 
                if($("#txtCase").val() == '')
                    $("#txtCase").val(0);
                if($("#txtUnits").val() == '')
                    $("#txtUnits").val(0);    
                
                if(sessionStorage.getItem("CaseEnabled") == 1)
                {               
                    if($("#txtCase").val() != 0 || $("#txtUnits").val() != 0)
                    {
                        Qty = (eval($("#txtCase").val()) * data[index - 1][5]) ;                    
                        Qty += eval($("#txtUnits").val());
                        
                        if((Qty + sumQty - eval(data[index - 1][4]))  > promovalue)
                        {
                            getLangText("Please enter quantity less than or equal to total free qty");
                            return false;
                        }
                    }
                    
                    else
                    {
                        getLangText("Please enter case");
                        return false;
                    }                
                    
                }
                else
                {                
                    Qty = eval($("#txtUnits").val());
                    
                    if($("#txtUnits").val() != 0)
                    {
                        
                        if((Qty + sumQty - eval(data[index - 1][4])) > promovalue)
                        {
                            getLangText("Please enter quantity less than or equal to total free qty");
                            return false;
                        }
                    }
                    else 
                    {
                        getLangText("Please enter units");
                        return false;
                    }
                }
                
                if(Qty != 0)
                {     
                    
                    
                    //Update Invoice Detail                     
                    Cordova.exec(function(result) 
                                  { 
                                        ClearTable();
                                        getInvoiceList();
                                        //window.location = '../customer/promotion_review.html';
                                        //alert("Update Invoice Detail Successfully");                                  
                                  },
                                  function(error) {
                                        alert("Error updating record in a invoice detail");
                                  },
                                  "PluginClass", 
                                  "InsertUpdateMethod", 
                                  ["Update invoicedetail set freesampleqty = "+ Qty +",mdat = datetime(),issync=0 where routekey = "+ sessionStorage.getItem('RouteKey') +" and visitkey = "+ sessionStorage.getItem('VisitKey') +" and itemcode = "+ data[index - 1][6] +""]);                              
                }
                else
                {
                    getLangText("Please enter case or units");
                }
            } 
                       
            //Clear table 
            function ClearTable() {
                $("#tblContent" + " tr:gt(0)").remove();
            }
            
            </script>
        
    </body>
</html>
